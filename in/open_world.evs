#memory(
    string_key(0x0546)..string_key(0x232b), // last half of string keys
    function_key(0x0000)..function_key(0x232b), // TODO: all function keys?

    0x300000..0x3fffff, // extension

    // reserved: <0x23b9>
    <0x2272>..<0x2558>,

    <0x2834>..<0x28ff>
)
#include("in/core.evs")

#patch(
    // "void_maps",

    "skip_intro",
    // "brian",
    // "camera_hack",
    // "free_graveyard_ids",
    // "save_file_growth",

    // asm
    // "debug_menu", // uses 0x3f0000…???
    "_hook_input", // 0x3f0000…0x310000
        "hotkeys", // uses 0x3f00000…???
        // "room_timer", // uses 0x300000…???
    // "_hook_trigger",
)

// hotkeys

@install()
@inject(ADDRESS.HOTKEY_START)
fun hotkey_start() {
    debug_subtext("Start");
}
@install()
@inject(ADDRESS.HOTKEY_START_L)
fun hotkey_start_l() {
    debug_subtext("Start+L");
}
@install()
@inject(ADDRESS.HOTKEY_START_R)
fun hotkey_start_r() {
    debug_subtext("Start+R");

    attribute(BOY, NO_CLIP, True);
}

// maps

@install(ADDRESS.INTRO_FIRST_CODE_EXECUTED)
fun intro_skip() {
    // map_transition(flowers, start, NONE);
    
    map_transition(volcano_path, south, NONE);
}

// act 0

// map intro(0x61) {
//     enum entrance {
//         test = entrance(0x10, 0x10, NONE), // always 0/0
//     }
// 
//     fun trigger_enter() {
//         fade_in();
//     }
// };

area podunk() {
    map podunk_old(PODUNK_65) {
        enum entrance {
            north = entrance(0d09, 0d00, SOUTH),
            west = entrance(0d00, 0d19, EAST),

            cinema_left = entrance(0d64, 0d15, SOUTH),
            cinema_right = entrance(0d75, 0d15, SOUTH),
        }

        fun trigger_enter() {
            fade_in();
        }
    };

    map podunk_new(PODUNK_95) {
        enum entrance {
            north = entrance(0d09, 0d00, SOUTH),
            west = entrance(0d00, 0d19, EAST),

            cinema_left = entrance(0d64, 0d15, SOUTH),
            cinema_right = entrance(0d75, 0d15, SOUTH),
        }

        fun trigger_enter() {
            fade_in();
        }
    };

    map mansion_old(MANSION_65) {
        enum entrance {
            south = entrance(0d35, 0d111, NORTH),
        }

        fun trigger_enter() {
            fade_in();
        }
    };

    map mansion_modern(MANSION_95) {
        enum entrance {
            west = entrance(0d00, 0d106, EAST),
            south = entrance(0d19, 0d111, NORTH),
        }

        fun trigger_enter() {
            fade_in();
        }
    };
};

// act 1

area southern_jungle() {
    map flowers(FLOWERS) {
        enum entrance {
            north = entrance(0x62, 0x0b, SOUTH),
            west = entrance(0x04, 0x1f, EAST),

            start = entrance(0x46, 0x89, NORTH),
        }

        enum stepon_trigger {
            exit_north = @install() {
                debug_subtext("S=0");
                map_transition(raptors, south, NORTH);
            },
            exit_west = @install() {
                debug_subtext("S=1");
                map_transition(strongheart_outside, east, WEST);
            },
        }

        enum b_trigger {
            gourd__15_money = @install() {
                debug_subtext("B=0");
                _loot_chest(0x05, MONEY, 0d15);
            },
            gourd__1_petal = @install() {
                debug_subtext("B=1");
                _loot_chest(0x00, PETAL, 0d01);
            },
            gourd__1_petal = @install() {
                debug_subtext("B=2");
                _loot_chest(0x02, PETAL, 0d01);
            },
            gourd__1_nectar = @install() {
                debug_subtext("B=3");
                _loot_chest(0x04, NECTAR, 0d01);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=4");
                _loot(0x1c, CLAY, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=5");
                _loot(0x1b, ASH, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=6");
                _loot(0x1a, ROOTS, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=7");
                _loot(0x19, WATER, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=8");
                _loot(0x18, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=9");
                _loot(0x17, ASH, 0d01, 0d00);
            },

            sniff__1_water = @install() {
                debug_subtext("B=10");
                _loot(0x16, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=11");
                _loot(0x15, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=12");
                _loot(0x14, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=13");
                _loot(0x13, ROOTS, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=14");
                _loot(0x12, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=15");
                _loot(0x11, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=16");
                _loot(0x10, ROOTS, 0d01, 0d00);
            },
            sniff__2_roots = @install() {
                debug_subtext("B=17");
                _loot(0x0e, CLAY, 0d02, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=18");
                _loot(0x0f, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=19");
                _loot(0x0d, ROOTS, 0d01, 0d00);
            },

            sniff__1_water = @install() {
                debug_subtext("B=20");
                _loot(0x0b, WATER, 0d01, 0d00);
            },
            sniff__2_roots = @install() {
                debug_subtext("B=21");
                _loot(0x09, ROOTS, 0d02, 0d00); // same as B=22
            },
            sniff__2_roots = @install() {
                debug_subtext("B=22");
                _loot(0x09, ROOTS, 0d02, 0d00); // same as B=21
            },
            gourd__1_oil = @install() {
                debug_subtext("B=23");
                _loot_chest(0x01, OIL, 0x01);
            },
            gourd__shell_helmet = @install() {
                debug_subtext("B=24");
                _loot_chest(0x03, HELM_1_2, 0x01);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=25");
                _loot(0x0a, ROOTS, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=26");
                _loot(0x07, ASH, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=27");
                _loot(0x08, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=28");
                _loot(0x0c, ROOTS, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=29");
                _loot(0x1d, WATER, 0d01, 0d00);
            },

            sniff__1_roots = @install() {
                debug_subtext("B=30");
                _loot(0x1e, ROOTS, 0d01, 0d00);
            },
        }

        fun trigger_enter() {
            init_map(0x00, 0x02, 0x80, 0x96);

            fade_in();
            
            // object[0x00] = 0x01; // loot gourd (petal #1)
            // object[0x01] = 0x01; // loot gourd (oil)
            // object[0x02] = 0x01; // loot gourd (petal #2)
            // object[0x03] = 0x01; // loot gourd (shell hat)
            // object[0x04] = 0x01; // loot gourd (nectar)
            // object[0x05] = 0x01; // loot gourd (15 talons)
        }
    };


    area strong_heart() {
        map strongheart_outside(STRONGHEART_EXTERIOR) {
            enum entrance {
                hut = entrance(0x13, 0x13, SOUTH), // TODO: 13/15
                east = entrance(0x25, 0x12, WEST),

                backdoor = entrance(0x0f, 0x0f, WEST),
            }

            enum stepon_trigger {
                exit_door = @install() {
                    map_transition(strongheart_inside, door, NORTH);
                },
                exit_west = @install() {
                    map_transition(flowers, west, EAST);
                }
            }

            fun trigger_enter() {
                fade_in();
            }
        };

        map strongheart_inside(STRONGHEART) {
            enum entrance {
                door = entrance(0x12, 0x23, NORTH)
            }

            enum stepon_trigger {
                door = @install() {
                    debug_subtext("S=0");
                    map_transition(strongheart_outside, hut, SOUTH);
                }
            }

            enum b_trigger {
                gourd_1__1_oil = @install() {
                    debug_subtext("B=0");
                    _loot_chest(0x00, OIL, 0d01);
                },
                gourd_2__1_wax = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x02, WAX, 0d01);
                },
                gourd_3__1_wax = @install() {
                    debug_subtext("B=2");
                    _loot_chest(0x01, WAX, 0d01);
                },
            }

            fun trigger_enter() {
                // object[0x00] = 0x01; // unload gourd_1
                // object[0x02] = 0x01; // unload gourd_2
                // object[0x01] = 0x01; // unload gourd_3

                fade_in();
            }
        };
    };

    map raptors(RAPTORS) {
        enum entrance {
            north = entrance(0x1b, 0x03, SOUTH),
            south = entrance(0x1d, 0x33, NORTH),

            left = entrance(0x15, 0x1c, NONE),
            center = entrance(0x1e, 0x21, NONE),
            right = entrance(0x2a, 0x23, NONE)
        }

        enum stepon_trigger {
            exit_north = @install() {
                debug_subtext("S=0");
                map_transition(village, south, NORTH);
            },
            exit_south = @install() {
                debug_subtext("S=1");
                map_transition(flowers, north, SOUTH);
            },
            center = @install() {
                debug_subtext("S=2");
            }
        }

        enum b_trigger {
            sniff__1_crystal_1 = @install() {
                debug_subtext("B=0");
                _loot(0x09, CRYSTAL, 0d01, 0d01);
            },
            sniff__1_oil_1 = @install() {
                debug_subtext("B=1");
                _loot(0x08, OIL, 0d01, 0d01);
            },
            sniff__1_crystal_2 = @install() {
                debug_subtext("B=2");
                _loot(0x07, CRYSTAL, 0d01, 0d02);
            },
            sniff__1_water_2 = @install() {
                debug_subtext("B=3");
                _loot(0x06, WATER, 0d01, 0d02);
            },
        }

        fun close_exits(close) {
            if(close) {
                object[0x04] = 0x04;
            } else {
                object[0x05] = 0x04;
            }
        }

        fun trigger_enter() {
            close_exits(False);

            fade_in();
        }
    };
};

area village() {
    map village(VILLAGE) {
        enum entrance {
            north = entrance(0x59, 0x0d, SOUTH),
            east = entrance(0x7d, 0x65, WEST),
            south = entrance(0x59, 0x73, NORTH),
            west = entrance(0x01, 0x2f, EAST),

            hut_1 = entrance(0x0f, 0x1b, SOUTH),
            hut_2 = entrance(0x33, 0x2d, SOUTH),
            hut_3 = entrance(0x53, 0x2f, SOUTH),
            hut_4 = entrance(0x65, 0x36, SOUTH),
            hut_5 = entrance(0x6f, 0x49, SOUTH),
            hut_6 = entrance(0x45, 0x53, SOUTH),
            hut_7 = entrance(0x25, 0x5b, SOUTH),
            hut_8 = entrance(0x21, 0x3b, SOUTH),
        }

        enum stepon_trigger {
            exit_hut_1 = @install() {
                debug_subtext("S=0");
            },
            exit_hut_2 = @install() {
                debug_subtext("S=1");
            },
            exit_hut_3 = @install() {
                debug_subtext("S=2");
            },
            exit_hut_4 = @install() {
                debug_subtext("S=3");
            },
            exit_hut_5 = @install() {
                debug_subtext("S=4");
            },
            exit_hut_6 = @install() {
                debug_subtext("S=5");
            },
            exit_hut_7 = @install() {
                debug_subtext("S=6");
            },
            exit_hut8 = @install() {
                debug_subtext("S=7");
            },
            guard_east = @install() {
                debug_subtext("S=8");
            },
            exit_north = @install() {
                debug_subtext("S=9");
                map_transition(northern_jungle, south, NORTH);
            },

            exit_south = @install() {
                debug_subtext("S=10");
                map_transition(raptors, north, SOUTH);
            },
            exit_east = @install() {
                debug_subtext("S=11");
                map_transition(east_jungle, west, EAST);
            },
            exit_west = @install() {
                debug_subtext("S=12");
                map_transition(defend, east, WEST);
            },
        }

        enum b_trigger {
            sniff__1_ash = @install() {
                debug_subtext("B=0");
                _loot(0x14, ASH, 0d01, 0d00); // object[0x12]=0x01; object[0x13]=0x01; ?
            },
            sniff__1_ash = @install() {
                debug_subtext("B=1");
                _loot(0x13, ASH, 0d01, 0d00); // object[0x12]=0x01; object[0x14]=0x01; ?
            },
            sniff__1_ash = @install() {
                debug_subtext("B=2");
                _loot(0x12, ASH, 0d01, 0d00); // object[0x13]=0x01; object[0x14]=0x01; ?
            },
            gourd__2_wax = @install() {
                debug_subtext("B=3");
                _loot_chest(0x00, WAX, 0d02);
            },
            sniff__1_water = @install() {
                debug_subtext("B=4");
                _loot(0x0c, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=5");
                _loot(0x0b, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=6");
                _loot(0x0a, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=7");
                _loot(0x09, ROOTS, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=8");
                _loot(0x08, OIL, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=9");
                _loot(0x07, OIL, 0d01, 0d00);
            },

            sniff__1_water = @install() {
                debug_subtext("B=10");
                _loot(0x06, WATER, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=11");
                _loot(0x05, OIL, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=12");
                _loot(0x04, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=13");
                _loot(0x03, ROOTS, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=14");
                _loot(0x02, OIL, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=15");
                _loot(0x0d, WATER, 0d01, 0d00); // object[0x0d]=0x01; ?
            },
            sniff__1_ash = @install() {
                debug_subtext("B=16");
                _loot(0x0e, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=17");
                _loot(0x0f, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=18");
                _loot(0x10, ASH, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=19");
                _loot(0x01, ROOTS, 0d01, 0d00);
            },
        }

        fun trigger_enter() {
            // object[0x00] = 0x01; // open gourd
            // … sniff spots?
            // object[0x11] = 0x01; // ignite fire

            fade_in();
        }
    };

    // todo: huts

    map defend(DEFEND) {
        enum entrance {
            east = entrance(0x26, 0x13, WEST),
        }

        enum stepon_trigger {
            exit_east = @install() {
                debug_subtext("S=0");
                map_transition(village, west, EAST);
            },
        }

        enum b_trigger {
            gourd_2__1_call_beads = @install() {
                debug_subtext("B=0");
                // _loot_chest(0x00, BISCUIT, 0x01);
                _loot_chest(0x00, CALL_BEADS, 0x01);
            },
            gourd_1__4_clay = @install() {
                debug_subtext("B=1");
                _loot_chest(0x01, CLAY, 0d04);
            },
            gourd_3__5_ash = @install() {
                debug_subtext("B=2");
                _loot_chest(0x02, ASH, 0d05);
            },
        }

        fun trigger_enter() {
            // object[0x01] = 0x01; // loot gourd_1
            // object[0x00] = 0x01; // loot gourd_2
            // object[0x02] = 0x01; // loot gourd_3

            fade_in();
        }
    };
};

area eastern_jungle() {
    map east_jungle(EAST_JUNGLE) {
        enum entrance {
            north = entrance(0x12, 0x09, SOUTH),
            east_1 = entrance(0x6d, 0x11, WEST),
            east_2 = entrance(0x6d, 0x23, WEST),
            east_3 = entrance(0x6d, 0x35, WEST),
            west = entrance(0x01, 0x37, EAST),
        }

        enum stepon_trigger {
            exit_east_1 = @install() {
                debug_subtext("S=0");
                map_transition(sandpits, west_3, EAST);
            },
            exit_east_3 = @install() {
                debug_subtext("S=1");
                map_transition(sandpits, west_1, EAST);
            },
            exit_east_2 = @install() {
                debug_subtext("S=2");
                map_transition(sandpits, west_2, EAST);
            },
            exit_west = @install() {
                debug_subtext("S=3");
                map_transition(village, east, WEST);
            },
            exit_north = @install() {
                debug_subtext("S=4");
                map_transition(jungle_firepit, south, NORTH);
            },
        }

        enum b_trigger {
            sniff__1_clay = @install() {
                debug_subtext("B=0");
                _loot(0x0a, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=1");
                _loot(0x09, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=2");
                _loot(0x08, CLAY, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=3");
                _loot(0x07, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=4");
                _loot(0x06, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=5");
                _loot(0x05, ROOTS, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=6");
                _loot(0x04, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=7");
                _loot(0x03, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=8");
                _loot(0x0c, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=9");
                _loot(0x0b, WATER, 0d01, 0d00);
            },

            sniff__1_roots = @install() {
                debug_subtext("B=10");
                _loot(0x02, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=11");
                _loot(0x01, ROOTS, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=12");
                _loot(0x00, WATER, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=13");
                _loot(0x0d, CLAY, 0d01, 0d00); // same as B=16
            },
            sniff__1_water = @install() {
                debug_subtext("B=14");
                _loot(0x0c, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=15");
                _loot(0x0b, WATER, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=16");
                _loot(0x0d, CLAY, 0d01, 0d00); // same as B=13
            },
        }

        fun trigger_enter() {
            init_map(0x00, 0x06, 0x6e, 0x52);
            
            fade_in();
        }
    };

    map jungle_firepit(FIREPIT_JUNGLE) {
        enum entrance {
            south = entrance(0x17, 0x2c, NORTH),
        }

        enum stepon_trigger {
            exit_south = @install() {
                debug_subtext("S=0");
                map_transition(east_jungle, north, SOUTH);
            },
            windwalker = @install() {
                debug_subtext("S=1");
            },
        }

        enum b_trigger {
            sniff__1_clay_2 = @install() {
                debug_subtext("B=0");
                _loot(0x06, CLAY, 0d01, 0d02);
            },
            sniff__1_ash_1 = @install() {
                debug_subtext("B=1");
                _loot(0x05, ASH, 0d01, 0d01);
            },
            sniff__1_oil_1 = @install() {
                debug_subtext("B=2");
                _loot(0x04, OIL, 0d01, 0d01);
            },
            sniff__1_oil_3 = @install() {
                debug_subtext("B=3");
                _loot(0x03, OIL, 0d01, 0d03);
            },
        }

        fun trigger_enter() {
            // object[0x00] = 0x02; // add windwalker_hitbox
            // object[0x01] = 0x01; // ignite firepit
            // object[0x02] = 0x01; // show dog_statue

            fade_in();
        }
    };

    area sandpits() {
        map sandpits(SANDPITS) {
            enum entrance {
                east = entrance(0x73, 0x22, WEST),
                cave = entrance(0x42, 0x1a, SOUTH),
                south_1 = entrance(0x44, 0x9e, NORTH),
                south_2 = entrance(0x33, 0x9e, NORTH),
                west_1 = entrance(0x01, 0x2a, EAST),
                west_2 = entrance(0x01, 0x22, EAST),
                west_3 = entrance(0x01, 0x15, EAST)
            }

            enum stepon_trigger {
                center_bottleneck = @install() {
                    debug_subtext("S=0");
                },
                stepon_1 = @install() {
                    debug_subtext("S=1");
                },
                sandpit_5_2_west = @install() {
                    debug_subtext("S=2");
                },
                sandpit_5_2_north = @install() {
                    debug_subtext("S=3");
                },
                sandpit_4_1_east = @install() {
                    debug_subtext("S=4");
                },
                sandpit_4_1_south = @install() {
                    debug_subtext("S=5");
                },
                sandpit_4_1 = @install() {
                    debug_subtext("S=6");
                },
                sandpit_2_north = @install() {
                    debug_subtext("S=7");
                },
                sandpit_2 = @install() {
                    debug_subtext("S=8");
                },
                sandpit_8_east = @install() {
                    debug_subtext("S=9");
                },

                sandpit_6_north = @install() {
                    debug_subtext("S=10");
                },
                sandpit_6_west = @install() {
                    debug_subtext("S=11");
                },
                sandpit_6 = @install() {
                    debug_subtext("S=12");
                },
                sandpit_9 = @install() {
                    debug_subtext("S=13");
                },
                sandpit_10_3 = @install() {
                    debug_subtext("S=14");
                },
                sandpit_10_2 = @install() {
                    debug_subtext("S=15");
                },
                sandpit_10_1 = @install() {
                    debug_subtext("S=16");
                },
                sandpit_8 = @install() {
                    debug_subtext("S=17");
                },
                sandpit_7 = @install() {
                    debug_subtext("S=8");
                },
                sandpit_5_1 = @install() {
                    debug_subtext("S=19");
                },

                sandpit_4_2 = @install() {
                    debug_subtext("S=20");
                },
                sandpit_3_2 = @install() {
                    debug_subtext("S=21");
                },
                stepon_22 = @install() {
                    debug_subtext("S=22");
                },
                stepon_23 = @install() {
                    debug_subtext("S=23");
                },
                exit_west_1 = @install() {
                    debug_subtext("S=24");
                    map_transition(east_jungle, east_3, WEST);
                },
                exit_cave = @install() {
                    debug_subtext("S=25");
                    map_transition(act1_caves__jaguar_ring, south, NORTH);
                },
                exit_south_1 = @install() {
                    debug_subtext("S=26");
                    map_transition(bugmuck, north_2, SOUTH);
                },
                exit_south_2 = @install() {
                    debug_subtext("S=27");
                    map_transition(bugmuck, north_1, SOUTH);
                },
                exit_west_2 = @install() {
                    debug_subtext("S=28");
                    map_transition(east_jungle, east_2, WEST);
                },
                exit_west_3 = @install() {
                    debug_subtext("S=29");
                    map_transition(east_jungle, east_1, WEST);
                },

                sandpit_1_1 = @install() {
                    debug_subtext("S=30");
                },
                sandpit_1_1_west = @install() {
                    debug_subtext("S=31");
                },
                sandpit_3_2_west = @install() {
                    debug_subtext("S=32");
                },
                sandpit_4_2_south = @install() {
                    debug_subtext("S=33");
                },
                sandpit_5_1_south = @install() {
                    debug_subtext("S=34");
                },
                sandpit_7_north = @install() {
                    debug_subtext("S=35");
                },
                sandpit_9_north = @install() {
                    debug_subtext("S=36");
                },
                sandpit_10_2_north = @install() {
                    debug_subtext("S=37");
                },
                sandpit_10_3_north = @install() {
                    debug_subtext("S=38");
                },
                sandpit_cave_north = @install() {
                    debug_subtext("S=39");
                },

                sandpit_cave = @install() {
                    debug_subtext("S=40");
                },
                sandpit_5_1_north = @install() {
                    debug_subtext("S=41");
                },
                sandpit_1_2_west = @install() {
                    debug_subtext("S=42");
                },
                sandpit_1_2_east = @install() {
                    debug_subtext("S=43");
                },
                sandpit_3_1_north = @install() {
                    debug_subtext("S=44");
                },
                sandpit_2_east = @install() {
                    debug_subtext("S=45");
                },
                sandpit_3_1_south = @install() {
                    debug_subtext("S=46");
                },
                sandpit_4_3_west = @install() {
                    debug_subtext("S=47");
                },
                sandpit_4_3_north = @install() {
                    debug_subtext("S=48");
                },
                sandpit_4_3 = @install() {
                    debug_subtext("S=49");
                },

                sandpit_5_2 = @install() {
                    debug_subtext("S=50");
                },
                sandpit_1_2 = @install() {
                    debug_subtext("S=51");
                },
                sandpit_3_1 = @install() {
                    debug_subtext("S=52");
                },
                sandpit_4_1 = @install() {
                    debug_subtext("S=53");
                },
                sandpit_8_west = @install() {
                    debug_subtext("S=54");
                },
                sandpit_8_north = @install() {
                    debug_subtext("S=55");
                },
                sandpit_10_3_east = @install() {
                    debug_subtext("S=56");
                },
                sanpit_7_south = @install() {
                    debug_subtext("S=57");
                },
                sanpit_7_east = @install() {
                    debug_subtext("S=58");
                },
                sandpit_3_2_east = @install() {
                    debug_subtext("S=59");
                },

                sandpit_4_2_north = @install() {
                    debug_subtext("S=60");
                },
                sandpit_4_2_east = @install() {
                    debug_subtext("S=61");
                },
                sandpit_10_1_north = @install() {
                    debug_subtext("S=62");
                },
                sandpit_10_1_west = @install() {
                    debug_subtext("S=63");
                },
                exit_east = @install() {
                    debug_subtext("S=64");
                    map_transition(acid_rain, west, EAST);
                }
            }

            enum b_trigger {
                sniff__1_wax = @install() {
                    debug_subtext("B=0");
                    _loot(0x2c, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=1");
                    _loot(0x2e, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=2");
                    _loot(0x2d, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=3");
                    _loot(0x16, WAX, 0d01, 0d00);
                },
                gourd_south__4_crystal = @install() {
                    debug_subtext("B=4");
                    _loot_chest(0x02, CRYSTAL, 0d04);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=5");
                    _loot(0x17, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=6");
                    _loot(0x18, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=7");
                    _loot(0x19, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=8");
                    _loot(0x1a, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=9");
                    _loot(0x1b, ASH, 0d01, 0d00);
                },

                sniff__1_ash = @install() {
                    debug_subtext("B=10");
                    _loot(0x1c, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=11");
                    _loot(0x1d, ASH, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=12");
                    _loot(0x1e, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=13");
                    _loot(0x1f, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=14");
                    _loot(0x20, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=15");
                    _loot(0x21, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=16");
                    _loot(0x22, ROOTS, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=17");
                    _loot(0x23, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=18");
                    _loot(0x24, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=19");
                    _loot(0x25, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=20");
                    _loot(0x26, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=21");
                    _loot(0x29, CLAY, 0d01, 0d00);
                },
                gourd_hidden_west__1_clay = @install() {
                    debug_subtext("B=22");
                    _loot_chest(0x29, CLAY, 0d01);
                },
                gourd_hidden_north_3__1_water = @install() {
                    debug_subtext("B=23");
                    _loot_chest(0x2a, WATER, 0d01);
                },
                gourd_hidden_north_2__1_biscuit = @install() {
                    debug_subtext("B=24");
                    _loot_chest(0x28, BISCUIT, 0d01);
                },
                gourd_hidden_north_1__1_clay = @install() {
                    debug_subtext("B=25");
                    _loot_chest(0x27, CLAY, 0d01);
                },
                gourd_west__1_petal = @install() {
                    debug_subtext("B=26");
                    _loot_chest(0x00, PETAL, 0d01);
                },
                gourd_north = @install() {
                    debug_subtext("B=27");
                    _loot_chest(0x01, WAX, 0d04);
                }
            }

            fun open_sandpits(open) {
                if(open) {
                    object[0x04] = 0x04; // open sandpit_1_1
                    object[0x12] = 0x04; // open sandpit_1_2
                    object[0x03] = 0x04; // open sandpit_2
                    object[0x13] = 0x04; // open sandpit_3_1
                    object[0x05] = 0x04; // open sandpit_3_2
                    object[0x14] = 0x04; // open sandpit_4_1
                    object[0x06] = 0x04; // open sandpit_4_2
                    object[0x10] = 0x04; // open sandpit_4_3
                    object[0x07] = 0x04; // open sandpit_5_1
                    object[0x11] = 0x04; // open sandpit_5_2
                    object[0x08] = 0x04; // open sandpit_6
                    object[0x09] = 0x04; // open sandpit_7
                    object[0x0a] = 0x04; // open sandpit_8
                    object[0x0b] = 0x04; // open sandpit_9
                    object[0x0c] = 0x04; // open sandpit_10_1
                    object[0x0d] = 0x04; // open sandpit_10_2
                    object[0x0e] = 0x04; // open sandpit_10_3
                    object[0x0f] = 0x04; // open sandpit_cave
                } else {
                    object[0x04] = 0x00; // open sandpit_1_1
                    object[0x12] = 0x00; // open sandpit_1_2
                    object[0x03] = 0x00; // open sandpit_2
                    object[0x13] = 0x00; // open sandpit_3_1
                    object[0x05] = 0x00; // open sandpit_3_2
                    object[0x14] = 0x00; // open sandpit_4_1
                    object[0x06] = 0x00; // open sandpit_4_2
                    object[0x10] = 0x00; // open sandpit_4_3
                    object[0x07] = 0x00; // open sandpit_5_1
                    object[0x11] = 0x00; // open sandpit_5_2
                    object[0x08] = 0x00; // open sandpit_6
                    object[0x09] = 0x00; // open sandpit_7
                    object[0x0a] = 0x00; // open sandpit_8
                    object[0x0b] = 0x00; // open sandpit_9
                    object[0x0c] = 0x00; // open sandpit_10_1
                    object[0x0d] = 0x00; // open sandpit_10_2
                    object[0x0e] = 0x00; // open sandpit_10_3
                    object[0x0f] = 0x00; // open sandpit_cave
                }
            }

            fun trigger_enter() {
                open_sandpits(True);

                fade_in();

                // object[0x00] = 0x01; // open gourd_west
                // object[0x01] = 0x01; // open gourd_north
                // object[0x02] = 0x01; // open gourd_south

                // object[0x04] = 0x04; // open sandpit_1_1
                // object[0x12] = 0x04; // open sandpit_1_2
                // object[0x03] = 0x04; // open sandpit_2
                // object[0x13] = 0x04; // open sandpit_3_1
                // object[0x05] = 0x04; // open sandpit_3_2
                // object[0x14] = 0x04; // open sandpit_4_1
                // object[0x06] = 0x04; // open sandpit_4_2
                // object[0x10] = 0x04; // open sandpit_4_3
                // object[0x07] = 0x04; // open sandpit_5_1
                // object[0x11] = 0x04; // open sandpit_5_2
                // object[0x08] = 0x04; // open sandpit_6
                // object[0x09] = 0x04; // open sandpit_7
                // object[0x0a] = 0x04; // open sandpit_8
                // object[0x0b] = 0x04; // open sandpit_9
                // object[0x0c] = 0x04; // open sandpit_10_1
                // object[0x0d] = 0x04; // open sandpit_10_2
                // object[0x0e] = 0x04; // open sandpit_10_3
                // object[0x0f] = 0x04; // open sandpit_cave

                // sniff spots

                // object[0x27] = 0x01; // open gourd_hidden_north_1
                // object[0x28] = 0x01; // open gourd_hidden_north_2
                // object[0x29] = 0x01; // open gourd_hidden_west
                // object[0x2a] = 0x01; // open gourd_hidden_north_3
            }
        };

        map act1_caves__jaguar_ring(ACT1_2_CAVES) {
            enum entrance {
                south = entrance(0x18, 0x29, NORTH), // entrance(0x17, 0x29, NORTH),
            }

            enum stepon_trigger {
                exit_south_drain = nop(),
                exit_south_raptors = nop(),
                exit_south = @install() {
                    debug_subtext("S=2");
                    map_transition(sandpits, cave, SOUTH);
                },
                exit_south_hard_ball = nop(),
                exit_south_inn = nop(),
            }

            enum b_trigger {
                gourd_drain_2__1_roots = nop(),
                gourd_drain_1__1_ethanol = nop(),
                gourd_inn_2__1_water = nop(),
                gourd_inn_1__1_water = nop(),
                gourd_1__1_water = @install() {
                    debug_subtext("B=4");
                    _loot_chest(0x05, WATER, 0d01);
                },
                gourd_2__1_water = @install() {
                    debug_subtext("B=5");
                    _loot_chest(0x00, WATER, 0d01);
                },
                gourd_3__1_clay = @install() {
                    debug_subtext("B=6");
                    _loot_chest(0x01, CLAY, 0d01);
                },
                gourd_hard_ball_1__1_water = nop(),
                gourd_hard_ball_2__1_water = nop(),
                gourd_hard_ball_3__1_clay = nop(),
            }

            fun trigger_enter() {
                // object[0x05] = 0x01; // loot gourd_jaguar_ring_1
                // object[0x00] = 0x01; // loot gourd_jaguar_ring_2
                // object[0x01] = 0x01; // loot gourd_jaguar_ring_3

                fade_in();
            }
        };

        map acid_rain(ACID_RAIN) {
            enum entrance {
                west = entrance(0x01, 0x16, EAST),
            }

            enum stepon_trigger {
                exit_west = @install() {
                    debug_subtext("S=0");
                    map_transition(sandpits, east, WEST);
                },
            }

            enum b_trigger {
                gourd_2__4_ash = @install() {
                    debug_subtext("B=0");
                    _loot_chest(0x01, ASH, 0d04);
                },
                gourd_1__4_water = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x00, WATER, 0d04);
                },
            }

            fun trigger_enter() {
                // object[0x00] = 0x01; // loot gourd_1
                // object[0x01] = 0x01; // loot gourd_2

                fade_in();
            }
        };

        area bugmuck() {
            map bugmuck(BUGMUCK) {
                enum entrance {
                    north_1 = entrance(0x0b, 0x01, SOUTH),
                    north_2 = entrance(0x1b, 0x01, SOUTH),
                    cave = entrance(0x24, 0x4c, SOUTH),

                    dungeon_north = entrance(0x7c, 0x0b, NORTH),
                    dungeon_east_1 = entrance(0x85, 0x34, EAST),
                    dungeon_east_2 = entrance(0x85, 0x3e, EAST),
                    dungeon_east_3 = entrance(0x85, 0x4a, EAST),
                    dungeon_south = entrance(0x7c, 0x75, SOUTH),
                    dungeon_west_1 = entrance(0x73, 0x4a, WEST),
                    dungeon_west_2 = entrance(0x73, 0x3e, WEST),
                    dungeon_west_3 = entrance(0x73, 0x34, WEST),
                }

                enum stepon_trigger {
                    stepon_0 = @install() {
                        debug_subtext("S=0");
                    },
                    stepon_1 = @install() {
                        debug_subtext("S=1");
                    },
                    stepon_2 = @install() {
                        debug_subtext("S=2");
                    },
                    exit_north_1 = @install() {
                        debug_subtext("S=3");
                        map_transition(sandpits, south_2, NORTH);
                    },
                    exit_north_2 = @install() {
                        debug_subtext("S=4");
                        map_transition(sandpits, south_1, NORTH);
                    },
                    exit_cave = @install() {
                        debug_subtext("S=5");
                        map_transition(act1_caves__hard_ball, south, NORTH);
                    },
                    bbm_south = @install() {
                        debug_subtext("S=6");
                        map_transition(bbm_1, south, NORTH);
                    },
                    bbm_west_1 = @install() {
                        debug_subtext("S=7");
                        map_transition(bbm_2, level_2_west, EAST);
                    },
                    bbm_west_2 = @install() {
                        debug_subtext("S=8");
                        map_transition(bbm_2, level_1_west, EAST);
                    },
                    bbm_west_3 = @install() {
                        debug_subtext("S=9");
                        map_transition(bbm_2, level_0_west, EAST);
                    },

                    bbm_east_1 = @install() {
                        debug_subtext("S=10");
                        map_transition(bbm_2, level_0_east, WEST);
                    },
                    bbm_east_2 = @install() {
                        debug_subtext("S=11");
                        map_transition(bbm_2, level_1_east, WEST);
                    },
                    bbm_east_3 = @install() {
                        debug_subtext("S=12");
                        map_transition(bbm_2, level_2_east, WEST);
                    },
                }

                enum b_trigger {
                    gourd__2_crystal = @install() {
                        debug_subtext("B=0");
                        _loot_chest(0x0d, CRYSTAL, 0d02);
                    },
                    gourd__armband_1_2 = @install() {
                        debug_subtext("B=1");
                        _loot_chest(0x0c, ARMBAND_1_2, 0d01);
                    },
                    gourd__1_petal = @install() {
                        debug_subtext("B=2");
                        _loot_chest(0x0b, PETAL, 0d01);
                    },
                    gourd__4_water = @install() {
                        debug_subtext("B=3");
                        _loot_chest(0x09, WATER, 0d04);
                    },
                    gourd__2_crystal = @install() {
                        debug_subtext("B=4");
                        _loot_chest(0x0a, CRYSTAL, 0d02);
                    },
                    gourd__1_biscuit = @install() {
                        debug_subtext("B=5");
                        _loot_chest(0x07, BISCUIT, 0d01);
                    },
                    gourd__1_clay = @install() {
                        debug_subtext("B=6");
                        _loot_chest(0x08, CLAY, 0d01);
                    },
                    gourd__1_petal = @install() {
                        debug_subtext("B=7");
                        _loot_chest(0x06, PETAL, 0d01);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=8");
                        _loot(0x0e, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=9");
                        _loot(0x0f, OIL, 0d01, 0d00);
                    },

                    sniff__1_oil = @install() {
                        debug_subtext("B=10");
                        _loot(0x10, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=11");
                        _loot(0x11, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=12");
                        _loot(0x12, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=13");
                        _loot(0x13, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=14");
                        _loot(0x14, OIL, 0d01, 0d00);
                    },
                    sniff__1_oil = @install() {
                        debug_subtext("B=15");
                        _loot(0x15, OIL, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=16");
                        _loot(0x16, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=17");
                        _loot(0x17, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=18");
                        _loot(0x18, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=19");
                        _loot(0x19, ROOTS, 0d01, 0d00);
                    },

                    sniff__1_roots = @install() {
                        debug_subtext("B=20");
                        _loot(0x1a, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=21");
                        _loot(0x1b, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_roots = @install() {
                        debug_subtext("B=22");
                        _loot(0x1c, ROOTS, 0d01, 0d00);
                    },
                    sniff__1_ash = @install() {
                        debug_subtext("B=23");
                        _loot(0x1d, ASH, 0d01, 0d00);
                    },
                    sniff__1_ash = @install() {
                        debug_subtext("B=24");
                        _loot(0x1e, ASH, 0d01, 0d00);
                    },
                    sniff__1_ash = @install() {
                        debug_subtext("B=25");
                        _loot(0x1f, ASH, 0d01, 0d00);
                    },
                    sniff__1_ash = @install() {
                        debug_subtext("B=26");
                        _loot(0x20, ASH, 0d01, 0d00);
                    },
                    sniff__1_ash = @install() {
                        debug_subtext("B=27");
                        _loot(0x21, ASH, 0d01, 0d00);
                    },
                    sniff__1_crystal_2 = @install() {
                        debug_subtext("B=28");
                        _loot(0x22, CRYSTAL, 0d01, 0d02);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=29");
                        _loot(0x23, WAX, 0d01, 0d00);
                    },

                    sniff__1_crystal_1 = @install() {
                        debug_subtext("B=30");
                        _loot(0x24, CRYSTAL, 0d01, 0d01);
                    },
                    sniff__1_crystal = @install() {
                        debug_subtext("B=31");
                        _loot(0x25, CRYSTAL, 0d01, 0d00);
                    },
                    sniff__1_clay = @install() {
                        debug_subtext("B=32");
                        _loot(0x26, CLAY, 0d01, 0d00);
                    },
                    sniff__1_clay = @install() {
                        debug_subtext("B=33");
                        _loot(0x27, CLAY, 0d01, 0d00);
                    },
                    sniff__1_clay = @install() {
                        debug_subtext("B=34");
                        _loot(0x28, CLAY, 0d01, 0d00);
                    },
                    sniff__1_clay = @install() {
                        debug_subtext("B=35");
                        _loot(0x29, CLAY, 0d01, 0d00);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=36");
                        _loot(0x2a, WAX, 0d01, 0d00);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=37");
                        _loot(0x2b, WAX, 0d01, 0d00);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=38");
                        _loot(0x2c, WAX, 0d01, 0d00);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=39");
                        _loot(0x2d, WAX, 0d01, 0d00);
                    },

                    sniff__1_wax = @install() {
                        debug_subtext("B=40");
                        _loot(0x2e, WAX, 0d01, 0d00);
                    },
                    sniff__1_wax = @install() {
                        debug_subtext("B=41");
                        _loot(0x2f, WAX, 0d01, 0d00);
                    },
                }

                fun trigger_enter() {
                    // leg helpers?
                    // object[0x06] = 0x01; // gourd_bbm_east (petal)
                    // object[0x07] = 0x01; // gourd_bbm_west_1 (dog biscuit)
                    // object[0x08] = 0x01; // gourd_south
                    // object[0x09] = 0x01; // gourd_hb_south
                    // object[0x0a] = 0x01; // gourd_hb_east
                    // object[0x0b] = 0x01; // gourd_bbm_west_2 (petal)
                    // object[0x0c] = 0x01; // gourd_upstairs_2
                    // object[0x0d] = 0x01; // gourd_upstairs_1
                    
                    fade_in();
                }
            };

            map act1_caves__hard_ball(ACT1_2_CAVES) {
                enum entrance {
                    south = entrance(0x6e, 0x29, NORTH),
                }

                enum stepon_trigger {
                    exit_south_drain = nop(),
                    exit_south_raptors = nop(),
                    exit_south_jaguar_ring = nop(),
                    exit_south = @install() {
                        debug_subtext("S=3");
                        map_transition(bugmuck, cave, SOUTH);
                    },
                    exit_south_inn = nop(),
                }

                enum b_trigger {
                    gourd_drain_2__1_roots = nop(),
                    gourd_drain_1__1_ethanol = nop(),
                    gourd_inn_2__1_water = nop(),
                    gourd_inn_1__1_water = nop(),
                    gourd_jaguar_ring_1__1_water = nop(),
                    gourd_jaguar_ring_2__1_water = nop(),
                    gourd_jaguar_ring_3__1_clay = nop(),
                    gourd_1__1_water = @install() {
                        debug_subtext("B=7");
                        _loot_chest(0x02, WATER, 0d01);
                    },
                    gourd_2__1_water = @install() {
                        debug_subtext("B=8");
                        _loot_chest(0x03, WATER, 0d01);
                    },
                    gourd_3__1_clay = @install() {
                        debug_subtext("B=9");
                        _loot_chest(0x04, CLAY, 0d01);
                    },
                }

                fun trigger_enter() {
                    // object[0x02] = 0x01; // loot gourd_hard_ball_1
                    // object[0x03] = 0x01; // loot gourd_hard_ball_2
                    // object[0x04] = 0x01; // loot gourd_hard_ball_3

                    fade_in();
                }
            };

            area bbm() {
                map bbm_1(BBM_1) {
                    enum entrance {
                        north = entrance(0x34, 0x0b, SOUTH),
                        south = entrance(0x32, 0xa9, NORTH),
                    }

                    enum stepon_trigger {
                        stepon_0 = @install() {
                            debug_subtext("S=0");
                        },
                        slide_left_2_1 = @install() {
                            debug_subtext("S=1");
                        },
                        slide_left_1_1 = @install() {
                            debug_subtext("S=2");
                        },
                        slide_left_1_2 = @install() {
                            debug_subtext("S=3");
                        },
                        slide_right_1_1 = @install() {
                            debug_subtext("S=4");
                        },
                        slide_right_1_2 = @install() {
                            debug_subtext("S=5");
                        },
                        slide_right_5_3 = @install() {
                            debug_subtext("S=6");
                        },
                        slide_right_5_2 = @install() {
                            debug_subtext("S=7");
                        },
                        slide_right_5_1 = @install() {
                            debug_subtext("S=8");
                        },
                        slide_right_3 = @install() {
                            debug_subtext("S=9");
                        },

                        slide_right_2 = @install() {
                            debug_subtext("S=10");
                        },
                        slide_right_bottom = @install() {
                            debug_subtext("S=11");
                        },
                        slide_left_bottom = @install() {
                            debug_subtext("S=12");
                        },
                        slide_left_1_3 = @install() {
                            debug_subtext("S=13");
                        },
                        slide_right_1_3 = @install() {
                            debug_subtext("S=14");
                        },
                        slide_right_4_3 = @install() {
                            debug_subtext("S=15");
                        },
                        slide_right_4_2 = @install() {
                            debug_subtext("S=16");
                        },
                        slide_right_1_4 = @install() {
                            debug_subtext("S=17");
                        },
                        slide_left_1_4 = @install() {
                            debug_subtext("S=18");
                        },
                        slide_left_2_2 = @install() {
                            debug_subtext("S=19");
                        },

                        slide_left_3 = @install() {
                            debug_subtext("S=20");
                        },
                        slide_left_4 = @install() {
                            debug_subtext("S=21");
                        },
                        slide_left_5_2 = @install() {
                            debug_subtext("S=22");
                        },
                        slide_left_5_1 = @install() {
                            debug_subtext("S=23");
                        },
                        exit_south = @install() {
                            debug_subtext("S=24");
                            map_transition(bugmuck, dungeon_south, SOUTH);
                        },
                        exit_north = @install() {
                            debug_subtext("S=25");
                            map_transition(bbm_2, level_0_south, NORTH);
                        },
                        slide_right_4_1 = @install() {
                            debug_subtext("S=26");
                        },
                        stepon_27 = @install() {
                            debug_subtext("S=27");
                        },
                        stepon_28 = @install() {
                            debug_subtext("S=28");
                        },
                        stepon_29 = @install() {
                            debug_subtext("S=29");
                        },

                        stepon_30 = @install() {
                            debug_subtext("S=30");
                        },
                        stepon_31 = @install() {
                            debug_subtext("S=31");
                        },
                        stepon_32 = @install() {
                            debug_subtext("S=32");
                        },
                        stepon_33 = @install() {
                            debug_subtext("S=33");
                        },
                        stepon_34 = @install() {
                            debug_subtext("S=34");
                        },
                        stepon_35 = @install() {
                            debug_subtext("S=35");
                        },
                        stepon_36 = @install() {
                            debug_subtext("S=36");
                        },
                        stepon_37 = @install() {
                            debug_subtext("S=37");
                        },
                        stepon_38 = @install() {
                            debug_subtext("S=38");
                        },
                        stepon_39 = @install() {
                            debug_subtext("S=39");
                        },

                        stepon_40 = @install() {
                            debug_subtext("S=40");
                        },
                        stepon_41 = @install() {
                            debug_subtext("S=41");
                        },
                    }

                    enum b_trigger {
                        sniff__1_water = @install() {
                            debug_subtext("B=0");
                            _loot(0x10, WATER, 0d01, 0d00);
                        },
                        sniff__1_water = @install() {
                            debug_subtext("B=1");
                            _loot(0x11, WATER, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=2");
                            _loot(0x12, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=3");
                            _loot(0x13, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=4");
                            _loot(0x14, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=5");
                            _loot(0x15, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=6");
                            _loot(0x16, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=7");
                            _loot(0x17, CLAY, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=8");
                            _loot(0x18, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=9");
                            _loot(0x19, ROOTS, 0d01, 0d00);
                        },

                        sniff__1_roots = @install() {
                            debug_subtext("B=10");
                            _loot(0x1a, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=11");
                            _loot(0x1b, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=12");
                            _loot(0x1c, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=13");
                            _loot(0x1d, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=14");
                            _loot(0x1e, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=15");
                            _loot(0x1f, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=16");
                            _loot(0x20, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=17");
                            _loot(0x21, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=18");
                            _loot(0x22, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=19");
                            _loot(0x23, OIL, 0d01, 0d00);
                        },

                        sniff__1_ash = @install() {
                            debug_subtext("B=20");
                            _loot(0x24, ASH, 0d01, 0d00);
                        },
                        sniff__1_ash = @install() {
                            debug_subtext("B=21");
                            _loot(0x25, ASH, 0d01, 0d00);
                        },
                        sniff__1_ash = @install() {
                            debug_subtext("B=22");
                            _loot(0x26, ASH, 0d01, 0d00);
                        },
                        sniff__1_ash = @install() {
                            debug_subtext("B=23");
                            _loot(0x27, ASH, 0d01, 0d00);
                        },
                    }

                    fun trigger_enter() {
                        fade_in();
                    }
                };

                map bbm_2(BBM_2) {
                    enum entrance {
                        level_0_east = entrance(0x39, 0x20, WEST),
                        level_0_south = entrance(0x1c, 0x5b, NORTH),
                        level_0_west = entrance(0x01, 0x20, EAST),

                        level_1_east = entrance(0x39, 0x32, WEST),
                        level_1_west = entrance(0x01, 0x32, EAST),

                        level_2_north = entrance(0x1d, 0x05, SOUTH),
                        level_2_east = entrance(0x39, 0x44, WEST),
                        level_2_west = entrance(0x01, 0x44, EAST),
                    }

                    enum stepon_trigger {
                        exit_level_0_west = @install() {
                            debug_subtext("S=0");
                            map_transition(bugmuck, dungeon_west_3, WEST);
                        },
                        exit_level_1_west = @install() {
                            debug_subtext("S=1");
                            map_transition(bugmuck, dungeon_west_2, WEST);
                        },
                        exit_level_2_west = @install() {
                            debug_subtext("S=2");
                            map_transition(bugmuck, dungeon_west_1, WEST);
                        },
                        exit_level_2_east = @install() {
                            debug_subtext("S=3");
                            map_transition(bugmuck, dungeon_east_3, EAST);
                        },
                        exit_level_1_east = @install() {
                            debug_subtext("S=4");
                            map_transition(bugmuck, dungeon_east_2, EAST);
                        },
                        exit_level_0_east = @install() {
                            debug_subtext("S=5");
                            map_transition(bugmuck, dungeon_east_1, EAST);
                        },
                        exit_level_2_north = @install() {
                            debug_subtext("S=6");
                            map_transition(thraxx, south, NORTH);
                        },
                        exit_level_0_south = @install() {
                            debug_subtext("S=7");
                            map_transition(bbm_1, north, SOUTH);
                        },
                    }

                    enum b_trigger {
                        sniff__1_water = @install() {
                            debug_subtext("B=0");
                            _loot(0x00, WATER, 0d01, 0d00);
                        },
                        sniff__1_water = @install() {
                            debug_subtext("B=1");
                            _loot(0x01, WATER, 0d01, 0d00);
                        },
                        sniff__1_water = @install() {
                            debug_subtext("B=2");
                            _loot(0x02, WATER, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=3");
                            _loot(0x03, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=4");
                            _loot(0x04, CLAY, 0d01, 0d00);
                        },
                        sniff__1_clay = @install() {
                            debug_subtext("B=5");
                            _loot(0x05, CLAY, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=6");
                            _loot(0x06, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=7");
                            _loot(0x07, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_roots = @install() {
                            debug_subtext("B=8");
                            _loot(0x08, ROOTS, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=9");
                            _loot(0x09, OIL, 0d01, 0d00);
                        },

                        sniff__1_oil = @install() {
                            debug_subtext("B=10");
                            _loot(0x0a, OIL, 0d01, 0d00);
                        },
                        sniff__1_oil = @install() {
                            debug_subtext("B=11");
                            _loot(0x0b, OIL, 0d01, 0d00);
                        },
                    }

                    fun trigger_enter() {
                        fade_in();
                    }
                };

                map thraxx(THRAXX) {
                    enum entrance {
                        north = entrance(0x18, 0x10, SOUTH),
                        south = entrance(0x17, 0x3f, NORTH),
                    }

                    enum stepon_trigger {
                        exit_north = @install() {
                            debug_subtext("S=0");

                            map_transition(bugmuck, dungeon_north, NORTH);
                        },
                        trigger_boss = @install() {
                            debug_subtext("S=1");
                        },
                        exit_south = @install() {
                            debug_subtext("S=2");
                            map_transition(bbm_2, level_2_north, SOUTH);
                        }
                    }

                    enum b_trigger {
                        cocoon = @install() {
                            debug_subtext("B=0");
                        },
                        rip_cage = @install() {
                            debug_subtext("B=1");
                        }
                    }

                    fun show_thraxx(show) {
                        if(show) {
                            add_enemy(ENEMY.THRAXX_LEFT_ARM, 0x13, 0x0e);
                            add_enemy(ENEMY.THRAXX_RIGHT_ARM, 0x1d, 0x0d);

                            object[0x00] = 0x02;
                            object[0x02] = 0x01;
                            object[0x03] = 0x02;
                        } else {
                            object[0x00] = 0x02;
                            object[0x01] = 0x02;
                            object[0x02] = 0x02;
                            object[0x03] = 0x02;
                        }
                    }

                    fun show_cocoon(show) {
                        if(show) {
                            object[0x01] = 0x01;
                        } else {
                            object[0x01] = 0x00;
                        }
                    }

                    fun trigger_enter() {
                        show_thraxx(False);
                        // show_cocoon();

                        fade_in();
                    }
                };
            };
        };
    };
};

area northern_jungle() {
    map northern_jungle(NORTH_JUNGLE) {
        enum entrance {
            north = entrance(0x56, 0x05, SOUTH),
            south = entrance(0x07, 0x4d, NORTH),

            cave_1 = entrance(0x08, 0x0f, SOUTH),
            cave_2 = entrance(0x48, 0x13, SOUTH),

            wings = entrance(0x0f, 0x3f, NONE),
        }

        enum stepon_trigger {
            exit_north = @install() {
                debug_subtext("S=0");
                map_transition(graveyard, south, SOUTH);
            },
            cave_2 = @install() {
                debug_subtext("S=1");
                map_transition(volcano_rooms__main, south, NORTH);
            },
            cave_1 = @install() {
                debug_subtext("S=2");
                map_transition(volcano_rooms__cave, south, NORTH);
            },
            exit_south = @install() {
                debug_subtext("S=3");
                map_transition(village, north, SOUTH);
            },
        }
        
        enum b_trigger {
            sniff__1_water = @install() {
                debug_subtext("B=0");
                _loot(0x02, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=1");
                _loot(0x03, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=2");
                _loot(0x04, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=3");
                _loot(0x05, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=4");
                _loot(0x06, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=5");
                _loot(0x07, WATER, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=6");
                _loot(0x08, OIL, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=7");
                _loot(0x09, OIL, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=8");
                _loot(0x0a, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=9");
                _loot(0x0b, ROOTS, 0d01, 0d00);
            },

            sniff__1_roots = @install() {
                debug_subtext("B=10");
                _loot(0x0c, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=11");
                _loot(0x0d, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=12");
                _loot(0x0e, ROOTS, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=13");
                _loot(0x0f, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=14");
                _loot(0x10, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=15");
                _loot(0x11, CLAY, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=16");
                _loot(0x12, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=17");
                _loot(0x13, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=18");
                _loot(0x14, ASH, 0d01, 0d00);
            },
            sniff__1_wax = @install() {
                debug_subtext("B=19");
                _loot(0x15, WAX, 0d01, 0d00);
            },

            sniff__1_wax = @install() {
                debug_subtext("B=20");
                _loot(0x16, WAX, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=21");
                _loot_chest(0x00, CLAY, 0d01);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=22");
                _loot_chest(0x01, NECTAR, 0d01);
            },
        }

        fun trigger_enter() {
            // object[0x01] = 0x01; // loot gourd_north (nectar)
            // object[0x00] = 0x01; // loot gourd_south (clay)

            fade_in();
        }
    };

    area volcano() {
        map volcano_rooms__cave(VOLCANO_ROOMS) { // variant: cave
            enum entrance {
                south = entrance(0x54, 0xb1, NORTH),
            }

            enum stepon_trigger {
                exit_room_nw_north = nop(),
                exit_room_nw_west = nop(),
                exit_south = @install() {
                    debug_subtext("S=2");
                    map_transition(northern_jungle, cave_1, SOUTH);
                },
                exit_room_s_south = nop(),
                exit_room_nne_east = nop(),
                exit_room_ns_south = nop(),
                exit_room_sw_west = nop(),
                exit_room_ns_north = nop(),
                exit_room_sw_south = nop(),
                exit_room_nne_north_1 = nop(),

                exit_room_es_south = nop(),
                exit_room_es_east = nop(),
                exit_room_nne_north_2 = nop(),
                exit_room_nss_south_2 = nop(),
                exit_room_nss_south_1 = nop(),
                exit_room_nss_north = nop(),
                exit_room_alchemist_north = nop(),
                exit_main_east = nop(),
                exit_main_west = nop(),
                exit_main_north = nop(),

                exit_main_south = nop(),
            }
            
            enum b_trigger {
                sniff__1_ash = @install() {
                    debug_subtext("B=0");
                    _loot(0x17, ASH, 0d01, 0d00);
                },
                gourd_2__3_wax = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x16, WAX, 0d03);
                },
                gourd_1__1_wax = @install() {
                    debug_subtext("B=2");
                    _loot_chest(0x15, WAX, 0d01);
                },
                gourd_room_ns__4_ash = nop(),
                gourd_room_sw__4_ash = nop(),
                gourd_main__1_call_bead = nop(),
                gourd_alchemist_west__3_water = nop(),
                gourd_room_s_2__2_wax = nop(),
                gourd_room_s_1__3_ash = nop(),
                gourd_alchemist_hidden_2__5_wax = nop(),

                gourd_alchemist_hidden_1__6_water = nop(),
                sniff__1_ash = @install() {
                    debug_subtext("B=11");
                    _loot_chest(0x05, ASH, 0d04);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=12");
                    _loot(0x08, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=13");
                    _loot(0x09, WATER, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=14");
                    _loot(0x0a, CLAY, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=15");
                    _loot(0x0b, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=16");
                    _loot(0x0c, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=17");
                    _loot(0x0d, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=18");
                    _loot(0x0e, ROOTS, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=19");
                    _loot(0x0f, OIL, 0d01, 0d00);
                },

                sniff__1_oil = @install() {
                    debug_subtext("B=20");
                    _loot(0x10, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=21");
                    _loot(0x11, OIL, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=22");
                    _loot(0x12, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=23");
                    _loot(0x13, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=24");
                    _loot(0x14, WAX, 0d01, 0d00);
                },
            }

            fun trigger_enter() {
                fade_in();
            }
        };

        map volcano_rooms__main(VOLCANO_ROOMS) { // variant: main
            enum entrance {
                north = entrance(0xd3, 0x3d, SOUTH),
                east = entrance(0xf7, 0x5b, WEST),
                south = entrance(0xd5, 0x95, NORTH),
                west = entrance(0xbb, 0x5d, EAST),
            }

            enum stepon_trigger {
                exit_room_nw_north = nop(),
                exit_room_nw_west = nop(),
                exit_cave_south = nop(),
                exit_room_s_south = nop(),
                exit_room_nne_east = nop(),
                exit_room_ns_south = nop(),
                exit_room_sw_west = nop(),
                exit_room_ns_north = nop(),
                exit_room_sw_south = nop(),
                exit_room_nne_north_1 = nop(),

                exit_room_es_south = nop(),
                exit_room_es_east = nop(),
                exit_room_nne_north_2 = nop(),
                exit_room_nss_south_2 = nop(),
                exit_room_nss_south_1 = nop(),
                exit_room_nss_north = nop(),
                exit_room_alchemist_north = nop(),
                exit_east = @install() {
                    debug_subtext("S=17");
                },
                exit_west = @install() {
                    debug_subtext("S=18");
                },
                exit_north = @install() {
                    debug_subtext("S=19");
                    map_transition(dungeon_volcano, south_2, NORTH);
                },

                exit_south = @install() {
                    debug_subtext("S=20");
                    map_transition(northern_jungle, cave_2, SOUTH);
                },
            }
            
            enum b_trigger {
                sniff__1_ash = @install() {
                    debug_subtext("B=0");
                    _loot(0x17, ASH, 0d01, 0d00);
                },
                gourd_cave_outside_2__3_wax = nop(),
                gourd_cave_outside_1__1_wax = nop(),
                gourd_room_ns__4_ash = nop(),
                gourd_room_sw__4_ash = nop(),
                gourd__1_call_bead = @install() {
                    debug_subtext("B=5");
                    _loot_chest(0x03, CALL_BEADS, 0x01);
                },
                gourd_alchemist_west__3_water = nop(),
                gourd_room_s_2__2_wax = nop(),
                gourd_room_s_1__3_ash = nop(),
                gourd_alchemist_hidden_2__5_wax = nop(),

                gourd_alchemist_hidden_1__6_water = nop(),
                sniff__1_ash = @install() {
                    debug_subtext("B=11");
                    _loot_chest(0x05, ASH, 0d04);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=12");
                    _loot(0x08, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=13");
                    _loot(0x09, WATER, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=14");
                    _loot(0x0a, CLAY, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=15");
                    _loot(0x0b, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=16");
                    _loot(0x0c, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=17");
                    _loot(0x0d, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=18");
                    _loot(0x0e, ROOTS, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=19");
                    _loot(0x0f, OIL, 0d01, 0d00);
                },

                sniff__1_oil = @install() {
                    debug_subtext("B=20");
                    _loot(0x10, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=21");
                    _loot(0x11, OIL, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=22");
                    _loot(0x12, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=23");
                    _loot(0x13, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=24");
                    _loot(0x14, WAX, 0d01, 0d00);
                },
            }

            fun trigger_enter() {
                fade_in();
            }
        };

        map dungeon_volcano(VOLCANO) {
            enum entrance {
                north_1 = entrance(0x2e, 0x05, SOUTH),
                north_2 = entrance(0x76, 0x06, SOUTH),
                south_1 = entrance(0x7d, 0xb1, NORTH),
                south_2 = entrance(0x51, 0xb1, NORTH),
            }

            enum stepon_trigger {
                exit_north_1 = @install() {
                    debug_subtext("S=0");
                },
                exit_north_2 = @install() {
                    debug_subtext("S=1");
                },
                exit_south_1 = @install() {
                    debug_subtext("S=2");
                },
                exit_south_2 = @install() {
                    debug_subtext("S=3");
                    map_transition(volcano_rooms__main, north, SOUTH);
                },
            }

            enum b_trigger {
                gourd_north_2__1_mud_pepper = @install() {
                    debug_subtext("B=0");
                    _loot_chest(0x03, MUD_PEPPER, 0d01); // same as B=1
                },
                gourd_north_2__1_mud_pepper = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x03, MUD_PEPPER, 0d01); // same as B=0
                },
                sniff__1_water = @install() {
                    debug_subtext("B=2");
                    _loot(0x10, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=3");
                    _loot(0x0f, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=4");
                    _loot(0x0e, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=5");
                    _loot(0x0d, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=6");
                    _loot(0x0c, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=7");
                    _loot_chest(0x0a, WATER, 0d01);
                },
                gourd_inside_2__100_money = @install() {
                    debug_subtext("B=8");
                    _loot_chest(0x0b, MONEY, 0d100);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=9");
                    _loot(0x11, CLAY, 0d01, 0d00);
                },

                sniff__1_clay = @install() {
                    debug_subtext("B=10");
                    _loot(0x12, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=11");
                    _loot(0x13, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=12");
                    _loot(0x14, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=13");
                    _loot(0x15, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=14");
                    _loot(0x16, CLAY, 0d01, 0d00);
                },
                sniff__1_clay = @install() {
                    debug_subtext("B=15");
                    _loot(0x17, CLAY, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=16");
                    _loot(0x18, ROOTS, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=17");
                    _loot(0x19, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=18");
                    _loot(0x1a, OIL, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=19");
                    _loot(0x1b, ASH, 0d01, 0d00);
                },

                sniff__1_ash = @install() {
                    debug_subtext("B=20");
                    _loot(0x1c, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("B=21");
                    _loot(0x1d, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("S=22");
                    _loot(0x1e, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("S=23");
                    _loot(0x1f, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("S=24");
                    _loot(0x20, ASH, 0d01, 0d00);
                },
                sniff__1_ash = @install() {
                    debug_subtext("S=25");
                    _loot(0x21, ASH, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("S=26");
                    _loot(0x22, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("S=27");
                    _loot(0x23, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("S=28");
                    _loot(0x24, WAX, 0d01, 0d00);
                },
                gourd_north_1__1_roots = @install() {
                    debug_subtext("S=29");
                    _loot_chest(0x08, ROOTS, 0d01);
                },

                gourd_west_2__1_roots = @install() {
                    debug_subtext("S=30");
                    _loot_chest(0x07, ROOTS, 0d01);
                },
                gourd_west_1__1_clay = @install() {
                    debug_subtext("S=31");
                    _loot_chest(0x06, CLAY, 0d01);
                },
                gourd_south__1_mud_pepper = @install() {
                    debug_subtext("S=32");
                    _loot_chest(0x04, MUD_PEPPER, 0d01);
                },
                gourd_east__1_petal = @install() {
                    debug_subtext("S=33");
                    _loot_chest(0x05, PETAL, 0d01);
                },
            }

            fun trigger_enter() {
                // object[0x00] = 0x7e; // show bridge_north
                // object[0x01] = 0x7e; // show bridge_center_2
                // object[0x02] = 0x7e; // show bridge_center_1
                // object[0x03] = 0x01; // loot gourd_north_2
                // object[0x04] = 0x01; // loot gourd_south (mud pepper)
                // object[0x05] = 0x01; // loot gourd_east (petal)
                // object[0x06] = 0x01; // loot gourd_west_1 (clay)
                // object[0x07] = 0x01; // loot gourd_west_2 (roots)
                // object[0x08] = 0x01; // loot gourd_north_1 (roots)
                // ???
                // object[0x0a] = 0x01; // loot gourd_inside_1 (water)
                // object[0x0b] = 0x01; // loot gourd_inside_2 (100 talons)
                // ???

                fade_in();
            }
        };

        // todo: side rooms, pipe maze, magmar
    };

    map graveyard(GRAVEYARD) {
        enum entrance {
            north = entrance(0x32, 0x0f, SOUTH),
            south = entrance(0x2f, 0x5f, NORTH)
        }

        enum stepon_trigger {
            exit_north = @install() {
                map_transition(volcano_path, south, NORTH);
            },
            exit_south = @install() {
                debug_subtext("S=1");
                map_transition(northern_jungle, north, SOUTH);
            },
            spawn_boss = @install() {
                debug_subtext("S=2");
            }
        }

        enum b_trigger {
            sniff__1_ash = @install() {
                debug_subtext("B=0");
                _loot(0x0c, ASH, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=1");
                _loot(0x02, OIL, 0d01, 0d00);
            },
            sniff__1_ash_1 = @install() {
                debug_subtext("B=2");
                _loot(0x06, ASH, 0d01, 0d01);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=3");
                _loot(0x0e, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=4");
                _loot(0x0f, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=5");
                _loot(0x07, ASH, 0d01, 0d00);
            },
            sniff__1_wax_1 = @install() {
                debug_subtext("B=6");
                _loot(0x1b, WAX, 0d01, 0d01);
            },
            sniff__1_wax_2 = @install() {
                debug_subtext("B=7");
                _loot(0x1c, WAX, 0d01, 0d02);
            },
            sniff__1_ash_1 = @install() {
                debug_subtext("B=8");
                _loot(0x11, ASH, 0d01, 0d01);
            },
            sniff__1_ash_2 = @install() {
                debug_subtext("B=9");
                _loot(0x18, ASH, 0d01, 0d02);
            },

            sniff__1_clay_2 = @install() {
                debug_subtext("B=10");
                _loot(0x05, CLAY, 0d01, 0d02);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=11");
                _loot(0x09, CLAY, 0d01, 0d00);
            },
            sniff__1_oil_2 = @install() {
                debug_subtext("B=12");
                _loot(0x19, OIL, 0d01, 0d02);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=13");
                _loot(0x12, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=14");
                _loot(0x15, ROOTS, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=15");
                _loot(0x08, OIL, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=16");
                _loot(0x0a, CLAY, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=17");
                _loot(0x01, WATER, 0d01, 0d00);
            },
            sniff__1_wter_1 = @install() {
                debug_subtext("B=18");
                _loot(0x03, WATER, 0d01, 0d01);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=19");
                _loot(0x0d, ROOTS, 0d01, 0d00);
            },

            sniff__1_roots_1 = @install() {
                debug_subtext("B=20");
                _loot(0x1d, ROOTS, 0d01, 0d01);
            },
            sniff__1_roots_3 = @install() {
                debug_subtext("B=21");
                _loot(0x1a, ROOTS, 0d01, 0d03);
            },
            sniff__1_water_2 = @install() {
                debug_subtext("B=22");
                _loot(0x13, WATER, 0d01, 0d02);
            },
            sniff__1_clay_1 = @install() {
                debug_subtext("B=23");
                _loot(0x04, CLAY, 0d01, 0d01);
            },
            sniff__1_roots_2 = @install() {
                debug_subtext("B=24");
                _loot(0x0b, ROOTS, 0d01, 0d02);
            },
            sniff__1_water = @install() {
                debug_subtext("B=25");
                _loot(0x1e, WATER, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=26");
                _loot(0x10, ROOTS, 0d01, 0d00);
            },
            sniff__1_clay_1 = @install() {
                debug_subtext("B=27");
                _loot(0x17, CLAY, 0d01, 0d01);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=28");
                _loot(0x16, ASH, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=29");
                _loot(0x14, CLAY, 0d01, 0d00);
            }
        }

        fun trigger_enter() {
            fade_in();
        }
    };

    map volcano_path(VOLCANO_PATH) {
        enum entrance {
            cutscene_north_1 = entrance(0x4a, 0x38, NONE),
            cutscene_north_2 = entrance(0x5f, 0x1b, NONE),
            east = entrance(0x6d, 0x83, WEST), // 0x6b, 0x83
            south = entrance(0x1b, 0x9d, NORTH),

            cave_west = entrance(0x0b, 0x70, SOUTH),
            cave_center = entrance(0x3f, 0x4a, SOUTH),
            cave_east = entrance(0x4d, 0x6a, SOUTH),

            cave_gauge = entrance(0x5f, 0x16, SOUTH),
        }

        enum stepon_trigger {
            tunnel_gauge = @install() {
                debug_subtext("S=0");
            },
            stepon_1 = @install() {
                debug_subtext("S=1");
            },
            stepon_2 = @install() {
                debug_subtext("S=2");
            },
            stepon_3 = @install() {
                debug_subtext("S=3");
            },
            stepon_4 = @install() {
                debug_subtext("S=4");
            },
            stepon_5 = @install() {
                debug_subtext("S=5");
            },
            stepon_6 = @install() {
                debug_subtext("S=6");
            },
            stepon_7 = @install() {
                debug_subtext("S=7");
            },
            stepon_8 = @install() {
                debug_subtext("S=8");
            },
            stepon_9 = @install() {
                debug_subtext("S=9");
            },

            stepon_10 = @install() {
                debug_subtext("S=10");
            },
            exit_south = @install() {
                debug_subtext("S=11");
                map_transition(graveyard, north, SOUTH);
            },
            cave_east = @install() {
                debug_subtext("S=12");
            },
            cave_west = @install() {
                debug_subtext("S=13");
            },
            cave_center = @install() {
                debug_subtext("S=14");
            },
            exit_east = @install() {
                debug_subtext("S=15");
                map_transition(swamp_entrance, west, EAST);
            },
            stepon_16 = @install() {
                debug_subtext("S=16");
            },
            stepon_17 = @install() {
                debug_subtext("S=17");
            },
            stepon_18 = @install() {
                debug_subtext("S=18");
            },
            stepon_19 = @install() {
                debug_subtext("S=19");
            },

            stepon_20 = @install() {
                debug_subtext("S=20");
            },
            stepon_21 = @install() {
                debug_subtext("S=21");
            },
            stepon_22 = @install() {
                debug_subtext("S=22");
            },
            stepon_23 = @install() {
                debug_subtext("S=23");
            },
            stepon_24 = @install() {
                debug_subtext("S=24");
            },
            stepon_25 = @install() {
                debug_subtext("S=25");
            },
            stepon_26 = @install() {
                debug_subtext("S=26");
            },
            stepon_27 = @install() {
                debug_subtext("S=27");
            },
            stepon_28 = @install() {
                debug_subtext("S=28");
            },
            stepon_29 = @install() {
                debug_subtext("S=29");
            },

            stepon_30 = @install() {
                debug_subtext("S=30");
            }
        }

        enum b_trigger {
            guord_gauge = @install() {
                debug_subtext("B=0");
                _loot_chest(0x27, WATER, 0d01); // gauge
            },
            gourd_2 = @install() {
                debug_subtext("B=1");
                _loot_chest(0x0b, CLAY, 0d01);
            },
            gourd_3 = @install() {
                debug_subtext("B=2");
                _loot_chest(0x08, PETAL, 0d01);
            },
            gourd_5 = @install() {
                debug_subtext("B=3");
                _loot_chest(0x09, WATER, 0d01);
            },
            gourd_1 = @install() {
                debug_subtext("B=4");
                _loot_chest(0x0a, ROOTS, 0d01);
            },
            sniff__1_water = @install() {
                debug_subtext("B=5");
                _loot(0x0c, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=6");
                _loot(0x0d, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=7");
                _loot(0x0e, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=8");
                _loot(0x0f, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=9");
                _loot(0x10, WATER, 0d01, 0d00);
            },

            sniff__1_water = @install() {
                debug_subtext("B=10");
                _loot(0x11, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=11");
                _loot(0x12, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=12");
                _loot(0x13, WATER, 0d01, 0d00);
            },
            sniff__1_water = @install() {
                debug_subtext("B=13");
                _loot(0x14, WATER, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=14");
                _loot(0x15, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=15");
                _loot(0x16, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=16");
                _loot(0x17, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=17");
                _loot(0x18, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=18");
                _loot(0x19, CLAY, 0d01, 0d00);
            },
            sniff__1_clay = @install() {
                debug_subtext("B=19");
                _loot(0x1a, CLAY, 0d01, 0d00);
            },

            sniff__1_clay = @install() {
                debug_subtext("B=20");
                _loot(0x1b, CLAY, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=21");
                _loot(0x1d, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=22");
                _loot(0x1d, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=23");
                _loot(0x1e, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=24");
                _loot(0x1f, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=25");
                _loot(0x20, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=26");
                _loot(0x21, ROOTS, 0d01, 0d00);
            },
            sniff__1_roots = @install() {
                debug_subtext("B=27");
                _loot(0x22, ROOTS, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=28");
                _loot(0x23, OIL, 0d01, 0d00);
            },
            sniff__1_oil = @install() {
                debug_subtext("B=29");
                _loot(0x24, OIL, 0d01, 0d00);
            },

            sniff__1_ash = @install() {
                debug_subtext("B=30");
                _loot(0x25, ASH, 0d01, 0d00);
            },
            sniff__1_ash = @install() {
                debug_subtext("B=31");
                _loot(0x26, ASH, 0d01, 0d00);
            },
            grass_non_sword = @install() {
                debug_subtext("B=32");
            },
        }

        fun trigger_enter() {
            // object[0x00] = 0x01; // activate pressure_plate_3_2
            // object[0x01] = 0x01; // activate pressure_plate_2_1
            // object[0x02] = 0x01; // activate pressure_plate_2_2
            // object[0x03] = 0x01; // activate pressure_plate_1_2
            // object[0x04] = 0x01; // activate pressure_plate_1_1
            // object[0x05] = 0x02; // activate pressure_plate_0_1 (0=grass, 1=no grass, 2=active)
            // object[0x06] = 0x01; // activate pressure_plate_0_2
            // object[0x07] = 0x01; // activate pressure_plate_3_1
            // object[0x08] = 0x01; // loot gourd_3
            // object[0x09] = 0x01; // loot gourd_5
            // object[0x0a] = 0x01; // loot gourd_1
            // object[0x0b] = 0x01; // loot gourd_2
            // …
            // object[0x27] = 0x01; // loot gourd_gauge

            fade_in();
        }
    };

    // todo: caves, top of volcano

    area swamp() {
        map swamp_entrance(SWAMP_ENTRANCE) {
            enum entrance {
                north = entrance(0x19, 0x02, SOUTH),
                east = entrance(0x5f, 0x3a, WEST),
                west = entrance(0x01, 0x23, EAST),
            }

            enum stepon_trigger {
                leaf_bridge_4 = @install() {
                    debug_subtext("S=0");
                },
                leaf_bridge_2 = @install() {
                    debug_subtext("S=1");
                },
                exit_north = @install() {
                    debug_subtext("S=2");
                    map_transition(jungle_firepit__swamp, south, NORTH);
                },
                leaf_bridge_1 = @install() {
                    debug_subtext("S=3");
                },
                exit_east = @install() {
                    debug_subtext("S=4");
                    map_transition(swamp, west, EAST);
                },
                exit_west = @install() {
                    debug_subtext("S=5");
                    map_transition(volcano_path, east, WEST);
                },
                leaf_bridge_3 = @install() {
                    debug_subtext("S=6");
                },
            }

            enum b_trigger {
                sniff__1_water = @install() {
                    debug_subtext("B=0");
                    _loot(0x0d, WATER, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=1");
                    _loot(0x0c, WAX, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=2");
                    _loot(0x0b, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=3");
                    _loot(0x0a, OIL, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=4");
                    _loot(0x09, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=5");
                    _loot(0x08, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=6");
                    _loot(0x00, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=7");
                    _loot(0x09, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=8");
                    _loot(0x0d, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=9");
                    _loot(0x01, WATER, 0d01, 0d00);
                },

                sniff__1_roots = @install() {
                    debug_subtext("B=10");
                    _loot(0x02, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=11");
                    _loot(0x03, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=12");
                    _loot(0x08, ROOTS, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=13");
                    _loot(0x0a, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=14");
                    _loot(0x0b, OIL, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=15");
                    _loot(0x0c, WAX, 0d01, 0d00);
                },
                sniff__1_wax = @install() {
                    debug_subtext("B=16");
                    _loot(0x04, WAX, 0d01, 0d00);
                },
                gourd_west__1_water = @install() {
                    debug_subtext("B=17");
                    _loot_chest(0x05, WATER, 0d01);
                },
                gourd_north__1_water = @install() {
                    debug_subtext("B=18");
                    _loot_chest(0x06, WATER, 0d01);
                },
            }

            fun trigger_enter() {
                // ???
                // object[0x05] = 0x01; // loot gourd_west
                // object[0x06] = 0x01; // loot gourd_north
                // object[0x07] = 0x7e; // show leaf_bridge

                fade_in();
            }
        };

        map jungle_firepit__swamp(FIREPIT_JUNGLE) {
            enum entrance {
                south = entrance(0x17, 0x2c, NORTH),
            }

            enum stepon_trigger {
                exit_south = @install() {
                    debug_subtext("S=0");
                    map_transition(swamp_entrance, north, SOUTH);
                },
                windwalker = @install() {
                    debug_subtext("S=1");
                },
            }

            enum b_trigger {
                sniff__1_clay_2 = @install() {
                    debug_subtext("B=0");
                    _loot(0x06, CLAY, 0d01, 0d02);
                },
                sniff__1_ash_1 = @install() {
                    debug_subtext("B=1");
                    _loot(0x05, ASH, 0d01, 0d01);
                },
                sniff__1_oil_1 = @install() {
                    debug_subtext("B=2");
                    _loot(0x04, OIL, 0d01, 0d01);
                },
                sniff__1_oil_3 = @install() {
                    debug_subtext("B=3");
                    _loot(0x03, OIL, 0d01, 0d03);
                },
            }

            fun trigger_enter() {
                // object[0x00] = 0x02; // add windwalker_hitbox
                // object[0x01] = 0x01; // ignite firepit
                // object[0x02] = 0x01; // show dog_statue

                fade_in();
            }
        };

        map swamp(SWAMP) {
            enum entrance {
                north = entrance(0x92, 0x01, SOUTH),
                west = entrance(0x01, 0xb0, EAST),
            }

            enum stepon_trigger {
                stepon_0 = @install() {
                    debug_subtext("S=0");
                },
                stepon_1 = @install() {
                    debug_subtext("S=1");
                },
                stepon_2 = @install() {
                    debug_subtext("S=2");
                },
                stepon_3 = @install() {
                    debug_subtext("S=3");
                },
                stepon_4 = @install() {
                    debug_subtext("S=4");
                },
                stepon_5 = @install() {
                    debug_subtext("S=5");
                },
                stepon_6 = @install() {
                    debug_subtext("S=6");
                },
                stepon_7 = @install() {
                    debug_subtext("S=7");
                },
                stepon_8 = @install() {
                    debug_subtext("S=8");
                },
                stepon_9 = @install() {
                    debug_subtext("S=9");
                },

                stepon_10 = @install() {
                    debug_subtext("S=10");
                },
                stepon_11 = @install() {
                    debug_subtext("S=11");
                },
                stepon_12 = @install() {
                    debug_subtext("S=12");
                },
                stepon_13 = @install() {
                    debug_subtext("S=13");
                },
                stepon_14 = @install() {
                    debug_subtext("S=14");
                },
                stepon_15 = @install() {
                    debug_subtext("S=15");
                },
                stepon_16 = @install() {
                    debug_subtext("S=16");
                },
                stepon_17 = @install() {
                    debug_subtext("S=17");
                },
                stepon_18 = @install() {
                    debug_subtext("S=18");
                },
                stepon_19 = @install() {
                    debug_subtext("S=19");
                },

                stepon_20 = @install() {
                    debug_subtext("S=20");
                },
                stepon_21 = @install() {
                    debug_subtext("S=21");
                },
                stepon_22 = @install() {
                    debug_subtext("S=22");
                },
                stepon_23 = @install() {
                    debug_subtext("S=23");
                },
                stepon_24 = @install() {
                    debug_subtext("S=24");
                },
                stepon_25 = @install() {
                    debug_subtext("S=25");
                },
                leaf_bridge_south = @install() {
                    debug_subtext("S=26");
                },
                exit_north = @install() {
                    debug_subtext("S=27");
                    map_transition(salabog, south, NORTH);
                },
                exit_west = @install() {
                    debug_subtext("S=28");
                    map_transition(swamp_entrance, east, WEST);
                },
            }

            enum b_trigger {
                sniff__1_oil = @install() {
                    debug_subtext("B=0");
                    _loot(0x3d, OIL, 0d01, 0d00);
                },
                gourd_north_west_1__1_clay_2 = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x38, CLAY, 0d01); // next=2
                },
                gourd_north_west_2__1_roots_1 = @install() {
                    debug_subtext("B=2");
                    _loot_chest(0x39, ROOTS, 0d01); // next=1
                },
                gourd_north_east__1_call_beads = @install() {
                    debug_subtext("B=3");
                    _loot_chest(0x3a, CALL_BEADS, 0d01);
                },
                gourd_east__1_oil = @install() {
                    debug_subtext("B=4");
                    _loot_chest(0x3b, OIL, 0d01);
                },
                gourd_south_east__1_wax_2 = @install() {
                    debug_subtext("B=5");
                    _loot_chest(0x35, WAX, 0d01); // next=2
                },
                gourd_south__1_biscuit = @install() {
                    debug_subtext("B=6");
                    _loot_chest(0x36, BISCUIT, 0d01);
                },
                gourd_south_west__1_nectar = @install() {
                    debug_subtext("B=7");
                    _loot_chest(0x37, NECTAR, 0d01);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=8");
                    _loot(0x05, WATER, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=9");
                    _loot(0x00, ROOTS, 0d01, 0d00);
                },

                sniff__1_roots = @install() {
                    debug_subtext("B=10");
                    _loot(0x01, ROOTS, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=11");
                    _loot(0x02, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=12");
                    _loot(0x03, WATER, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=13");
                    _loot(0x04, ROOTS, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=14");
                    _loot(0x05, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=15");
                    _loot(0x06, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=16");
                    _loot(0x07, WATER, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=17");
                    _loot(0x08, ROOTS, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=18");
                    _loot(0x09, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=19");
                    _loot(0x0a, WATER, 0d01, 0d00);
                },

                sniff__1_oil = @install() {
                    debug_subtext("B=20");
                    _loot(0x0b, OIL, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=21");
                    _loot(0x0c, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=22");
                    _loot(0x0d, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=23");
                    _loot(0x0e, ROOTS, 0d01, 0d00);
                },
                b_trigger_24 = @install() {
                    debug_subtext("B=24");
                    _loot(0x0f, WATER, 0d01, 0d00);
                },
                b_trigger_25 = @install() {
                    debug_subtext("B=25");
                    _loot(0x10, WATER, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=26");
                    _loot(0x3c, OIL, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=27");
                    _loot(0x11, ROOTS, 0d01, 0d00);
                },
                sniff__1_roots = @install() {
                    debug_subtext("B=28");
                    _loot(0x12, ROOTS, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=29");
                    _loot(0x13, WATER, 0d01, 0d00);
                },

                sniff__1_water = @install() {
                    debug_subtext("B=30");
                    _loot(0x14, WATER, 0d01, 0d00);
                },
                sniff__1_water = @install() {
                    debug_subtext("B=31");
                    _loot(0x15, WATER, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=32");
                    _loot(0x16, OIL, 0d01, 0d00);
                },
                sniff__1_oil = @install() {
                    debug_subtext("B=33");
                    _loot(0x3c, OIL, 0d01, 0d00);
                },
            }
            
            fun trigger_enter() {
                // ???
                // object[0x17] = 0x7e; // show leaf_bridge_south_1_1
                // object[0x18] = 0x7e; // show leaf_bridge_south_1_2
                // object[0x19] = 0x7e; // show leaf_bridge_south_1_3
                // object[0x1a] = 0x7e; // show leaf_bridge_south_2_1
                // object[0x1b] = 0x7e; // show leaf_bridge_south_2_2
                // object[0x1c] = 0x7e; // show leaf_bridge_south_2_3
                // object[0x1d] = 0x7e; // show leaf_bridge_south_2_4
                // object[0x1e] = 0x7e; // show leaf_bridge_south_2_5
                // object[0x1f] = 0x7e; // show leaf_bridge_south_2_6
                // object[0x20] = 0x7e; // show leaf_bridge_south_3_1
                // object[0x21] = 0x7e; // show leaf_bridge_south_3_2
                // object[0x22] = 0x7e; // show leaf_bridge_south_3_3
                // object[0x23] = 0x7e; // show leaf_bridge_south_3_4
                // ???
                // object[0x27] = 0x7e; // show leaf_bridge_west_1
                // object[0x28] = 0x7e; // show leaf_bridge_west_2
                // object[0x29] = 0x7e; // show leaf_bridge_west_3
                // ???
                // object[0x2a] = 0x7e; // show leaf_bridge_center_1
                // object[0x2b] = 0x7e; // show leaf_bridge_center_1
                // object[0x2c] = 0x7e; // show leaf_bridge_east_1
                // object[0x2d] = 0x7e; // show leaf_bridge_east_2
                // ???
                // object[0x35] = 0x01; // loot gourd_south_east (wax)
                // object[0x36] = 0x01; // loot gourd_south (dog biscuit)
                // object[0x37] = 0x01; // loot gourd_south_west (nectar)
                // object[0x38] = 0x01; // loot gourd_north_west_1 (clay)
                // object[0x39] = 0x01; // loot gourd_north_west_2 (roots)
                // object[0x3a] = 0x01; // loot gourd_north_east (call beads)
                // object[0x3b] = 0x01; // loot gourd_east (oil)

                fade_in();
            }
        };

        map salabog(SALABOG) {
            enum entrance {
                hut = entrance(0x1b, 0x11, SOUTH),
                south = entrance(0x1c, 0x61, NORTH)
            }

            enum stepon_trigger {
                exit_hut = @install() {
                    debug_subtext("S=0");
                    map_transition(village_huts__hut_3_3, door, NORTH);
                },
                exit_south = @install() {
                    debug_subtext("S=1");
                    map_transition(swamp, north, SOUTH);
                },
                spawn_boss = @install() {
                    debug_subtext("S=2");
                }
            }

            fun trigger_enter() {
                fade_in();
            }
        };

        map village_huts__hut_3_3(VILLAGE_HUTS) {
            enum entrance {
                door = entrance(0x54, 0x6f, NORTH),
            }

            enum stepon_trigger {
                exit_door = @install() {
                    debug_subtext("S=0");
                    map_transition(salabog, hut, SOUTH);
                },
                exit_door_3_2 = nop(),
                exit_door_3_1 = nop(),
                exit_door_2_3 = nop(),
                exit_door_2_2 = nop(),
                exit_door_2_1 = nop(),
                exit_door_1_3 = nop(),
                exit_door_1_2 = nop(),
                exit_door_1_1 = nop(),
            }

            enum b_trigger {
                gourd_3__1_water = @install() {
                    debug_subtext("B=0");
                    _loot_chest(0x18, WATER, 0d01);
                },
                gourd_2__1_water = @install() {
                    debug_subtext("B=1");
                    _loot_chest(0x17, WATER, 0d01);
                },
                gourd_1__1_water = @install() {
                    debug_subtext("B=2");
                    _loot_chest(0x16, WATER, 0d01);
                },
                gourd_3_2_4__1_water = nop(),
                gourd_3_2_3__4_water = nop(),
                gourd_3_2_1__1_petal = nop(),
                gourd_3_2_2__2_clay = nop(),
                gourd_3_1_2__1_call_beads = nop(),
                gourd_3_1_1__1_water = nop(),
                gourd_2_3_2__2_water = nop(),

                gourd_2_3_1__1_roots = nop(),
                gourd_2_2_3__4_water = nop(),
                gourd_2_2_2__2_roots = nop(),
                gourd_2_2_1__1_water = nop(),
                gourd_2_1_3__3_clay = nop(),
                gourd_2_1_2__18_money = nop(),
                gourd_2_1_1__1_clay = nop(),
                gourd_1_3_3__2_roots = nop(),
                gourd_1_3_2__1_water = nop(),
                gourd_1_3_1__1_nectar = nop(),

                gourd_1_2_3__30_money = nop(),
                gourd_1_2_2__1_water = nop(),
                gourd_1_2_1__4_water = nop(),
                gourd_1_1_2__1_water = nop(),
                gourd_1_1_1__2_roots = nop(),
            }

            fun init_map(index) {
                if(index == 0x01) {
                    init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
                } else if(index == 0x02) {
                    init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
                } else if(index == 0x03) {
                    init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
                } else if(index == 0x04) {
                    init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
                } else if(index == 0x05) {
                    init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
                } else if(index == 0x06) {
                    init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
                } else if(index == 0x07) {
                    init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
                } else if(index == 0x08) {
                    init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
                } else if(index == 0x09) {
                    init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
                }
            }

            fun trigger_enter() {
                init_map(0x09);

                // object[0x16] = 0x01; // open gourd_3_3_1
                // object[0x17] = 0x01; // open gourd_3_3_2
                // object[0x18] = 0x01; // open gourd_3_3_3

                fade_in();
            }
        };
    };
};