#memory(
    string_key(0x0546)..string_key(0x232b), // last half of string keys
    function_key(0x0000)..function_key(0x1716), // 0x1719 seems to be used by the engine

    0x300000..0x3fffff, // extension

    // reserved: <0x23b9>
    <0x2265>..<0x22D9>, // vanilla sniff spots
    <0x236D>..<0x2378>, // act4 codes
    // <0x2379>..<0x237C>, // landing spots
    <0x253d>..<0x2558>, // sliver extension "save_file_growth" (excluded string params)

    <0x2834>..<0x28fb> // 199 room specific bytes
)
#include("in/core.evs")

#patch(
    // "void_maps",

    "skip_intro",
    // "brian",
    // "camera_hack",
    // "free_graveyard_ids",
    // "save_file_growth",

    // asm
    // "debug_menu", // uses 0x3f0000…???
    "_hook_input", // 0x3f0000…0x310000
        "hotkeys", // uses 0x3f00000…???
        // "room_timer", // uses 0x300000…???
    // "_hook_trigger",
)

// hotkeys

@install()
@inject(ADDRESS.HOTKEY_START)
fun hotkey_start() {
    debug_subtext("Start");
}
@install()
@inject(ADDRESS.HOTKEY_START_L)
fun hotkey_start_l() {
    debug_subtext("Start+L");

    if(True) {
        <0x2834> += 0x01;
    } else if(False) {
        MEMORY.MAP_PALETTE += 0d1;
    }
}
@install()
@inject(ADDRESS.HOTKEY_START_R)
fun hotkey_start_r() {
    debug_subtext("Start+R");

    if((<BOY>[FLAGS_2] & ATTRIBUTE_FLAGS.NO_CLIP) == 0d0) {
        attribute(BOY, NO_CLIP, True);
    } else {
        attribute(BOY, NO_CLIP, False);
    }

    debug_boy();
}

// helper

fun test_objects() {
    <0x2834> = 0x00;
    while(True) {
        <0x2836> = 0x00;
        while(<0x2836> < 0d3) {
            debug_memory(<0x2834>, <0x2836>);
            object[<0x2834>] = <0x2836>;
            sleep(0x50);
            <0x2836> += 0x01;
        }
        debug_memory(<0x2834>, 0x7e);
        object[<0x2834>] = 0x7e;
        sleep(0x50);
    }
}

// maps

@install(ADDRESS.INTRO_FIRST_CODE_EXECUTED)
fun intro_skip() {
    // act 1
    // map_transition(raptors, south, NONE);
    // map_transition(thraxx, south, NONE);
    // map_transition(graveyard, south, NONE);
    // map_transition(salabog, south, NONE);
    // map_transition(dungeon_volcano, north_1, NONE);
    // map_transition(pipe_rooms, pipe_west, NONE);
    // map_transition(pipe_maze, pipe_east, NONE);
    // map_transition(magmar, south, NONE);

    // act 2
    // map_transition(vigor, south, NONE);
    // map_transition(megataur, south, NONE);
    // map_transition(rimsala, south, NONE);
    // map_transition(aquagoth, south, NONE);

    // misc
    // map_transition(brians_room, center, NONE);

    map_transition(bugmuck, cave, NONE);
    // map_transition(vigor, south, NONE);
}

// act 0

// map intro(OPENING) {
//     enum entrance {
//         test = entrance(0x10, 0x10, NONE), // always 0/0
//     }
// 
//     fun trigger_enter() {
//         fade_in();
//     }
// };

map podunk_old(PODUNK_65) {
    enum entrance {
        north = entrance(0d09, 0d00, SOUTH),
        west = entrance(0d00, 0d19, EAST),

        cinema_left = entrance(0d64, 0d15, SOUTH),
        cinema_right = entrance(0d75, 0d15, SOUTH),
    }

    fun trigger_enter() {
        fade_in();
    }
};

map podunk_new(PODUNK_95) {
    enum entrance {
        north = entrance(0d09, 0d00, SOUTH),
        west = entrance(0d00, 0d19, EAST),

        cinema_left = entrance(0d64, 0d15, SOUTH),
        cinema_right = entrance(0d75, 0d15, SOUTH),
    }

    fun trigger_enter() {
        fade_in();
    }
};

map mansion_old(MANSION_65) {
    enum entrance {
        south = entrance(0d35, 0d111, NORTH),
    }

    fun trigger_enter() {
        fade_in();
    }
};

map mansion_modern(MANSION_95) {
    enum entrance {
        west = entrance(0d00, 0d106, EAST),
        south = entrance(0d19, 0d111, NORTH),
    }

    fun trigger_enter() {
        fade_in();
    }
};

// act 1

map flowers(FLOWERS) {
    enum entrance {
        north = entrance(0x62, 0x0b, SOUTH),
        west = entrance(0x04, 0x1f, EAST),

        start = entrance(0x46, 0x89, NORTH),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
            // map_transition(raptors, south, NORTH);
        },
        exit_south = @install() {
            debug_subtext("S=1");
        },
    }

    enum b_trigger {
        gourd__15_money = @install() {
            debug_subtext("B=0");
            _loot_chest(0x05, MONEY, 0d15);
        },
        gourd__1_petal = @install() {
            debug_subtext("B=1");
            _loot_chest(0x00, PETAL, 0d01);
        },
        gourd__1_petal = @install() {
            debug_subtext("B=2");
            _loot_chest(0x02, PETAL, 0d01);
        },
        gourd__1_nectar = @install() {
            debug_subtext("B=3");
            _loot_chest(0x04, NECTAR, 0d01);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=4");
            _loot(0x1c, CLAY, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=5");
            _loot(0x1b, ASH, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=6");
            _loot(0x1a, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x19, WATER, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=8");
            _loot(0x18, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=9");
            _loot(0x17, ASH, 0d01, 0d00);
        },

        sniff__1_water = @install() {
            debug_subtext("B=10");
            _loot(0x16, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=11");
            _loot(0x15, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x14, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=13");
            _loot(0x13, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=14");
            _loot(0x12, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=15");
            _loot(0x11, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x10, ROOTS, 0d01, 0d00);
        },
        sniff__2_roots = @install() {
            debug_subtext("B=17");
            _loot(0x0e, CLAY, 0d02, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=18");
            _loot(0x0f, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=19");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },

        sniff__1_water = @install() {
            debug_subtext("B=20");
            _loot(0x0b, WATER, 0d01, 0d00);
        },
        sniff__2_roots = @install() {
            debug_subtext("B=21");
            _loot(0x09, ROOTS, 0d02, 0d00); // same as B=22
        },
        sniff__2_roots = @install() {
            debug_subtext("B=22");
            _loot(0x09, ROOTS, 0d02, 0d00); // same as B=21
        },
        gourd__1_oil = @install() {
            debug_subtext("B=23");
            _loot_chest(0x01, OIL, 0x01);
        },
        gourd__shell_helmet = @install() {
            debug_subtext("B=24");
            _loot_chest(0x03, HELM_1_2, 0x01);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=25");
            _loot(0x0a, ROOTS, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=26");
            _loot(0x07, ASH, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=27");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=28");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=29");
            _loot(0x1d, WATER, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=30");
            _loot(0x1e, ROOTS, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        init_map(0x00, 0x02, 0x80, 0x96);

        fade_in();
        
        // object[0x00] = 0x01; // loot gourd (petal #1)
        // object[0x01] = 0x01; // loot gourd (oil)
        // object[0x02] = 0x01; // loot gourd (petal #2)
        // object[0x03] = 0x01; // loot gourd (shell hat)
        // object[0x04] = 0x01; // loot gourd (nectar)
        // object[0x05] = 0x01; // loot gourd (15 talons)
    }
};

map strongheart_inside(STRONGHEART) {
    enum entrance {
        door = entrance(0x12, 0x23, NORTH)
    }

    enum stepon_trigger {
        door = @install() {
            debug_subtext("S=0");
        }
    }

    enum b_trigger {
        gourd_1__1_oil = @install() {
            debug_subtext("B=0");
            _loot_chest(0x00, OIL, 0d01);
        },
        gourd_2__1_wax = @install() {
            debug_subtext("B=1");
            _loot_chest(0x02, WAX, 0d01);
        },
        gourd_3__1_wax = @install() {
            debug_subtext("B=2");
            _loot_chest(0x01, WAX, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // unload gourd_1
        // object[0x02] = 0x01; // unload gourd_2
        // object[0x01] = 0x01; // unload gourd_3

        fade_in();
    }
};

map raptors(RAPTORS) {
    enum entrance {
        north = entrance(0x1b, 0x03, SOUTH),
        south = entrance(0x1d, 0x33, NORTH),

        left = entrance(0x15, 0x1c, NONE),
        center = entrance(0x1e, 0x21, NONE),
        right = entrance(0x2a, 0x23, NONE)
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
            // map_transition(village, south, NORTH);
        },
        exit_south = @install() {
            debug_subtext("S=1");
            // map_transition(flowers, north, SOUTH);
        },
        center = @install() {
            debug_subtext("S=2");
        }
    }

    enum b_trigger {
        sniff__1_crystal_1 = @install() {
            debug_subtext("B=0");
            _loot(0x09, CRYSTAL, 0d01, 0d01);
        },
        sniff__1_oil_1 = @install() {
            debug_subtext("B=1");
            _loot(0x08, OIL, 0d01, 0d01);
        },
        sniff__1_crystal_2 = @install() {
            debug_subtext("B=2");
            _loot(0x07, CRYSTAL, 0d01, 0d02);
        },
        sniff__1_water_2 = @install() {
            debug_subtext("B=3");
            _loot(0x06, WATER, 0d01, 0d02);
        },
    }

    fun close_exits(close) {
        if(close) {
            object[0x04] = 0x04;
        } else {
            object[0x05] = 0x04;
        }
    }

    fun trigger_enter() {
        close_exits(False);

        fade_in();
    }
};

map village(VILLAGE) {
    enum entrance {
        north = entrance(0x59, 0x0d, SOUTH),
        east = entrance(0x7d, 0x65, WEST),
        south = entrance(0x59, 0x73, NORTH),
        west = entrance(0x01, 0x2f, EAST),

        hut_1 = entrance(0x0f, 0x1b, SOUTH),
        hut_2 = entrance(0x33, 0x2d, SOUTH),
        hut_3 = entrance(0x53, 0x2f, SOUTH),
        hut_4 = entrance(0x65, 0x36, SOUTH),
        hut_5 = entrance(0x6f, 0x49, SOUTH),
        hut_6 = entrance(0x45, 0x53, SOUTH),
        hut_7 = entrance(0x25, 0x5b, SOUTH),
        hut_8 = entrance(0x21, 0x3b, SOUTH),
    }

    enum stepon_trigger {
        exit_hut_1 = @install() {
            debug_subtext("S=0");
        },
        exit_hut_2 = @install() {
            debug_subtext("S=1");
        },
        exit_hut_3 = @install() {
            debug_subtext("S=2");
        },
        exit_hut_4 = @install() {
            debug_subtext("S=3");
        },
        exit_hut_5 = @install() {
            debug_subtext("S=4");
        },
        exit_hut_6 = @install() {
            debug_subtext("S=5");
        },
        exit_hut_7 = @install() {
            debug_subtext("S=6");
        },
        exit_hut8 = @install() {
            debug_subtext("S=7");
        },
        guard_east = @install() {
            debug_subtext("S=8");
        },
        exit_north = @install() {
            debug_subtext("S=9");
        },

        exit_south = @install() {
            debug_subtext("S=10");
            // map_transition(raptors, north, SOUTH);
        },
        exit_east = @install() {
            debug_subtext("S=11");
        },
        exit_west = @install() {
            debug_subtext("S=12");
        },
    }

    enum b_trigger {
        sniff__1_ash = @install() {
            debug_subtext("B=0");
            _loot(0x14, ASH, 0d01, 0d00); // object[0x12]=0x01; object[0x13]=0x01; ?
        },
        sniff__1_ash = @install() {
            debug_subtext("B=1");
            _loot(0x13, ASH, 0d01, 0d00); // object[0x12]=0x01; object[0x14]=0x01; ?
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x12, ASH, 0d01, 0d00); // object[0x13]=0x01; object[0x14]=0x01; ?
        },
        gourd__2_wax = @install() {
            debug_subtext("B=3");
            _loot_chest(0x00, WAX, 0d02);
        },
        sniff__1_water = @install() {
            debug_subtext("B=4");
            _loot(0x0c, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=5");
            _loot(0x0b, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=6");
            _loot(0x0a, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=7");
            _loot(0x09, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=8");
            _loot(0x08, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=9");
            _loot(0x07, OIL, 0d01, 0d00);
        },

        sniff__1_water = @install() {
            debug_subtext("B=10");
            _loot(0x06, WATER, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=11");
            _loot(0x05, OIL, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x04, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=13");
            _loot(0x03, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=14");
            _loot(0x02, OIL, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=15");
            _loot(0x0d, WATER, 0d01, 0d00); // object[0x0d]=0x01; ?
        },
        sniff__1_ash = @install() {
            debug_subtext("B=16");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=17");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=18");
            _loot(0x10, ASH, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=19");
            _loot(0x01, ROOTS, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // open gourd
        // … sniff spots?
        // object[0x11] = 0x01; // ignite fire

        fade_in();
    }
};

map village_huts(VILLAGE_HUTS) {
    enum entrance {
        door_1_1 = entrance(0x10, 0x23, NORTH),
        door_1_2 = entrance(0x32, 0x23, NORTH),
        door_1_3 = entrance(0x54, 0x23, NORTH),

        door_2_1 = entrance(0x10, 0x49, NORTH),
        door_2_2 = entrance(0x32, 0x49, NORTH),
        door_2_3 = entrance(0x54, 0x49, NORTH),

        door_3_1 = entrance(0x10, 0x6f, NORTH),
        door_3_2 = entrance(0x32, 0x6f, NORTH),
        door_3_3 = entrance(0x54, 0x6f, NORTH),

        inn_bed = entrance(0x5a, 0x14, NONE),
    }

    enum stepon_trigger {
        exit_door_3_3 = @install() {
            debug_subtext("S=0");
        },
        exit_door_3_2 = @install() {
            debug_subtext("S=1");
        },
        exit_door_3_1 = @install() {
            debug_subtext("S=2");
        },
        exit_door_2_3 = @install() {
            debug_subtext("S=3");
        },
        exit_door_2_2 = @install() {
            debug_subtext("S=4");
        },
        exit_door_2_1 = @install() {
            debug_subtext("S=5");
        },
        exit_door_1_3 = @install() {
            debug_subtext("S=6");
        },
        exit_door_1_2 = @install() {
            debug_subtext("S=7");
        },
        exit_door_1_1 = @install() {
            debug_subtext("S=8");
        },
    }

    enum b_trigger {
        gourd_3_3_3__1_water = @install() {
            debug_subtext("B=0");
            _loot_chest(0x18, WATER, 0d01);
        },
        gourd_3_3_2__1_water = @install() {
            debug_subtext("B=1");
            _loot_chest(0x17, WATER, 0d01);
        },
        gourd_3_3_1__1_water = @install() {
            debug_subtext("B=2");
            _loot_chest(0x16, WATER, 0d01);
        },
        gourd_3_2_4__1_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x15, WATER, 0d01);
        },
        gourd_3_2_3__4_water = @install() {
            debug_subtext("B=4");
            _loot_chest(0x14, WATER, 0d04);
        },
        gourd_3_2_1__1_petal = @install() {
            debug_subtext("B=5");
            _loot_chest(0x12, PETAL, 0d01);
        },
        gourd_3_2_2__2_clay = @install() {
            debug_subtext("B=6");
            _loot_chest(0x13, CLAY, 0d02);
        },
        gourd_3_1_2__1_call_beads = @install() {
            debug_subtext("B=7");
            // _loot_chest(0x11, BISCUIT, 0d01);
            _loot_chest(0x11, CALL_BEADS, 0d01);
        },
        gourd_3_1_1__1_water = @install() {
            debug_subtext("B=8");
            _loot_chest(0x10, WATER, 0d01);
        },
        gourd_2_3_2__2_water = @install() {
            debug_subtext("B=9");
            _loot_chest(0x0f, WATER, 0d02);
        },

        gourd_2_3_1__1_roots = @install() {
            debug_subtext("B=10");
            _loot_chest(0x0e, ROOTS, 0d01);
        },
        gourd_2_2_3__4_water = @install() {
            debug_subtext("B=11");
            _loot_chest(0x0d, WATER, 0d04);
        },
        gourd_2_2_2__2_roots = @install() {
            debug_subtext("B=12");
            _loot_chest(0x0c, ROOTS, 0d02);
        },
        gourd_2_2_1__1_water = @install() {
            debug_subtext("B=13");
            _loot_chest(0x0b, WATER, 0d01);
        },
        gourd_2_1_3__3_clay = @install() {
            debug_subtext("B=14");
            _loot_chest(0x0a, CLAY, 0d03);
        },
        gourd_2_1_2__18_money = @install() {
            debug_subtext("B=15");
            _loot_chest(0x09, MONEY, 0d18);
        },
        gourd_2_1_1__1_clay = @install() {
            debug_subtext("B=16");
            _loot_chest(0x08, CLAY, 0d01);
        },
        gourd_1_3_3__2_roots = @install() {
            debug_subtext("B=17");
            _loot_chest(0x07, ROOTS, 0d02);
        },
        gourd_1_3_2__1_water = @install() {
            debug_subtext("B=18");
            _loot_chest(0x06, WATER, 0d01);
        },
        gourd_1_3_1__1_nectar = @install() {
            debug_subtext("B=19");
            _loot_chest(0x05, NECTAR, 0d01);
        },

        gourd_1_2_3__30_money = @install() {
            debug_subtext("B=20");
            _loot_chest(0x04, MONEY, 0d30);
        },
        gourd_1_2_2__1_water = @install() {
            debug_subtext("B=21");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_1_2_1__4_water = @install() {
            debug_subtext("B=22");
            _loot_chest(0x02, WATER, 0d03);
        },
        gourd_1_1_2__1_water = @install() {
            debug_subtext("B=23");
            _loot_chest(0x01, WATER, 0d01);
        },
        gourd_1_1_1__2_roots = @install() {
            debug_subtext("B=24");
            _loot_chest(0x00, ROOTS, 0d02);
        },
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        // init_map(0x07);

        // object[0x00] = 0x01; // open gourd_1_1_1
        // object[0x01] = 0x01; // open gourd_1_1_2
        // object[0x02] = 0x01; // open gourd_1_2_1
        // object[0x03] = 0x01; // open gourd_1_2_2
        // object[0x04] = 0x01; // open gourd_1_2_3
        // object[0x05] = 0x01; // open gourd_1_3_1
        // object[0x06] = 0x01; // open gourd_1_3_2
        // object[0x07] = 0x01; // open gourd_1_3_3

        // object[0x08] = 0x01; // open gourd_2_1_1
        // object[0x09] = 0x01; // open gourd_2_1_2
        // object[0x0a] = 0x01; // open gourd_2_1_3
        // object[0x0b] = 0x01; // open gourd_2_2_1
        // object[0x0c] = 0x01; // open gourd_2_2_2
        // object[0x0d] = 0x01; // open gourd_2_2_3
        // object[0x0e] = 0x01; // open gourd_2_3_1
        // object[0x0f] = 0x01; // open gourd_2_3_2

        // object[0x10] = 0x01; // open gourd_3_1_1
        // object[0x11] = 0x01; // open gourd_3_1_2
        // object[0x12] = 0x01; // open gourd_3_2_1
        // object[0x13] = 0x01; // open gourd_3_2_2
        // object[0x14] = 0x01; // open gourd_3_2_3
        // object[0x15] = 0x01; // open gourd_3_2_4
        // object[0x16] = 0x01; // open gourd_3_3_1
        // object[0x17] = 0x01; // open gourd_3_3_2
        // object[0x18] = 0x01; // open gourd_3_3_3

        fade_in();
    }
};
map village_huts__hut_1_1(VILLAGE_HUTS) { // variant 1_1
    enum entrance {
        door = entrance(0x10, 0x23, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door = @install() {
            debug_subtext("S=8");
        },
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_2 = @install() {
            debug_subtext("B=23");
            _loot_chest(0x01, WATER, 0d01);
        },
        gourd_1_1_1 = @install() {
            debug_subtext("B=24");
            _loot_chest(0x00, ROOTS, 0d01);
        },
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x01);

        // object[0x00] = 0x01; // open gourd_1_1_1
        // object[0x01] = 0x01; // open gourd_1_1_2

        fade_in();
    }
};
map village_huts__hut_1_2(VILLAGE_HUTS) { // variant 1_2
    enum entrance {
        door = entrance(0x32, 0x23, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door = @install() {
            debug_subtext("S=7");
        },
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_3__30_money = @install() {
            debug_subtext("B=20");
            _loot_chest(0x04, MONEY, 0d30);
        },
        gourd_2__1_water = @install() {
            debug_subtext("B=21");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_1__4_water = @install() {
            debug_subtext("B=22");
            _loot_chest(0x02, WATER, 0d03);
        },
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x02);

        // object[0x02] = 0x01; // open gourd_1_2_1
        // object[0x03] = 0x01; // open gourd_1_2_2
        // object[0x04] = 0x01; // open gourd_1_2_3

        fade_in();
    }
};
map village_huts__hut_1_3(VILLAGE_HUTS) { // variant 1_3
    enum entrance {
        door = entrance(0x54, 0x23, NORTH),
        
        cinematic_bed = entrance(0x5a, 0x14, NONE),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door = @install() {
            debug_subtext("S=6");
        },
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_3__2_roots = @install() {
            debug_subtext("B=17");
            _loot_chest(0x07, ROOTS, 0d02);
        },
        gourd_2__1_water = @install() {
            debug_subtext("B=18");
            _loot_chest(0x06, WATER, 0d01);
        },
        gourd_1__1_nectar = @install() {
            debug_subtext("B=19");
            _loot_chest(0x05, NECTAR, 0d01);
        },

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x03);

        // object[0x05] = 0x01; // open gourd_1_3_1
        // object[0x06] = 0x01; // open gourd_1_3_2
        // object[0x07] = 0x01; // open gourd_1_3_3

        fade_in();
    }
};
map village_huts__hut_2_1(VILLAGE_HUTS) { // variant 2_1
    enum entrance {
        door = entrance(0x10, 0x49, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door = @install() {
            debug_subtext("S=5");
        },
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_3__3_clay = @install() {
            debug_subtext("B=14");
            _loot_chest(0x0a, CLAY, 0d03);
        },
        gourd_2__18_money = @install() {
            debug_subtext("B=15");
            _loot_chest(0x09, MONEY, 0d18);
        },
        gourd_1__1_clay = @install() {
            debug_subtext("B=16");
            _loot_chest(0x08, CLAY, 0d01);
        },
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x04);

        // object[0x08] = 0x01; // open gourd_2_1_1
        // object[0x09] = 0x01; // open gourd_2_1_2
        // object[0x0a] = 0x01; // open gourd_2_1_3

        fade_in();
    }
};
map village_huts__hut_2_2(VILLAGE_HUTS) { // variant 2_2
    enum entrance {
        door = entrance(0x32, 0x49, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door = @install() {
            debug_subtext("S=4");
        },
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1 = nop(),
        gourd_3__4_water = @install() {
            debug_subtext("B=11");
            _loot_chest(0x0d, WATER, 0d04);
        },
        gourd_2__2_roots = @install() {
            debug_subtext("B=12");
            _loot_chest(0x0c, ROOTS, 0d02);
        },
        gourd_1__1_water = @install() {
            debug_subtext("B=13");
            _loot_chest(0x0b, WATER, 0d01);
        },
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x05);

        // object[0x0b] = 0x01; // open gourd_2_2_1
        // object[0x0c] = 0x01; // open gourd_2_2_2
        // object[0x0d] = 0x01; // open gourd_2_2_3

        fade_in();
    }
};
map village_huts__hut_2_3(VILLAGE_HUTS) { // variant 2_3
    enum entrance {
        door = entrance(0x54, 0x49, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door = @install() {
            debug_subtext("S=3");
        },
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2__2_water = @install() {
            debug_subtext("B=9");
            _loot_chest(0x0f, WATER, 0d02);
        },

        gourd_1__1_roots = @install() {
            debug_subtext("B=10");
            _loot_chest(0x0e, ROOTS, 0d01);
        },
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x06);

        // object[0x0e] = 0x01; // open gourd_2_3_1
        // object[0x0f] = 0x01; // open gourd_2_3_2

        fade_in();
    }
};
map village_huts__hut_3_1(VILLAGE_HUTS) { // variant 3_1 (fire eyes)
    enum entrance {
        door = entrance(0x10, 0x6f, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door_3_2 = nop(),
        exit_door = @install() {
            debug_subtext("S=2");
        },
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_2__1_call_beads = @install() {
            debug_subtext("B=7");
            // _loot_chest(0x11, BISCUIT, 0d01);
            _loot_chest(0x11, CALL_BEADS, 0d01);
        },
        gourd_1__1_water = @install() {
            debug_subtext("B=8");
            _loot_chest(0x10, WATER, 0d01);
        },
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x07);

        // object[0x10] = 0x01; // open gourd_3_1_1
        // object[0x11] = 0x01; // open gourd_3_1_2

        fade_in();
    }
};
map village_huts__hut_3_2(VILLAGE_HUTS) { // variant 3_2
    enum entrance {
        door = entrance(0x32, 0x6f, NORTH),
    }

    enum stepon_trigger {
        exit_door_3_3 = nop(),
        exit_door = @install() {
            debug_subtext("S=1");
        },
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3_3_3__1_water = nop(),
        gourd_3_3_2__1_water = nop(),
        gourd_3_3_1__1_water = nop(),
        gourd_4__1_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x15, WATER, 0d01);
        },
        gourd_3__4_water = @install() {
            debug_subtext("B=4");
            _loot_chest(0x14, WATER, 0d04);
        },
        gourd_1__1_petal = @install() {
            debug_subtext("B=5");
            _loot_chest(0x12, PETAL, 0d01);
        },
        gourd_2__2_clay = @install() {
            debug_subtext("B=6");
            _loot_chest(0x13, CLAY, 0d02);
        },
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x08);

        // object[0x12] = 0x01; // open gourd_3_2_1
        // object[0x13] = 0x01; // open gourd_3_2_2
        // object[0x14] = 0x01; // open gourd_3_2_3
        // object[0x15] = 0x01; // open gourd_3_2_4

        fade_in();
    }
};
map village_huts__hut_3_3(VILLAGE_HUTS) { // variant 3_3
    enum entrance {
        door = entrance(0x54, 0x6f, NORTH),
    }

    enum stepon_trigger {
        exit_door = @install() {
            debug_subtext("S=0");
        },
        exit_door_3_2 = nop(),
        exit_door_3_1 = nop(),
        exit_door_2_3 = nop(),
        exit_door_2_2 = nop(),
        exit_door_2_1 = nop(),
        exit_door_1_3 = nop(),
        exit_door_1_2 = nop(),
        exit_door_1_1 = nop(),
    }

    enum b_trigger {
        gourd_3__1_water = @install() {
            debug_subtext("B=0");
            _loot_chest(0x18, WATER, 0d01);
        },
        gourd_2__1_water = @install() {
            debug_subtext("B=1");
            _loot_chest(0x17, WATER, 0d01);
        },
        gourd_1__1_water = @install() {
            debug_subtext("B=2");
            _loot_chest(0x16, WATER, 0d01);
        },
        gourd_3_2_4__1_water = nop(),
        gourd_3_2_3__4_water = nop(),
        gourd_3_2_1__1_petal = nop(),
        gourd_3_2_2__2_clay = nop(),
        gourd_3_1_2__1_call_beads = nop(),
        gourd_3_1_1__1_water = nop(),
        gourd_2_3_2__2_water = nop(),

        gourd_2_3_1__1_roots = nop(),
        gourd_2_2_3__4_water = nop(),
        gourd_2_2_2__2_roots = nop(),
        gourd_2_2_1__1_water = nop(),
        gourd_2_1_3__3_clay = nop(),
        gourd_2_1_2__18_money = nop(),
        gourd_2_1_1__1_clay = nop(),
        gourd_1_3_3__2_roots = nop(),
        gourd_1_3_2__1_water = nop(),
        gourd_1_3_1__1_nectar = nop(),

        gourd_1_2_3__30_money = nop(),
        gourd_1_2_2__1_water = nop(),
        gourd_1_2_1__4_water = nop(),
        gourd_1_1_2__1_water = nop(),
        gourd_1_1_1__2_roots = nop(),
    }

    fun init_map(index) {
        if(index == 0x01) {
            init_map(0x00, 0x00, 0x20, 0x24); // hut_1_1
        } else if(index == 0x02) {
            init_map(0x22, 0x00, 0x42, 0x24); // hut_1_2
        } else if(index == 0x03) {
            init_map(0x44, 0x00, 0x64, 0x24); // hut_1_3
        } else if(index == 0x04) {
            init_map(0x00, 0x26, 0x20, 0x4a); // hut_2_1
        } else if(index == 0x05) {
            init_map(0x22, 0x26, 0x42, 0x4a); // hut_2_2
        } else if(index == 0x06) {
            init_map(0x44, 0x26, 0x64, 0x4a); // hut_2_3
        } else if(index == 0x07) {
            init_map(0x00, 0x4c, 0x20, 0x70); // hut_3_1
        } else if(index == 0x08) {
            init_map(0x22, 0x4c, 0x42, 0x70); // hut_3_2 ?
        } else if(index == 0x09) {
            init_map(0x44, 0x4c, 0x64, 0x70); // hut_3_3
        }
    }

    fun trigger_enter() {
        init_map(0x09);

        // object[0x16] = 0x01; // open gourd_3_3_1
        // object[0x17] = 0x01; // open gourd_3_3_2
        // object[0x18] = 0x01; // open gourd_3_3_3

        fade_in();
    }
};

map defend(DEFEND) {
    enum entrance {
        east = entrance(0x26, 0x13, WEST),
    }

    enum stepon_trigger {
        exit_east = @install() {
            debug_subtext("S=0");
        },
    }

    enum b_trigger {
        gourd_2__1_call_beads = @install() {
            debug_subtext("B=0");
            // _loot_chest(0x00, BISCUIT, 0x01);
            _loot_chest(0x00, CALL_BEADS, 0x01);
        },
        gourd_1__4_clay = @install() {
            debug_subtext("B=1");
            _loot_chest(0x01, CLAY, 0d04);
        },
        gourd_3__5_ash = @install() {
            debug_subtext("B=2");
            _loot_chest(0x02, ASH, 0d05);
        },
    }

    fun trigger_enter() {
        // object[0x01] = 0x01; // loot gourd_1
        // object[0x00] = 0x01; // loot gourd_2
        // object[0x02] = 0x01; // loot gourd_3

        fade_in();
    }
};

map east_jungle(EAST_JUNGLE) {
    enum entrance {
        north = entrance(0x12, 0x09, SOUTH),
        east_1 = entrance(0x6d, 0x11, WEST),
        east_2 = entrance(0x6d, 0x23, WEST),
        east_3 = entrance(0x6d, 0x35, WEST),
        west = entrance(0x01, 0x37, EAST),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
    }

    enum b_trigger {
        sniff__1_clay = @install() {
            debug_subtext("B=0");
            _loot(0x0a, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=1");
            _loot(0x09, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=2");
            _loot(0x08, CLAY, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=3");
            _loot(0x07, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x06, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=5");
            _loot(0x05, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x04, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x03, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x0c, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=9");
            _loot(0x0b, WATER, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x02, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=11");
            _loot(0x01, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x00, WATER, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=13");
            _loot(0x0d, CLAY, 0d01, 0d00); // same as B=16
        },
        sniff__1_water = @install() {
            debug_subtext("B=14");
            _loot(0x0c, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=15");
            _loot(0x0b, WATER, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=16");
            _loot(0x0d, CLAY, 0d01, 0d00); // same as B=13
        },
    }

    fun trigger_enter() {
        init_map(0x00, 0x06, 0x6e, 0x52);
        
        fade_in();
    }
};

map jungle_firepit(FIREPIT_JUNGLE) {
    enum entrance {
        south = entrance(0x17, 0x2c, NORTH),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
    }

    enum b_trigger {
        sniff__1_clay_2 = @install() {
            debug_subtext("B=0");
            _loot(0x06, CLAY, 0d01, 0d02);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=1");
            _loot(0x05, ASH, 0d01, 0d01);
        },
        sniff__1_oil_1 = @install() {
            debug_subtext("B=2");
            _loot(0x04, OIL, 0d01, 0d01);
        },
        sniff__1_oil_3 = @install() {
            debug_subtext("B=3");
            _loot(0x03, OIL, 0d01, 0d03);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x02; // add windwalker_hitbox
        // object[0x01] = 0x01; // ignite firepit
        // object[0x02] = 0x01; // show dog_statue

        fade_in();
    }
};

map sandpits(SANDPITS) {
    enum entrance {
        east = entrance(0x73, 0x22, WEST),
        cave = entrance(0x42, 0x1a, SOUTH),
        south_1 = entrance(0x44, 0x9e, NORTH),
        south_2 = entrance(0x33, 0x9e, NORTH),
        west_1 = entrance(0x01, 0x2a, EAST),
        west_2 = entrance(0x01, 0x22, EAST),
        west_3 = entrance(0x01, 0x15, EAST)
    }

    enum stepon_trigger {
        center_bottleneck = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        sandpit_5_2_west = @install() {
            debug_subtext("S=2");
        },
        sandpit_5_2_north = @install() {
            debug_subtext("S=3");
        },
        sandpit_4_1_east = @install() {
            debug_subtext("S=4");
        },
        sandpit_4_1_south = @install() {
            debug_subtext("S=5");
        },
        sandpit_4_1 = @install() {
            debug_subtext("S=6");
        },
        sandpit_2_north = @install() {
            debug_subtext("S=7");
        },
        sandpit_2 = @install() {
            debug_subtext("S=8");
        },
        sandpit_8_east = @install() {
            debug_subtext("S=9");
        },

        sandpit_6_north = @install() {
            debug_subtext("S=10");
        },
        sandpit_6_west = @install() {
            debug_subtext("S=11");
        },
        sandpit_6 = @install() {
            debug_subtext("S=12");
        },
        sandpit_9 = @install() {
            debug_subtext("S=13");
        },
        sandpit_10_3 = @install() {
            debug_subtext("S=14");
        },
        sandpit_10_2 = @install() {
            debug_subtext("S=15");
        },
        sandpit_10_1 = @install() {
            debug_subtext("S=16");
        },
        sandpit_8 = @install() {
            debug_subtext("S=17");
        },
        sandpit_7 = @install() {
            debug_subtext("S=8");
        },
        sandpit_5_1 = @install() {
            debug_subtext("S=19");
        },

        sandpit_4_2 = @install() {
            debug_subtext("S=20");
        },
        sandpit_3_2 = @install() {
            debug_subtext("S=21");
        },
        stepon_22 = @install() {
            debug_subtext("S=22");
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        exit_west_1 = @install() {
            debug_subtext("S=24");
        },
        exit_cave = @install() {
            debug_subtext("S=25");
        },
        exit_south_1 = @install() {
            debug_subtext("S=26");
        },
        exit_south_2 = @install() {
            debug_subtext("S=27");
        },
        exit_west_2 = @install() {
            debug_subtext("S=28");
        },
        exit_west_3 = @install() {
            debug_subtext("S=29");
        },

        sandpit_1_1 = @install() {
            debug_subtext("S=30");
        },
        sandpit_1_1_west = @install() {
            debug_subtext("S=31");
        },
        sandpit_3_2_west = @install() {
            debug_subtext("S=32");
        },
        sandpit_4_2_south = @install() {
            debug_subtext("S=33");
        },
        sandpit_5_1_south = @install() {
            debug_subtext("S=34");
        },
        sandpit_7_north = @install() {
            debug_subtext("S=35");
        },
        sandpit_9_north = @install() {
            debug_subtext("S=36");
        },
        sandpit_10_2_north = @install() {
            debug_subtext("S=37");
        },
        sandpit_10_3_north = @install() {
            debug_subtext("S=38");
        },
        sandpit_cave_north = @install() {
            debug_subtext("S=39");
        },

        sandpit_cave = @install() {
            debug_subtext("S=40");
        },
        sandpit_5_1_north = @install() {
            debug_subtext("S=41");
        },
        sandpit_1_2_west = @install() {
            debug_subtext("S=42");
        },
        sandpit_1_2_east = @install() {
            debug_subtext("S=43");
        },
        sandpit_3_1_north = @install() {
            debug_subtext("S=44");
        },
        sandpit_2_east = @install() {
            debug_subtext("S=45");
        },
        sandpit_3_1_south = @install() {
            debug_subtext("S=46");
        },
        sandpit_4_3_west = @install() {
            debug_subtext("S=47");
        },
        sandpit_4_3_north = @install() {
            debug_subtext("S=48");
        },
        sandpit_4_3 = @install() {
            debug_subtext("S=49");
        },

        sandpit_5_2 = @install() {
            debug_subtext("S=50");
        },
        sandpit_1_2 = @install() {
            debug_subtext("S=51");
        },
        sandpit_3_1 = @install() {
            debug_subtext("S=52");
        },
        sandpit_4_1 = @install() {
            debug_subtext("S=53");
        },
        sandpit_8_west = @install() {
            debug_subtext("S=54");
        },
        sandpit_8_north = @install() {
            debug_subtext("S=55");
        },
        sandpit_10_3_east = @install() {
            debug_subtext("S=56");
        },
        sanpit_7_south = @install() {
            debug_subtext("S=57");
        },
        sanpit_7_east = @install() {
            debug_subtext("S=58");
        },
        sandpit_3_2_east = @install() {
            debug_subtext("S=59");
        },

        sandpit_4_2_north = @install() {
            debug_subtext("S=60");
        },
        sandpit_4_2_east = @install() {
            debug_subtext("S=61");
        },
        sandpit_10_1_north = @install() {
            debug_subtext("S=62");
        },
        sandpit_10_1_west = @install() {
            debug_subtext("S=63");
        },
        exit_east = @install() {
            debug_subtext("S=64");
        }
    }

    enum b_trigger {
        sniff__1_wax = @install() {
            debug_subtext("B=0");
            _loot(0x2c, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=1");
            _loot(0x2e, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=2");
            _loot(0x2d, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=3");
            _loot(0x16, WAX, 0d01, 0d00);
        },
        gourd_south__4_crystal = @install() {
            debug_subtext("B=4");
            _loot_chest(0x02, CRYSTAL, 0d04);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=5");
            _loot(0x17, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=6");
            _loot(0x18, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=7");
            _loot(0x19, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=8");
            _loot(0x1a, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=9");
            _loot(0x1b, ASH, 0d01, 0d00);
        },

        sniff__1_ash = @install() {
            debug_subtext("B=10");
            _loot(0x1c, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot(0x1d, ASH, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=12");
            _loot(0x1e, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=13");
            _loot(0x1f, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=14");
            _loot(0x20, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=15");
            _loot(0x21, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x22, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=17");
            _loot(0x23, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=18");
            _loot(0x24, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=19");
            _loot(0x25, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=20");
            _loot(0x26, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=21");
            _loot(0x29, CLAY, 0d01, 0d00);
        },
        gourd_hidden_west__1_clay = @install() {
            debug_subtext("B=22");
            _loot_chest(0x29, CLAY, 0d01);
        },
        gourd_hidden_north_3__1_water = @install() {
            debug_subtext("B=23");
            _loot_chest(0x2a, WATER, 0d01);
        },
        gourd_hidden_north_2__1_biscuit = @install() {
            debug_subtext("B=24");
            _loot_chest(0x28, BISCUIT, 0d01);
        },
        gourd_hidden_north_1__1_clay = @install() {
            debug_subtext("B=25");
            _loot_chest(0x27, CLAY, 0d01);
        },
        gourd_west__1_petal = @install() {
            debug_subtext("B=26");
            _loot_chest(0x00, PETAL, 0d01);
        },
        gourd_north = @install() {
            debug_subtext("B=27");
            _loot_chest(0x01, WAX, 0d04);
        }
    }

    fun open_sandpits(open) {
        if(open) {
            object[0x04] = 0x04; // open sandpit_1_1
            object[0x12] = 0x04; // open sandpit_1_2
            object[0x03] = 0x04; // open sandpit_2
            object[0x13] = 0x04; // open sandpit_3_1
            object[0x05] = 0x04; // open sandpit_3_2
            object[0x14] = 0x04; // open sandpit_4_1
            object[0x06] = 0x04; // open sandpit_4_2
            object[0x10] = 0x04; // open sandpit_4_3
            object[0x07] = 0x04; // open sandpit_5_1
            object[0x11] = 0x04; // open sandpit_5_2
            object[0x08] = 0x04; // open sandpit_6
            object[0x09] = 0x04; // open sandpit_7
            object[0x0a] = 0x04; // open sandpit_8
            object[0x0b] = 0x04; // open sandpit_9
            object[0x0c] = 0x04; // open sandpit_10_1
            object[0x0d] = 0x04; // open sandpit_10_2
            object[0x0e] = 0x04; // open sandpit_10_3
            object[0x0f] = 0x04; // open sandpit_cave
        } else {
            object[0x04] = 0x00; // open sandpit_1_1
            object[0x12] = 0x00; // open sandpit_1_2
            object[0x03] = 0x00; // open sandpit_2
            object[0x13] = 0x00; // open sandpit_3_1
            object[0x05] = 0x00; // open sandpit_3_2
            object[0x14] = 0x00; // open sandpit_4_1
            object[0x06] = 0x00; // open sandpit_4_2
            object[0x10] = 0x00; // open sandpit_4_3
            object[0x07] = 0x00; // open sandpit_5_1
            object[0x11] = 0x00; // open sandpit_5_2
            object[0x08] = 0x00; // open sandpit_6
            object[0x09] = 0x00; // open sandpit_7
            object[0x0a] = 0x00; // open sandpit_8
            object[0x0b] = 0x00; // open sandpit_9
            object[0x0c] = 0x00; // open sandpit_10_1
            object[0x0d] = 0x00; // open sandpit_10_2
            object[0x0e] = 0x00; // open sandpit_10_3
            object[0x0f] = 0x00; // open sandpit_cave
        }
    }

    fun trigger_enter() {
        open_sandpits(True);

        fade_in();

        // object[0x00] = 0x01; // open gourd_west
        // object[0x01] = 0x01; // open gourd_north
        // object[0x02] = 0x01; // open gourd_south

        // object[0x04] = 0x04; // open sandpit_1_1
        // object[0x12] = 0x04; // open sandpit_1_2
        // object[0x03] = 0x04; // open sandpit_2
        // object[0x13] = 0x04; // open sandpit_3_1
        // object[0x05] = 0x04; // open sandpit_3_2
        // object[0x14] = 0x04; // open sandpit_4_1
        // object[0x06] = 0x04; // open sandpit_4_2
        // object[0x10] = 0x04; // open sandpit_4_3
        // object[0x07] = 0x04; // open sandpit_5_1
        // object[0x11] = 0x04; // open sandpit_5_2
        // object[0x08] = 0x04; // open sandpit_6
        // object[0x09] = 0x04; // open sandpit_7
        // object[0x0a] = 0x04; // open sandpit_8
        // object[0x0b] = 0x04; // open sandpit_9
        // object[0x0c] = 0x04; // open sandpit_10_1
        // object[0x0d] = 0x04; // open sandpit_10_2
        // object[0x0e] = 0x04; // open sandpit_10_3
        // object[0x0f] = 0x04; // open sandpit_cave

        // sniff spots

        // object[0x27] = 0x01; // open gourd_hidden_north_1
        // object[0x28] = 0x01; // open gourd_hidden_north_2
        // object[0x29] = 0x01; // open gourd_hidden_west
        // object[0x2a] = 0x01; // open gourd_hidden_north_3
    }
};

map acid_rain(ACID_RAIN) {
    enum entrance {
        west = entrance(0x01, 0x16, EAST),
    }

    enum stepon_trigger {
        exit_west = @install() {
            debug_subtext("S=0");
        },
    }

    enum b_trigger {
        gourd_2__4_ash = @install() {
            debug_subtext("B=0");
            _loot_chest(0x01, ASH, 0d04);
        },
        gourd_1__4_water = @install() {
            debug_subtext("B=1");
            _loot_chest(0x00, WATER, 0d04);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // loot gourd_1
        // object[0x01] = 0x01; // loot gourd_2

        fade_in();
    }
};

map act1_caves(ACT1_2_CAVES) {
    enum entrance {
        south_jaguar_ring = entrance(0x18, 0x29, NORTH), // entrance(0x17, 0x29, NORTH),
        south_raptors = entrance(0x40, 0x2d, NORTH),
        south_hard_ball = entrance(0x6e, 0x29, NORTH),
        south_inn = entrance(0x96, 0x29, NORTH),
        south_drain = entrance(0xc2, 0x29, NORTH),
    }

    enum stepon_trigger {
        exit_south_drain = @install() {
            debug_subtext("S=0");
        },
        exit_south_raptors = @install() {
            debug_subtext("S=1");
        },
        exit_south_jaguar_ring = @install() {
            debug_subtext("S=2");
        },
        exit_south_hard_ball = @install() {
            debug_subtext("S=3");
        },
        exit_south_inn = @install() {
            debug_subtext("S=4");
        },
    }

    enum b_trigger {
        gourd_drain_2__1_roots = @install() {
            debug_subtext("B=0");
            _loot_chest(0x0c, ROOTS, 0d01);
        },
        gourd_drain_1__1_ethanol = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0b, ETHANOL, 0d01);
        },
        gourd_inn_2__1_water = @install() {
            debug_subtext("B=2");
            _loot_chest(0x07, WATER, 0d01);
        },
        gourd_inn_1__1_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x06, WATER, 0d01);
        },
        gourd_jaguar_ring_1__1_water = @install() {
            debug_subtext("B=4");
            _loot_chest(0x05, WATER, 0d01);
        },
        gourd_jaguar_ring_2__1_water = @install() {
            debug_subtext("B=5");
            _loot_chest(0x00, WATER, 0d01);
        },
        gourd_jaguar_ring_3__1_clay = @install() {
            debug_subtext("B=6");
            _loot_chest(0x01, CLAY, 0d01);
        },
        gourd_hard_ball_1__1_water = @install() {
            debug_subtext("B=7");
            _loot_chest(0x02, WATER, 0d01);
        },
        gourd_hard_ball_2__1_water = @install() {
            debug_subtext("B=8");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_hard_ball_3__1_clay = @install() {
            debug_subtext("B=9");
            _loot_chest(0x04, CLAY, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x05] = 0x01; // loot gourd_jaguar_ring_1
        // object[0x00] = 0x01; // loot gourd_jaguar_ring_2
        // object[0x01] = 0x01; // loot gourd_jaguar_ring_3
        // object[0x08] = 0x01; // hide raptors_stoble
        // object[0x09] = 0x01; // hide raptors_fire
        // object[0x0a] = 0x01; // hide raptors_rug
        // object[0x02] = 0x01; // loot gourd_hard_ball_1
        // object[0x03] = 0x01; // loot gourd_hard_ball_2
        // object[0x04] = 0x01; // loot gourd_hard_ball_3
        // object[0x06] = 0x01; // loot gourd_inn_1
        // object[0x07] = 0x01; // loot gourd_inn_2
        // object[0x0b] = 0x01; // loot gourd_drain_1
        // object[0x0c] = 0x01; // loot gourd_drain_2

        fade_in();
    }
};
map act1_caves__jaguar_ring(ACT1_2_CAVES) {
    enum entrance {
        south = entrance(0x18, 0x29, NORTH), // entrance(0x17, 0x29, NORTH),
    }

    enum stepon_trigger {
        exit_south_drain = nop(),
        exit_south_raptors = nop(),
        exit_south = @install() {
            debug_subtext("S=2");
        },
        exit_south_hard_ball = nop(),
        exit_south_inn = nop(),
    }

    enum b_trigger {
        gourd_drain_2__1_roots = nop(),
        gourd_drain_1__1_ethanol = nop(),
        gourd_inn_2__1_water = nop(),
        gourd_inn_1__1_water = nop(),
        gourd_1__1_water = @install() {
            debug_subtext("B=4");
            _loot_chest(0x05, WATER, 0d01);
        },
        gourd_2__1_water = @install() {
            debug_subtext("B=5");
            _loot_chest(0x00, WATER, 0d01);
        },
        gourd_3__1_clay = @install() {
            debug_subtext("B=6");
            _loot_chest(0x01, CLAY, 0d01);
        },
        gourd_hard_ball_1__1_water = nop(),
        gourd_hard_ball_2__1_water = nop(),
        gourd_hard_ball_3__1_clay = nop(),
    }

    fun trigger_enter() {
        // object[0x05] = 0x01; // loot gourd_jaguar_ring_1
        // object[0x00] = 0x01; // loot gourd_jaguar_ring_2
        // object[0x01] = 0x01; // loot gourd_jaguar_ring_3

        fade_in();
    }
};
map act1_caves__raptors(ACT1_2_CAVES) {
    enum entrance {
        south = entrance(0x40, 0x2d, NORTH),
    }

    enum stepon_trigger {
        exit_south_drain = nop(),
        exit_south = @install() {
            debug_subtext("S=1");
        },
        exit_south_jaguar_ring = nop(),
        exit_south_hard_ball = nop(),
        exit_south_inn = nop(),
    }

    enum b_trigger {
        gourd_drain_2__1_roots = nop(),
        gourd_drain_1__1_ethanol = nop(),
        gourd_inn_2__1_water = nop(),
        gourd_inn_1__1_water = nop(),
        gourd_jaguar_ring_1__1_water = nop(),
        gourd_jaguar_ring_2__1_water = nop(),
        gourd_jaguar_ring_3__1_clay = nop(),
        gourd_hard_ball_1__1_water = nop(),
        gourd_hard_ball_2__1_water = nop(),
        gourd_hard_ball_3__1_clay = nop(),
    }

    fun trigger_enter() {
        // object[0x08] = 0x01; // hide raptors_stoble
        // object[0x09] = 0x01; // hide raptors_fire
        // object[0x0a] = 0x01; // hide raptors_rug

        fade_in();
    }
};
map act1_caves__hard_ball(ACT1_2_CAVES) {
    enum entrance {
        south = entrance(0x6e, 0x29, NORTH),
    }

    enum stepon_trigger {
        exit_south_drain = nop(),
        exit_south_raptors = nop(),
        exit_south_jaguar_ring = nop(),
        exit_south = @install() {
            debug_subtext("S=3");
        },
        exit_south_inn = nop(),
    }

    enum b_trigger {
        gourd_drain_2__1_roots = nop(),
        gourd_drain_1__1_ethanol = nop(),
        gourd_inn_2__1_water = nop(),
        gourd_inn_1__1_water = nop(),
        gourd_jaguar_ring_1__1_water = nop(),
        gourd_jaguar_ring_2__1_water = nop(),
        gourd_jaguar_ring_3__1_clay = nop(),
        gourd_1__1_water = @install() {
            debug_subtext("B=7");
            _loot_chest(0x02, WATER, 0d01);
        },
        gourd_2__1_water = @install() {
            debug_subtext("B=8");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_3__1_clay = @install() {
            debug_subtext("B=9");
            _loot_chest(0x04, CLAY, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x02] = 0x01; // loot gourd_hard_ball_1
        // object[0x03] = 0x01; // loot gourd_hard_ball_2
        // object[0x04] = 0x01; // loot gourd_hard_ball_3

        fade_in();
    }
};
map act1_caves__inn(ACT1_2_CAVES) {
    enum entrance {
        south = entrance(0x96, 0x29, NORTH),
    }

    enum stepon_trigger {
        exit_south_drain = nop(),
        exit_south_raptors = nop(),
        exit_south_jaguar_ring = nop(),
        exit_south_hard_ball = nop(),
        exit_south = @install() {
            debug_subtext("S=4");
        },
    }

    enum b_trigger {
        gourd_drain_2__1_roots = nop(),
        gourd_drain_1__1_ethanol = nop(),
        gourd_2__1_water = @install() {
            debug_subtext("B=2");
            _loot_chest(0x07, WATER, 0d01);
        },
        gourd_1__1_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x06, WATER, 0d01);
        },
        gourd_jaguar_ring_1__1_water = nop(),
        gourd_jaguar_ring_2__1_water = nop(),
        gourd_jaguar_ring_3__1_clay = nop(),
        gourd_hard_ball_1__1_water = nop(),
        gourd_hard_ball_2__1_water = nop(),
        gourd_hard_ball_3__1_clay = nop(),
    }

    fun trigger_enter() {
        // object[0x06] = 0x01; // loot gourd_inn_1
        // object[0x07] = 0x01; // loot gourd_inn_2

        fade_in();
    }
};
map act1_caves__drain(ACT1_2_CAVES) {
    enum entrance {
        south = entrance(0xc2, 0x29, NORTH),
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        exit_south_raptors = nop(),
        exit_south_jaguar_ring = nop(),
        exit_south_hard_ball = nop(),
        exit_south_inn = nop(),
    }

    enum b_trigger {
        gourd_2 = @install() {
            debug_subtext("B=0");
            _loot_chest(0x0c, ROOTS, 0x01);
        },
        gourd_1 = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0b, ETHANOL, 0x01);
        },
        gourd_inn_2 = nop(),
        gourd_inn_1 = nop(),
        gourd_jaguar_ring_1 = nop(),
        gourd_jaguar_ring_2 = nop(),
        gourd_jaguar_ring_3 = nop(),
        gourd_hard_ball_1 = nop(),
        gourd_hard_ball_2 = nop(),
        gourd_hard_ball_3 = nop(),
    }

    fun trigger_enter() {
        // object[0x0b] = 0x01; // loot gourd_drain_1
        // object[0x0b] = 0x01; // loot gourd_drain_2

        fade_in();
    }
};

map bugmuck(BUGMUCK) {
    enum entrance {
        north_1 = entrance(0x0b, 0x01, SOUTH),
        north_2 = entrance(0x1b, 0x01, SOUTH),
        cave = entrance(0x24, 0x4c, SOUTH),

        dungeon_north = entrance(0x7c, 0d18, NORTH),
        dungeon_east_1 = entrance(0x85, 0x34, EAST),
        dungeon_east_2 = entrance(0x85, 0x3e, EAST),
        dungeon_east_3 = entrance(0x85, 0x4a, EAST),
        dungeon_south = entrance(0x7c, 0x75, SOUTH),
        dungeon_west_1 = entrance(0x73, 0x4a, WEST),
        dungeon_west_2 = entrance(0x73, 0x3e, WEST),
        dungeon_west_3 = entrance(0x73, 0x34, WEST),
    }

    enum stepon_trigger {
        helper_bug_east_south = @install() {
            debug_subtext("S=0");
        },
        helper_bug_west_south = @install() {
            debug_subtext("S=1");
        },
        helper_bug_west_north = @install() {
            debug_subtext("S=2");
        },
        exit_north_1 = @install() {
            debug_subtext("S=3");
        },
        exit_north_2 = @install() {
            debug_subtext("S=4");
        },
        exit_cave = @install() {
            debug_subtext("S=5");
        },
        exit_bug_south = @install() {
            debug_subtext("S=6");
        },
        exit_bug_west_1 = @install() {
            debug_subtext("S=7");
        },
        exit_bug_west_2 = @install() {
            debug_subtext("S=8");
        },
        exit_bug_west_3 = @install() {
            debug_subtext("S=9");
        },

        exit_bug_east_1 = @install() {
            debug_subtext("S=10");
        },
        exit_bug_east_2 = @install() {
            debug_subtext("S=11");
        },
        exit_bug_east_3 = @install() {
            debug_subtext("S=12");
        },
    }

    enum b_trigger {
        gourd__2_crystal = @install() {
            debug_subtext("B=0");
            _loot_chest(0x0d, CRYSTAL, 0d02);
        },
        gourd__armband_1_2 = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0c, ARMBAND_1_2, 0d01);
        },
        gourd__1_petal = @install() {
            debug_subtext("B=2");
            _loot_chest(0x0b, PETAL, 0d01);
        },
        gourd__4_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x09, WATER, 0d04);
        },
        gourd__2_crystal = @install() {
            debug_subtext("B=4");
            _loot_chest(0x0a, CRYSTAL, 0d02);
        },
        gourd__1_biscuit = @install() {
            debug_subtext("B=5");
            _loot_chest(0x07, BISCUIT, 0d01);
        },
        gourd__1_clay = @install() {
            debug_subtext("B=6");
            _loot_chest(0x08, CLAY, 0d01);
        },
        gourd__1_petal = @install() {
            debug_subtext("B=7");
            _loot_chest(0x06, PETAL, 0d01);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=8");
            _loot(0x0e, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=9");
            _loot(0x0f, OIL, 0d01, 0d00);
        },

        sniff__1_oil = @install() {
            debug_subtext("B=10");
            _loot(0x10, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=11");
            _loot(0x11, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=12");
            _loot(0x12, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=13");
            _loot(0x13, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=14");
            _loot(0x14, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=15");
            _loot(0x15, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x16, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=17");
            _loot(0x17, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=18");
            _loot(0x18, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=19");
            _loot(0x19, ROOTS, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=20");
            _loot(0x1a, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=21");
            _loot(0x1b, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=22");
            _loot(0x1c, ROOTS, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=23");
            _loot(0x1d, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=24");
            _loot(0x1e, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=25");
            _loot(0x1f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=26");
            _loot(0x20, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=27");
            _loot(0x21, ASH, 0d01, 0d00);
        },
        sniff__1_crystal_2 = @install() {
            debug_subtext("B=28");
            _loot(0x22, CRYSTAL, 0d01, 0d02);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=29");
            _loot(0x23, WAX, 0d01, 0d00);
        },

        sniff__1_crystal_1 = @install() {
            debug_subtext("B=30");
            _loot(0x24, CRYSTAL, 0d01, 0d01);
        },
        sniff__1_crystal = @install() {
            debug_subtext("B=31");
            _loot(0x25, CRYSTAL, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=32");
            _loot(0x26, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=33");
            _loot(0x27, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=34");
            _loot(0x28, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=35");
            _loot(0x29, CLAY, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=36");
            _loot(0x2a, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=37");
            _loot(0x2b, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=38");
            _loot(0x2c, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=39");
            _loot(0x2d, WAX, 0d01, 0d00);
        },

        sniff__1_wax = @install() {
            debug_subtext("B=40");
            _loot(0x2e, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=41");
            _loot(0x2f, WAX, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // raise dungeon_leg_west_3
        // object[0x01] = 0x01; // raise dungeon_leg_west_2
        // object[0x02] = 0x01; // raise dungeon_leg_west_1
        // object[0x03] = 0x01; // raise dungeon_leg_east_1
        // object[0x04] = 0x01; // raise dungeon_leg_east_2
        // object[0x05] = 0x01; // raise dungeon_leg_east_3
        // object[0x06] = 0x01; // gourd_bbm_east (petal)
        // object[0x07] = 0x01; // gourd_bbm_west_1 (dog biscuit)
        // object[0x08] = 0x01; // gourd_south
        // object[0x09] = 0x01; // gourd_hb_south
        // object[0x0a] = 0x01; // gourd_hb_east
        // object[0x0b] = 0x01; // gourd_bbm_west_2 (petal)
        // object[0x0c] = 0x01; // gourd_upstairs_2
        // object[0x0d] = 0x01; // gourd_upstairs_1
        
        fade_in();
    }
};

map bbm_1(BBM_1) {
    enum entrance {
        north = entrance(0x34, 0x0b, SOUTH),
        south = entrance(0x32, 0xa9, NORTH),
    }

    fun collapse_bridge(object_id) {
        object[object_id] = 0x7e;
    }
    enum stepon_trigger {
        trap_5_2_north = @install() {
            debug_subtext("S=0");

            collapse_bridge(0x0b);
        },
        slide_left_2_1 = @install() {
            debug_subtext("S=1");
        },
        slide_left_1_1 = @install() {
            debug_subtext("S=2");
        },
        slide_left_1_2 = @install() {
            debug_subtext("S=3");
        },
        slide_right_1_1 = @install() {
            debug_subtext("S=4");
        },
        slide_right_1_2 = @install() {
            debug_subtext("S=5");
        },
        slide_right_5_3 = @install() {
            debug_subtext("S=6");
        },
        slide_right_5_2 = @install() {
            debug_subtext("S=7");
        },
        slide_right_5_1 = @install() {
            debug_subtext("S=8");
        },
        slide_right_3 = @install() {
            debug_subtext("S=9");
        },

        slide_right_2 = @install() {
            debug_subtext("S=10");
        },
        slide_right_bottom = @install() {
            debug_subtext("S=11");
        },
        slide_left_bottom = @install() {
            debug_subtext("S=12");
        },
        slide_left_1_3 = @install() {
            debug_subtext("S=13");
        },
        slide_right_1_3 = @install() {
            debug_subtext("S=14");
        },
        slide_right_4_3 = @install() {
            debug_subtext("S=15");
        },
        slide_right_4_2 = @install() {
            debug_subtext("S=16");
        },
        slide_right_1_4 = @install() {
            debug_subtext("S=17");
        },
        slide_left_1_4 = @install() {
            debug_subtext("S=18");
        },
        slide_left_2_2 = @install() {
            debug_subtext("S=19");
        },

        slide_left_3 = @install() {
            debug_subtext("S=20");
        },
        slide_left_4 = @install() {
            debug_subtext("S=21");
        },
        slide_left_5_2 = @install() {
            debug_subtext("S=22");
        },
        slide_left_5_1 = @install() {
            debug_subtext("S=23");
        },
        exit_south = @install() {
            debug_subtext("S=24");
        },
        exit_north = @install() {
            debug_subtext("S=25");
        },
        trap_1_3_east = @install() {
            debug_subtext("S=26");

            collapse_bridge(0x00);
        },
        trap_2_4_east = @install() {
            debug_subtext("S=27");

            collapse_bridge(0x01);
        },
        trap_2_4_north = @install() {
            debug_subtext("S=28");

            collapse_bridge(0x02);
        },
        trap_3_4_north = @install() {
            debug_subtext("S=29");

            collapse_bridge(0x08);
        },

        trap_4_4_north = @install() {
            debug_subtext("S=30");

            collapse_bridge(0x0a);
        },
        trap_6_3_north = @install() {
            debug_subtext("S=31");

            // collapse_bridge(0x0f);
        },
        trap_6_1_north_2 = @install() {
            debug_subtext("S=32");

            collapse_bridge(0x0e);
        },
        trap_6_1_north_1 = @install() {
            debug_subtext("S=33");

            collapse_bridge(0x0e);
        },
        trap_6_0_east = @install() {
            debug_subtext("S=34");

            collapse_bridge(0x0d);
        },
        trap_5_1_north = @install() {
            debug_subtext("S=35");

            collapse_bridge(0x0c);
        },
        trap_3_0_north = @install() {
            debug_subtext("S=36");

            collapse_bridge(0x06);
        },
        trap_3_0_east = @install() {
            debug_subtext("S=37");

            collapse_bridge(0x05);
        },
        trap_3_2_north = @install() {
            debug_subtext("S=38");

            collapse_bridge(0x07);
        },
        trap_3_2_east = @install() {
            debug_subtext("S=39");

            collapse_bridge(0x09);
        },

        trap_2_0_east = @install() {
            debug_subtext("S=40");

            collapse_bridge(0x04);
        },
        trap_1_0_north = @install() {
            debug_subtext("S=41");

            collapse_bridge(0x03);
        },
    }

    enum b_trigger {
        sniff__1_water = @install() {
            debug_subtext("B=0");
            _loot(0x10, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=1");
            _loot(0x11, WATER, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=2");
            _loot(0x12, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=3");
            _loot(0x13, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=4");
            _loot(0x14, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x15, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=6");
            _loot(0x16, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=7");
            _loot(0x17, CLAY, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=8");
            _loot(0x18, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=9");
            _loot(0x19, ROOTS, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x1a, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=11");
            _loot(0x1b, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=12");
            _loot(0x1c, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=13");
            _loot(0x1d, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=14");
            _loot(0x1e, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=15");
            _loot(0x1f, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=16");
            _loot(0x20, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=17");
            _loot(0x21, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=18");
            _loot(0x22, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=19");
            _loot(0x23, OIL, 0d01, 0d00);
        },

        sniff__1_ash = @install() {
            debug_subtext("B=20");
            _loot(0x24, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=21");
            _loot(0x25, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=22");
            _loot(0x26, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=23");
            _loot(0x27, ASH, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0xfe; // collapse trap_1_3_east
        // object[0x01] = 0xfe; // collapse trap_2_4_east
        // object[0x02] = 0xfe; // collapse trap_2_4_north
        // object[0x03] = 0xfe; // collapse trap_1_0_north
        // object[0x04] = 0xfe; // collapse trap_2_0_east
        // object[0x05] = 0xfe; // collapse trap_3_0_east
        // object[0x06] = 0xfe; // collapse trap_3_0_north
        // object[0x07] = 0xfe; // collapse trap_3_2_north
        // object[0x08] = 0xfe; // collapse trap_3_4_north
        // object[0x09] = 0xfe; // collapse trap_3_2_east
        // object[0x0a] = 0xfe; // collapse trap_4_4_north
        // object[0x0b] = 0xfe; // collapse trap_5_2_north
        // object[0x0c] = 0xfe; // collapse trap_5_1_north
        // object[0x0d] = 0xfe; // collapse trap_6_0_east
        // object[0x0e] = 0xfe; // collapse trap_6_1_north (2 triggers)
        // object[0x0f] = 0xfe; // collapse trap_6_3_north

        fade_in();
    }
};

map bbm_2(BBM_2) {
    enum entrance {
        level_0_east = entrance(0x39, 0x20, WEST),
        level_0_south = entrance(0x1c, 0x5b, NORTH),
        level_0_west = entrance(0x01, 0x20, EAST),

        level_1_east = entrance(0x39, 0x32, WEST),
        level_1_west = entrance(0x01, 0x32, EAST),

        level_2_north = entrance(0x1d, 0x05, SOUTH),
        level_2_east = entrance(0x39, 0x44, WEST),
        level_2_west = entrance(0x01, 0x44, EAST),
    }

    enum stepon_trigger {
        exit_level_0_west = @install() {
            debug_subtext("S=0");
        },
        exit_level_1_west = @install() {
            debug_subtext("S=1");
        },
        exit_level_2_west = @install() {
            debug_subtext("S=2");
        },
        exit_level_2_east = @install() {
            debug_subtext("S=3");
        },
        exit_level_1_east = @install() {
            debug_subtext("S=4");
        },
        exit_level_0_east = @install() {
            debug_subtext("S=5");
        },
        exit_level_2_north = @install() {
            debug_subtext("S=6");
        },
        exit_level_0_south = @install() {
            debug_subtext("S=7");
        },
    }

    enum b_trigger {
        sniff__1_water = @install() {
            debug_subtext("B=0");
            _loot(0x00, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=1");
            _loot(0x01, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=2");
            _loot(0x02, WATER, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=3");
            _loot(0x03, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=4");
            _loot(0x04, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x05, CLAY, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=6");
            _loot(0x06, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=7");
            _loot(0x07, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=8");
            _loot(0x08, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=9");
            _loot(0x09, OIL, 0d01, 0d00);
        },

        sniff__1_oil = @install() {
            debug_subtext("B=10");
            _loot(0x0a, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=11");
            _loot(0x0b, OIL, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map thraxx(THRAXX) {
    enum entrance {
        north = entrance(0x18, 0x10, SOUTH),
        south = entrance(0x17, 0x3f, NORTH),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");

            // map_transition(thraxx, south, NORTH);
        },
        trigger_boss = @install() {
            debug_subtext("S=1");
        },
        exit_south = @install() {
            debug_subtext("S=2");
            // map_transition(thraxx, north, SOUTH);
        }
    }

    enum b_trigger {
        cocoon = @install() {
            debug_subtext("B=0");
        },
        rip_cage = @install() {
            debug_subtext("B=1");
        }
    }

    fun show_thraxx(show) {
        if(show) {
            add_enemy(ENEMY.THRAXX_LEFT_ARM, 0x13, 0x0e);
            add_enemy(ENEMY.THRAXX_RIGHT_ARM, 0x1d, 0x0d);

            object[0x00] = 0x00; // change rip_entrance (0=open, 1=closed, 2=gone)
            object[0x01] = 0x00; // change body (0=present, 1=cocoon, 2=gone)
            object[0x02] = 0x00; // change rip_entrance_right (0=present, 1=gone)
            object[0x03] = 0x00; // change rip_entrance_left (0=present, 1=gone)
        } else {
            object[0x00] = 0x02; // change rip_entrance (0=open, 1=closed, 2=gone)
            object[0x01] = 0x02; // change body (0=present, 1=cocoon, 2=gone)
            object[0x02] = 0x01; // change rip_entrance_right (0=present, 1=gone)
            object[0x03] = 0x01; // change rip_entrance_left (0=present, 1=gone)
        }
    }

    fun show_cocoon(show) {
        if(show) {
            object[0x01] = 0x01;
        } else {
            object[0x01] = 0x00;
        }
    }

    fun trigger_enter() {
        show_thraxx(False);
        // show_cocoon();

        // object[0x00] = 0x01; // change rip_entrance (0=open, 1=closed, 2=gone)
        // object[0x01] = 0x01; // change body (0=present, 1=cocoon, 2=gone)
        // object[0x02] = 0x01; // change rip_entrance_right (0=present, 1=gone)
        // object[0x03] = 0x01; // change rip_entrance_left (0=present, 1=gone)

        fade_in();
    }
};

map northern_jungle(NORTH_JUNGLE) {
    enum entrance {
        north = entrance(0x56, 0x05, SOUTH),
        south = entrance(0x07, 0x4d, NORTH),

        cave_1 = entrance(0x08, 0x0f, SOUTH),
        cave_2 = entrance(0x48, 0x13, SOUTH),

        wings = entrance(0x0f, 0x3f, NONE),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
        },
        cave_2 = @install() {
            debug_subtext("S=1");
        },
        cave_1 = @install() {
            debug_subtext("S=2");
        },
        exit_south = @install() {
            debug_subtext("S=3");
        },
    }
    
    enum b_trigger {
        sniff__1_water = @install() {
            debug_subtext("B=0");
            _loot(0x02, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=1");
            _loot(0x03, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=2");
            _loot(0x04, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=3");
            _loot(0x05, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=4");
            _loot(0x06, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=5");
            _loot(0x07, WATER, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=6");
            _loot(0x08, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=7");
            _loot(0x09, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=8");
            _loot(0x0a, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=9");
            _loot(0x0b, ROOTS, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=11");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=12");
            _loot(0x0e, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=13");
            _loot(0x0f, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=14");
            _loot(0x10, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=15");
            _loot(0x11, CLAY, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=16");
            _loot(0x12, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=17");
            _loot(0x13, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=18");
            _loot(0x14, ASH, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=19");
            _loot(0x15, WAX, 0d01, 0d00);
        },

        sniff__1_wax = @install() {
            debug_subtext("B=20");
            _loot(0x16, WAX, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=21");
            _loot_chest(0x00, CLAY, 0d01);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=22");
            _loot_chest(0x01, NECTAR, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x01] = 0x01; // loot gourd_north (nectar)
        // object[0x00] = 0x01; // loot gourd_south (clay)

        fade_in();
    }
};

map volcano_path(VOLCANO_PATH) {
    enum entrance {
        cutscene_north_1 = entrance(0x4a, 0x38, NONE),
        cutscene_north_2 = entrance(0x5f, 0x1b, NONE),
        east = entrance(0x6d, 0x83, WEST), // 0x6b, 0x83
        south = entrance(0x1b, 0x9d, NORTH),

        cave_west = entrance(0x0b, 0x70, SOUTH),
        cave_center = entrance(0x3f, 0x4a, SOUTH),
        cave_east = entrance(0x4d, 0x6a, SOUTH),

        cave_gauge = entrance(0x5f, 0x16, SOUTH),
    }

    fun pressure_plate_0_1() {
        generic_act1_volcano_pressure_plate(0x3c, 0x3f, 0x05, 0x02, 0d93, 0d59, 0d2);
    }
    fun pressure_plate_0_2() {
        generic_act1_volcano_pressure_plate(0x44, 0x41, 0x06, 0x01, 0d61, 0d30, 0d4);
    }
    fun pressure_plate_1_1() {
        generic_act1_volcano_pressure_plate(0x30, 0x39, 0x04, 0x01, 0d145, 0d00, 0d0);
    }
    fun pressure_plate_1_2() {
        generic_act1_volcano_pressure_plate(0x4e, 0x31, 0x03, 0x01, 0d74, 0d52, 0d0);
    }
    fun pressure_plate_2_1() {
        generic_act1_volcano_pressure_plate(0x3c, 0x27, 0x01, 0x01, 0d68, 0d27, 0d3);
    }
    fun pressure_plate_2_2() {
        generic_act1_volcano_pressure_plate(0x52, 0x25, 0x02, 0x01, 0d71, 0d49, 0d0);
    }
    fun pressure_plate_3_1() {
        generic_act1_volcano_pressure_plate(0x36, 0x1d, 0x07, 0x01, 0d59, 0d39, 0d3);
    }
    fun pressure_plate_3_2() {
        generic_act1_volcano_pressure_plate(0x52, 0x19, 0x00, 0x01, 0d66, 0d37, 0d1);
    }

    enum stepon_trigger {
        tunnel_gauge = @install() {
            debug_subtext("S=0");
        },
        pressure_plate_1_2_right = @install() {
            debug_subtext("S=1");

            pressure_plate_1_2();
        },
        pressure_plate_1_2_left = @install() {
            debug_subtext("S=2");
            
            pressure_plate_1_2();
        },
        door_1_2_hole_0_2 = @install() {
            debug_subtext("S=3");

            generic_act1_volcano_cave_hole(0x46, 0x31, 0d74, 0d56);
        },
        pressure_plate_3_1_left = @install() {
            debug_subtext("S=4");
            
            pressure_plate_3_1();
        },
        cave_2_1_hole_0_1 = @install() {
            debug_subtext("S=5");

            generic_act1_volcano_cave_hole(0x2a, 0x35, 0d48, 0d60);
        },
        cave_2_1_hole_1_1 = @install() {
            debug_subtext("S=6");

            generic_act1_volcano_cave_hole(0d52, 0d36, 0d52, 0d48);
        },
        cave_4_hole_0_2 = @install() {
            debug_subtext("S=7");

            generic_act1_volcano_cave_hole(0d62, 0d18, 0d74, 0d56, True);
        },
        cave_5_hole_3 = @install() {
            debug_subtext("S=8");

            generic_act1_volcano_cave_hole(0x4a, 0x09, 0d72, 0d16);
        },
        cave_4_hole_1_2 = @install() {
            debug_subtext("S=9");

            generic_act1_volcano_cave_hole(0d76, 0d23, 0d82, 0d42, True);
        },

        cave_2_2_hole_1_2 = @install() {
            debug_subtext("S=10");

            generic_act1_volcano_cave_hole(0x44, 0x23, 0d82, 0d42);
        },
        exit_south = @install() {
            debug_subtext("S=11");
        },
        cave_east = @install() {
            debug_subtext("S=12");
        },
        cave_west = @install() {
            debug_subtext("S=13");
        },
        cave_center = @install() {
            debug_subtext("S=14");
        },
        exit_east = @install() {
            debug_subtext("S=15");
        },
        pressure_plate_2_2_right = @install() {
            debug_subtext("S=16");
            
            pressure_plate_2_2();
        },
        pressure_plate_3_2 = @install() {
            debug_subtext("S=17");
            
            pressure_plate_3_2();
        },
        pressure_plate_1_1 = @install() {
            debug_subtext("S=8");
            
            pressure_plate_1_1();
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },

        pressure_plate_0_1_right = @install() {
            debug_subtext("S=20");
            
            pressure_plate_0_1();
        },
        pressure_plate_0_2_right = @install() {
            debug_subtext("S=21");
            
            pressure_plate_0_2();
        },
        pressure_plate_0_2_left = @install() {
            debug_subtext("S=22");
            
            pressure_plate_0_2();
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        stepon_24 = @install() {
            debug_subtext("S=24");
        },
        pressure_plate_3_1_right = @install() {
            debug_subtext("S=25");
            
            pressure_plate_3_1();
        },
        stepon_26 = @install() {
            debug_subtext("S=26");
        },
        pressure_plate_2_2_left = @install() {
            debug_subtext("S=27");
            
            pressure_plate_2_2();
        },
        stepon_28 = @install() {
            debug_subtext("S=28");
        },
        pressure_plate_0_1_left = @install() {
            debug_subtext("S=29");

            pressure_plate_0_1();
        },

        pressure_plate_2_1 = @install() {
            debug_subtext("S=30");
            
            pressure_plate_2_1();
        },
    }

    enum b_trigger {
        guord_gauge = @install() {
            debug_subtext("B=0");
            _loot_chest(0x27, WATER, 0d01); // gauge
        },
        gourd_2 = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0b, CLAY, 0d01);
        },
        gourd_3 = @install() {
            debug_subtext("B=2");
            _loot_chest(0x08, PETAL, 0d01);
        },
        gourd_5 = @install() {
            debug_subtext("B=3");
            _loot_chest(0x09, WATER, 0d01);
        },
        gourd_1 = @install() {
            debug_subtext("B=4");
            _loot_chest(0x0a, ROOTS, 0d01);
        },
        sniff__1_water = @install() {
            debug_subtext("B=5");
            _loot(0x0c, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0d, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x0e, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x0f, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=9");
            _loot(0x10, WATER, 0d01, 0d00);
        },

        sniff__1_water = @install() {
            debug_subtext("B=10");
            _loot(0x11, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=11");
            _loot(0x12, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x13, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=13");
            _loot(0x14, WATER, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=14");
            _loot(0x15, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=15");
            _loot(0x16, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=16");
            _loot(0x17, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=17");
            _loot(0x18, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=18");
            _loot(0x19, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=19");
            _loot(0x1a, CLAY, 0d01, 0d00);
        },

        sniff__1_clay = @install() {
            debug_subtext("B=20");
            _loot(0x1b, CLAY, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=21");
            _loot(0x1d, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=22");
            _loot(0x1d, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=23");
            _loot(0x1e, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=24");
            _loot(0x1f, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=25");
            _loot(0x20, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=26");
            _loot(0x21, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=27");
            _loot(0x22, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=28");
            _loot(0x23, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=29");
            _loot(0x24, OIL, 0d01, 0d00);
        },

        sniff__1_ash = @install() {
            debug_subtext("B=30");
            _loot(0x25, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=31");
            _loot(0x26, ASH, 0d01, 0d00);
        },
        grass_non_sword = @install() {
            debug_subtext("B=32");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // activate pressure_plate_3_2
        // object[0x01] = 0x01; // activate pressure_plate_2_1
        // object[0x02] = 0x01; // activate pressure_plate_2_2
        // object[0x03] = 0x01; // activate pressure_plate_1_2
        // object[0x04] = 0x01; // activate pressure_plate_1_1
        // object[0x05] = 0x02; // activate pressure_plate_0_1 (0=grass, 1=no grass, 2=active)
        // object[0x06] = 0x01; // activate pressure_plate_0_2
        // object[0x07] = 0x01; // activate pressure_plate_3_1
        // object[0x08] = 0x01; // loot gourd_3
        // object[0x09] = 0x01; // loot gourd_5
        // object[0x0a] = 0x01; // loot gourd_1
        // object[0x0b] = 0x01; // loot gourd_2
        // …
        // object[0x27] = 0x01; // loot gourd_gauge

        fade_in();
    }
};

map graveyard(GRAVEYARD) {
    enum entrance {
        north = entrance(0x32, 0x0f, SOUTH),
        south = entrance(0x2f, 0x5f, NORTH)
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
        },
        exit_south = @install() {
            debug_subtext("S=1");
        },
        spawn_boss = @install() {
            debug_subtext("S=2");
        }
    }

    enum b_trigger {
        sniff__1_ash = @install() {
            debug_subtext("B=0");
            _loot(0x0c, ASH, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=1");
            _loot(0x02, OIL, 0d01, 0d00);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=2");
            _loot(0x06, ASH, 0d01, 0d01);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=3");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=4");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=5");
            _loot(0x07, ASH, 0d01, 0d00);
        },
        sniff__1_wax_1 = @install() {
            debug_subtext("B=6");
            _loot(0x1b, WAX, 0d01, 0d01);
        },
        sniff__1_wax_2 = @install() {
            debug_subtext("B=7");
            _loot(0x1c, WAX, 0d01, 0d02);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=8");
            _loot(0x11, ASH, 0d01, 0d01);
        },
        sniff__1_ash_2 = @install() {
            debug_subtext("B=9");
            _loot(0x18, ASH, 0d01, 0d02);
        },

        sniff__1_clay_2 = @install() {
            debug_subtext("B=10");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=11");
            _loot(0x09, CLAY, 0d01, 0d00);
        },
        sniff__1_oil_2 = @install() {
            debug_subtext("B=12");
            _loot(0x19, OIL, 0d01, 0d02);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=13");
            _loot(0x12, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=14");
            _loot(0x15, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=15");
            _loot(0x08, OIL, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=16");
            _loot(0x0a, CLAY, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=17");
            _loot(0x01, WATER, 0d01, 0d00);
        },
        sniff__1_wter_1 = @install() {
            debug_subtext("B=18");
            _loot(0x03, WATER, 0d01, 0d01);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=19");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },

        sniff__1_roots_1 = @install() {
            debug_subtext("B=20");
            _loot(0x1d, ROOTS, 0d01, 0d01);
        },
        sniff__1_roots_3 = @install() {
            debug_subtext("B=21");
            _loot(0x1a, ROOTS, 0d01, 0d03);
        },
        sniff__1_water_2 = @install() {
            debug_subtext("B=22");
            _loot(0x13, WATER, 0d01, 0d02);
        },
        sniff__1_clay_1 = @install() {
            debug_subtext("B=23");
            _loot(0x04, CLAY, 0d01, 0d01);
        },
        sniff__1_roots_2 = @install() {
            debug_subtext("B=24");
            _loot(0x0b, ROOTS, 0d01, 0d02);
        },
        sniff__1_water = @install() {
            debug_subtext("B=25");
            _loot(0x1e, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=26");
            _loot(0x10, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay_1 = @install() {
            debug_subtext("B=27");
            _loot(0x17, CLAY, 0d01, 0d01);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=28");
            _loot(0x16, ASH, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=29");
            _loot(0x14, CLAY, 0d01, 0d00);
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map top_of_volcano(VOLCANO_TOP) { // buggy parallax scrolling
    enum entrance {
        test = entrance(0x10, 0x10, NONE)
    }

    enum stepon_trigger {
        exit_hut = @install() {
            debug_subtext("S=0");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map sky(SKY) {
    enum entrance {
        south = entrance(0x10, 0x10, NONE)
    }

    fun trigger_enter() {
        fade_in();
    }
};

map swamp_entrance(SWAMP_ENTRANCE) {
    enum entrance {
        north = entrance(0x19, 0x02, SOUTH),
        east = entrance(0x5f, 0x3a, WEST),
        west = entrance(0x01, 0x23, EAST),
    }

    enum stepon_trigger {
        leaf_bridge_4 = @install() {
            debug_subtext("S=0");
        },
        leaf_bridge_2 = @install() {
            debug_subtext("S=1");
        },
        exit_north = @install() {
            debug_subtext("S=2");
        },
        leaf_bridge_1 = @install() {
            debug_subtext("S=3");
        },
        exit_east = @install() {
            debug_subtext("S=4");
        },
        exit_west = @install() {
            debug_subtext("S=5");
        },
        leaf_bridge_3 = @install() {
            debug_subtext("S=6");
        },
    }

    enum b_trigger {
        sniff__1_water = @install() {
            debug_subtext("B=0");
            _loot(0x0d, WATER, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=1");
            _loot(0x0c, WAX, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=2");
            _loot(0x0b, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=3");
            _loot(0x0a, OIL, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=4");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=5");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x00, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x0d, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=9");
            _loot(0x01, WATER, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x02, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=11");
            _loot(0x03, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=12");
            _loot(0x08, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=13");
            _loot(0x0a, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=14");
            _loot(0x0b, OIL, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=15");
            _loot(0x0c, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=16");
            _loot(0x04, WAX, 0d01, 0d00);
        },
        gourd_west__1_water = @install() {
            debug_subtext("B=17");
            _loot_chest(0x05, WATER, 0d01);
        },
        gourd_north__1_water = @install() {
            debug_subtext("B=18");
            _loot_chest(0x06, WATER, 0d01);
        },
    }

    fun trigger_enter() {
        // ???
        // object[0x05] = 0x01; // loot gourd_west
        // object[0x06] = 0x01; // loot gourd_north
        // object[0x07] = 0x7e; // show leaf_bridge

        fade_in();
    }
};

map swamp(SWAMP) {
    enum entrance {
        north = entrance(0x92, 0x01, SOUTH),
        west = entrance(0x01, 0xb0, EAST),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        stepon_9 = @install() {
            debug_subtext("S=9");
        },

        stepon_10 = @install() {
            debug_subtext("S=10");
        },
        stepon_11 = @install() {
            debug_subtext("S=11");
        },
        stepon_12 = @install() {
            debug_subtext("S=12");
        },
        stepon_13 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        stepon_17 = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },

        stepon_20 = @install() {
            debug_subtext("S=20");
        },
        stepon_21 = @install() {
            debug_subtext("S=21");
        },
        stepon_22 = @install() {
            debug_subtext("S=22");
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        stepon_24 = @install() {
            debug_subtext("S=24");
        },
        stepon_25 = @install() {
            debug_subtext("S=25");
        },
        leaf_bridge_south = @install() {
            debug_subtext("S=26");
        },
        exit_north = @install() {
            debug_subtext("S=27");
        },
        exit_west = @install() {
            debug_subtext("S=28");
        },
    }

    enum b_trigger {
        sniff__1_oil = @install() {
            debug_subtext("B=0");
            _loot(0x3d, OIL, 0d01, 0d00);
        },
        gourd_north_west_1__1_clay_2 = @install() {
            debug_subtext("B=1");
            _loot_chest(0x38, CLAY, 0d01); // next=2
        },
        gourd_north_west_2__1_roots_1 = @install() {
            debug_subtext("B=2");
            _loot_chest(0x39, ROOTS, 0d01); // next=1
        },
        gourd_north_east__1_call_beads = @install() {
            debug_subtext("B=3");
            _loot_chest(0x3a, CALL_BEADS, 0d01);
        },
        gourd_east__1_oil = @install() {
            debug_subtext("B=4");
            _loot_chest(0x3b, OIL, 0d01);
        },
        gourd_south_east__1_wax_2 = @install() {
            debug_subtext("B=5");
            _loot_chest(0x35, WAX, 0d01); // next=2
        },
        gourd_south__1_biscuit = @install() {
            debug_subtext("B=6");
            _loot_chest(0x36, BISCUIT, 0d01);
        },
        gourd_south_west__1_nectar = @install() {
            debug_subtext("B=7");
            _loot_chest(0x37, NECTAR, 0d01);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x05, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=9");
            _loot(0x00, ROOTS, 0d01, 0d00);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x01, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=11");
            _loot(0x02, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x03, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=13");
            _loot(0x04, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=14");
            _loot(0x05, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=15");
            _loot(0x06, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=16");
            _loot(0x07, WATER, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=17");
            _loot(0x08, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=18");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=19");
            _loot(0x0a, WATER, 0d01, 0d00);
        },

        sniff__1_oil = @install() {
            debug_subtext("B=20");
            _loot(0x0b, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=21");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=22");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=23");
            _loot(0x0e, ROOTS, 0d01, 0d00);
        },
        b_trigger_24 = @install() {
            debug_subtext("B=24");
            _loot(0x0f, WATER, 0d01, 0d00);
        },
        b_trigger_25 = @install() {
            debug_subtext("B=25");
            _loot(0x10, WATER, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=26");
            _loot(0x3c, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=27");
            _loot(0x11, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=28");
            _loot(0x12, ROOTS, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=29");
            _loot(0x13, WATER, 0d01, 0d00);
        },

        sniff__1_water = @install() {
            debug_subtext("B=30");
            _loot(0x14, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=31");
            _loot(0x15, WATER, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=32");
            _loot(0x16, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=33");
            _loot(0x3c, OIL, 0d01, 0d00);
        },
    }
    
    fun trigger_enter() {
        // ???
        // object[0x17] = 0x7e; // show leaf_bridge_south_1_1
        // object[0x18] = 0x7e; // show leaf_bridge_south_1_2
        // object[0x19] = 0x7e; // show leaf_bridge_south_1_3
        // object[0x1a] = 0x7e; // show leaf_bridge_south_2_1
        // object[0x1b] = 0x7e; // show leaf_bridge_south_2_2
        // object[0x1c] = 0x7e; // show leaf_bridge_south_2_3
        // object[0x1d] = 0x7e; // show leaf_bridge_south_2_4
        // object[0x1e] = 0x7e; // show leaf_bridge_south_2_5
        // object[0x1f] = 0x7e; // show leaf_bridge_south_2_6
        // object[0x20] = 0x7e; // show leaf_bridge_south_3_1
        // object[0x21] = 0x7e; // show leaf_bridge_south_3_2
        // object[0x22] = 0x7e; // show leaf_bridge_south_3_3
        // object[0x23] = 0x7e; // show leaf_bridge_south_3_4
        // ???
        // object[0x27] = 0x7e; // show leaf_bridge_west_1
        // object[0x28] = 0x7e; // show leaf_bridge_west_2
        // object[0x29] = 0x7e; // show leaf_bridge_west_3
        // ???
        // object[0x2a] = 0x7e; // show leaf_bridge_center_1
        // object[0x2b] = 0x7e; // show leaf_bridge_center_1
        // object[0x2c] = 0x7e; // show leaf_bridge_east_1
        // object[0x2d] = 0x7e; // show leaf_bridge_east_2
        // ???
        // object[0x35] = 0x01; // loot gourd_south_east (wax)
        // object[0x36] = 0x01; // loot gourd_south (dog biscuit)
        // object[0x37] = 0x01; // loot gourd_south_west (nectar)
        // object[0x38] = 0x01; // loot gourd_north_west_1 (clay)
        // object[0x39] = 0x01; // loot gourd_north_west_2 (roots)
        // object[0x3a] = 0x01; // loot gourd_north_east (call beads)
        // object[0x3b] = 0x01; // loot gourd_east (oil)

        fade_in();
    }
};

map salabog(SALABOG) {
    enum entrance {
        hut = entrance(0x1b, 0x11, SOUTH),
        south = entrance(0x1c, 0x61, NORTH)
    }

    enum stepon_trigger {
        exit_hut = @install() {
            debug_subtext("S=0");
        },
        exit_south = @install() {
            debug_subtext("S=1");
        },
        spawn_boss = @install() {
            debug_subtext("S=2");
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map dungeon_volcano(VOLCANO) {
    enum entrance {
        north_1 = entrance(0x2e, 0x05, SOUTH),
        north_2 = entrance(0x76, 0x06, SOUTH),
        south_1 = entrance(0x51, 0xb1, NORTH),
        south_2 = entrance(0x7d, 0xb1, NORTH),
    }

    enum stepon_trigger {
        exit_north_1 = @install() {
            debug_subtext("S=0");
        },
        exit_north_2 = @install() {
            debug_subtext("S=1");
        },
        exit_south_1 = @install() {
            debug_subtext("S=2");
        },
        exit_south_2 = @install() {
            debug_subtext("S=3");
        },
    }

    enum b_trigger {
        gourd_north_2__1_mud_pepper = @install() {
            debug_subtext("B=0");
            _loot_chest(0x03, MUD_PEPPER, 0d01); // same as B=1
        },
        gourd_north_2__1_mud_pepper = @install() {
            debug_subtext("B=1");
            _loot_chest(0x03, MUD_PEPPER, 0d01); // same as B=0
        },
        sniff__1_water = @install() {
            debug_subtext("B=2");
            _loot(0x10, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=3");
            _loot(0x0f, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=4");
            _loot(0x0e, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=5");
            _loot(0x0d, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0c, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot_chest(0x0a, WATER, 0d01);
        },
        gourd_inside_2__100_money = @install() {
            debug_subtext("B=8");
            _loot_chest(0x0b, MONEY, 0d100);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=9");
            _loot(0x11, CLAY, 0d01, 0d00);
        },

        sniff__1_clay = @install() {
            debug_subtext("B=10");
            _loot(0x12, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=11");
            _loot(0x13, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=12");
            _loot(0x14, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=13");
            _loot(0x15, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=14");
            _loot(0x16, CLAY, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=15");
            _loot(0x17, CLAY, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x18, ROOTS, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=17");
            _loot(0x19, OIL, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=18");
            _loot(0x1a, OIL, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=19");
            _loot(0x1b, ASH, 0d01, 0d00);
        },

        sniff__1_ash = @install() {
            debug_subtext("B=20");
            _loot(0x1c, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=21");
            _loot(0x1d, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("S=22");
            _loot(0x1e, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("S=23");
            _loot(0x1f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("S=24");
            _loot(0x20, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("S=25");
            _loot(0x21, ASH, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("S=26");
            _loot(0x22, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("S=27");
            _loot(0x23, WAX, 0d01, 0d00);
        },
        sniff__1_wax = @install() {
            debug_subtext("S=28");
            _loot(0x24, WAX, 0d01, 0d00);
        },
        gourd_north_1__1_roots = @install() {
            debug_subtext("S=29");
            _loot_chest(0x08, ROOTS, 0d01);
        },

        gourd_west_2__1_roots = @install() {
            debug_subtext("S=30");
            _loot_chest(0x07, ROOTS, 0d01);
        },
        gourd_west_1__1_clay = @install() {
            debug_subtext("S=31");
            _loot_chest(0x06, CLAY, 0d01);
        },
        gourd_south__1_mud_pepper = @install() {
            debug_subtext("S=32");
            _loot_chest(0x04, MUD_PEPPER, 0d01);
        },
        gourd_east__1_petal = @install() {
            debug_subtext("S=33");
            _loot_chest(0x05, PETAL, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x7e; // show bridge_north
        // object[0x01] = 0x7e; // show bridge_center_2
        // object[0x02] = 0x7e; // show bridge_center_1
        // object[0x03] = 0x01; // loot gourd_north_2
        // object[0x04] = 0x01; // loot gourd_south (mud pepper)
        // object[0x05] = 0x01; // loot gourd_east (petal)
        // object[0x06] = 0x01; // loot gourd_west_1 (clay)
        // object[0x07] = 0x01; // loot gourd_west_2 (roots)
        // object[0x08] = 0x01; // loot gourd_north_1 (roots)
        // ???
        // object[0x0a] = 0x01; // loot gourd_inside_1 (water)
        // object[0x0b] = 0x01; // loot gourd_inside_2 (100 talons)
        // ???

        fade_in();
    }
};

map volcano_rooms(VOLCANO_ROOMS) {
    enum entrance {
        main_north = entrance(0xd3, 0x3d, SOUTH),
        main_east = entrance(0xf7, 0x5b, WEST),
        main_south = entrance(0xd5, 0x95, NORTH),
        main_west = entrance(0xbb, 0x5d, EAST),

        cave_outside = entrance(0x54, 0xb1, NORTH),

        room_nw_north = entrance(0x20, 0x85, SOUTH),
        room_nw_west = entrance(0x01, 0xa3, EAST),

        room_es_east = entrance(0x67, 0x1c, WEST),
        room_es_south = entrance(0x4c, 0x39, NORTH),

        room_nss_north = entrance(0x9e, 0x05, SOUTH),
        room_nss_south_1 = entrance(0x9e, 0x37, NORTH),
        room_nss_south_2 = entrance(0x84, 0x37, NORTH),

        room_s_south = entrance(0x9e, 0x7b, NORTH),

        room_alchemist = entrance(0xd0, 0x05, SOUTH),

        room_ns_north = entrance(0x1c, 0x3d, SOUTH),
        room_ns_south = entrance(0x22, 0x7b, NORTH),

        room_nne_north_1 = entrance(0x4c, 0x36, SOUTH),
        room_nne_north_2 = entrance(0x60, 0x39, SOUTH),
        room_nne_east = entrance(0x7f, 0x60, WEST),

        room_sw_south = entrance(0x1c, 0x3b, NORTH),
        room_sw_west = entrance(0x01, 0x24, EAST),
    }

    enum stepon_trigger {
        exit_room_nw_north = @install() {
            debug_subtext("S=0");
        },
        exit_room_nw_west = @install() {
            debug_subtext("S=1");
        },
        exit_cave_south = @install() {
            debug_subtext("S=2");
        },
        exit_room_s_south = @install() {
            debug_subtext("S=3");
        },
        exit_room_nne_east = @install() {
            debug_subtext("S=4");
        },
        exit_room_ns_south = @install() {
            debug_subtext("S=5");
        },
        exit_room_sw_west = @install() {
            debug_subtext("S=6");
        },
        exit_room_ns_north = @install() {
            debug_subtext("S=7");
        },
        exit_room_sw_south = @install() {
            debug_subtext("S=8");
        },
        exit_room_nne_north_1 = @install() {
            debug_subtext("S=9");
        },

        exit_room_es_south = @install() {
            debug_subtext("S=10");
        },
        exit_room_es_east = @install() {
            debug_subtext("S=11");
        },
        exit_room_nne_north_2 = @install() {
            debug_subtext("S=12");
        },
        exit_room_nss_south_2 = @install() {
            debug_subtext("S=13");
        },
        exit_room_nss_south_1 = @install() {
            debug_subtext("S=14");
        },
        exit_room_nss_north = @install() {
            debug_subtext("S=15");
        },
        exit_room_alchemist_north = @install() {
            debug_subtext("S=16");
        },
        exit_main_east = @install() {
            debug_subtext("S=17");
        },
        exit_main_west = @install() {
            debug_subtext("S=18");
        },
        exit_main_north = @install() {
            debug_subtext("S=19");
        },

        exit_main_south = @install() {
            debug_subtext("S=20");
        },
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = @install() {
            debug_subtext("B=0");
            _loot(0x17, ASH, 0d01, 0d00);
        },
        gourd_cave_outside__3_wax = @install() {
            debug_subtext("B=1");
            _loot_chest(0x16, WAX, 0d03);
        },
        gourd_cave_outside__1_wax = @install() {
            debug_subtext("B=2");
            _loot_chest(0x15, WAX, 0d01);
        },
        gourd_room_ns__4_ash = @install() {
            debug_subtext("B=3");
            _loot_chest(0x04, ASH, 0d04);
        },
        gourd_room_sw__4_ash = @install() {
            debug_subtext("B=4");
            _loot_chest(0x05, ASH, 0d04);
        },
        gourd_main__1_call_bead = @install() {
            debug_subtext("B=5");
            _loot_chest(0x03, CALL_BEADS, 0d01); // amount+=0
        },
        gourd_alchemist_west__3_water = @install() {
            debug_subtext("B=6");
            _loot_chest(0x02, WATER, 0d03);
        },
        gourd_room_s__2_wax = @install() {
            debug_subtext("B=7");
            _loot_chest(0x01, WAX, 0d02);
        },
        gourd_room_s__3_ash = @install() {
            debug_subtext("B=8");
            _loot_chest(0x00, ASH, 0d03);
        },
        gourd_alchemist_hidden_2__5_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x06, WAX, 0d05);
        },
        gourd_alchemist_hidden_1__6_water = @install() {
            debug_subtext("B=10");
            _loot_chest(0x07, WATER, 0d06);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        sniff_room_nne__1_water = @install() {
            debug_subtext("B=13");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff_room_ns__1_clay = @install() {
            debug_subtext("B=14");
            _loot(0x0a, CLAY, 0d01, 0d00);
        },
        sniff_room_nss__1_roots = @install() {
            debug_subtext("B=15");
            _loot(0x0b, ROOTS, 0d01, 0d00);
        },
        sniff_room_nne__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff_room_main__1_roots = @install() {
            debug_subtext("B=17");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },
        sniff_cave_outside__1_roots = @install() {
            debug_subtext("B=18");
            _loot(0x0e, ROOTS, 0d01, 0d00);
        },
        sniff_room_es__1_oil = @install() {
            debug_subtext("B=19");
            _loot(0x0f, OIL, 0d01, 0d00);
        },
        sniff_room_s__1_oil = @install() {
            debug_subtext("B=20");
            _loot(0x10, OIL, 0d01, 0d00);
        },
        sniff_room_nw__1_oil = @install() {
            debug_subtext("B=21");
            _loot(0x11, OIL, 0d01, 0d00);
        },
        sniff_room_nss__1_wax = @install() {
            debug_subtext("B=22");
            _loot(0x12, WAX, 0d01, 0d00);
        },
        sniff_room_ns__1_wax = @install() {
            debug_subtext("B=23");
            _loot(0x13, WAX, 0d01, 0d00);
        },
        sniff_room_main__1_wax = @install() {
            debug_subtext("B=24");
            _loot(0x14, WAX, 0d01, 0d00);
        },
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // gourd_room_s_1 (ash)
        // object[0x01] = 0x01; // gourd_room_s_2 (wax)
        // object[0x02] = 0x01; // gourd_alchemist_west
        // object[0x03] = 0x01; // gourd_main (call bead)
        // object[0x04] = 0x01; // gourd_room_ns (ash)
        // object[0x05] = 0x01; // gourd_room_sw (ash)
        // object[0x06] = 0x01; // gourd_alchemist_hidden_2 (ash)
        // object[0x07] = 0x01; // gourd_alchemist_hidden_1 (water)
        // …
        // object[0x15] = 0x01; // gourd_cave_outside_1 (wax)
        // object[0x16] = 0x01; // gourd_cave_outside_2 (wax)

        fade_in();
    }
};
map volcano_rooms__main(VOLCANO_ROOMS) { // variant: main
    enum entrance {
        north = entrance(0xd3, 0x3d, SOUTH),
        east = entrance(0xf7, 0x5b, WEST),
        south = entrance(0xd5, 0x95, NORTH),
        west = entrance(0xbb, 0x5d, EAST),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_cave_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_east = @install() {
            debug_subtext("S=17");
        },
        exit_west = @install() {
            debug_subtext("S=18");
        },
        exit_north = @install() {
            debug_subtext("S=19");
        },

        exit_south = @install() {
            debug_subtext("S=20");
        },
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd__1_call_bead = @install() {
            debug_subtext("B=5");
            _loot_chest(0x03, CALL_BEADS, 0d01); // amount+=0
        },
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff__1_roots = @install() {
            debug_subtext("B=17");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff__1_wax = @install() {
            debug_subtext("B=24");
            _loot(0x14, WAX, 0d01, 0d00);
        },
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d7);
        // init_room(0d10);
        fade_in();
    }
};
map volcano_rooms__cave(VOLCANO_ROOMS) { // variant: cave
    enum entrance {
        south = entrance(0x54, 0xb1, NORTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = @install() {
            debug_subtext("S=2");
        },
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd__3_wax = @install() {
            debug_subtext("B=1");
            _loot_chest(0x16, WAX, 0d03);
        },
        gourd__1_wax = @install() {
            debug_subtext("B=2");
            _loot_chest(0x15, WAX, 0d01);
        },
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff__1_roots = @install() {
            debug_subtext("B=18");
            _loot(0x0e, ROOTS, 0d01, 0d00);
        },
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d9);
        fade_in();
    }
};
map volcano_rooms__room_nw(VOLCANO_ROOMS) { // variant: room_nw
    enum entrance {
        north = entrance(0x20, 0x85, SOUTH),
        west = entrance(0x01, 0xa3, EAST),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
        },
        exit_west = @install() {
            debug_subtext("S=1");
        },
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff__1_oil = @install() {
            debug_subtext("B=21");
            _loot(0x11, OIL, 0d01, 0d00);
        },
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d8);
        fade_in();
    }
};
map volcano_rooms__room_es(VOLCANO_ROOMS) { // variant: room_es
    enum entrance {
        east = entrance(0x67, 0x1c, WEST),
        south = entrance(0x4c, 0x39, NORTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_south = @install() {
            debug_subtext("S=10");
        },
        exit_east = @install() {
            debug_subtext("S=11");
        },
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff__1_oil = @install() {
            debug_subtext("B=19");
            _loot(0x0f, OIL, 0d01, 0d00);
        },
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d1);
        fade_in();
    }
};
map volcano_rooms__room_nss(VOLCANO_ROOMS) { // variant: room_nss
    enum entrance {
        north = entrance(0x9e, 0x05, SOUTH),
        south_1 = entrance(0x9e, 0x37, NORTH),
        south_2 = entrance(0x84, 0x37, NORTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_south_2 = @install() {
            debug_subtext("S=13");
        },
        exit_south_1 = @install() {
            debug_subtext("S=14");
        },
        exit_north = @install() {
            debug_subtext("S=15");
        },
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff__1_roots = @install() {
            debug_subtext("B=15");
            _loot(0x0b, ROOTS, 0d01, 0d00);
        },
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff__1_wax = @install() {
            debug_subtext("B=22");
            _loot(0x12, WAX, 0d01, 0d00);
        },
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d2);
        fade_in();
    }
};
map volcano_rooms__room_s(VOLCANO_ROOMS) { // variant: room_s
    enum entrance {
        south = entrance(0x9e, 0x7b, NORTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_cave_south = nop(),
        exit_south = @install() {
            debug_subtext("S=3");
        },
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd__2_wax = @install() {
            debug_subtext("B=7");
            _loot_chest(0x01, WAX, 0d02);
        },
        gourd__3_ash = @install() {
            debug_subtext("B=8");
            _loot_chest(0x00, ASH, 0d03);
        },
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff__1_oil = @install() {
            debug_subtext("B=20");
            _loot(0x10, OIL, 0d01, 0d00);
        },
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d6);
        fade_in();
    }
};
map volcano_rooms__room_alchemist(VOLCANO_ROOMS) { // variant: room_alchemist
    enum entrance {
        north = entrance(0xd0, 0x05, SOUTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_north = @install() {
            debug_subtext("S=16");
        },
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff__1_ash = @install() {
            debug_subtext("B=0");
            _loot(0x17, ASH, 0d01, 0d00);
        },
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_west__3_water = @install() {
            debug_subtext("B=6");
            _loot_chest(0x02, WATER, 0d03);
        },
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_hidden_2__5_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x06, WAX, 0d05);
        },
        gourd_hidden_1__6_water = @install() {
            debug_subtext("B=10");
            _loot_chest(0x07, WATER, 0d06);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d3);
        fade_in();
    }
};
map volcano_rooms__room_ns(VOLCANO_ROOMS) { // variant: room_ns
    enum entrance {
        north = entrance(0x1c, 0x3d, SOUTH),
        south = entrance(0x22, 0x7b, NORTH),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_south = @install() {
            debug_subtext("S=5");
        },
        exit_room_sw_west = nop(),
        exit_north = @install() {
            debug_subtext("S=7");
        },
        exit_room_sw_south = nop(),
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd__4_ash = @install() {
            debug_subtext("B=3");
            _loot_chest(0x04, ASH, 0d04);
        },
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff_room_nne__1_water = nop(),
        sniff__1_clay = @install() {
            debug_subtext("B=14");
            _loot(0x0a, CLAY, 0d01, 0d00);
        },
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff__1_wax = @install() {
            debug_subtext("B=23");
            _loot(0x13, WAX, 0d01, 0d00);
        },
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d4);
        fade_in();
    }
};
map volcano_rooms__room_nne(VOLCANO_ROOMS) { // variant: room_nne
    enum entrance {
        north_1 = entrance(0x4c, 0x36, SOUTH),
        north_2 = entrance(0x60, 0x39, SOUTH),
        east = entrance(0x7f, 0x60, WEST),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_south = nop(),
        exit_room_s_south = nop(),
        exit_east = @install() {
            debug_subtext("S=4");
        },
        exit_room_ns_south = nop(),
        exit_room_sw_west = nop(),
        exit_room_ns_north = nop(),
        exit_room_sw_south = nop(),
        exit_north_1 = @install() {
            debug_subtext("S=9");
        },

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_north_2 = @install() {
            debug_subtext("S=12");
        },
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd_room_sw__4_ash = nop(),
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff_room_sw__1_water = nop(),
        sniff__1_water = @install() {
            debug_subtext("B=13");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d5);

        fade_in();
    }
};
map volcano_rooms__room_sw(VOLCANO_ROOMS) { // variant: room_sw
    enum entrance {
        south = entrance(0x1c, 0x3b, NORTH),
        west = entrance(0x01, 0x24, EAST),
    }

    enum stepon_trigger {
        exit_room_nw_north = nop(),
        exit_room_nw_west = nop(),
        exit_cave_south = nop(),
        exit_room_s_south = nop(),
        exit_room_nne_east = nop(),
        exit_room_ns_south = nop(),
        exit_west = @install() {
            debug_subtext("S=6");
        },
        exit_room_ns_north = nop(),
        exit_south = @install() {
            debug_subtext("S=8");
        },
        exit_room_nne_north_1 = nop(),

        exit_room_es_south = nop(),
        exit_room_es_east = nop(),
        exit_room_nne_north_2 = nop(),
        exit_room_nss_south_2 = nop(),
        exit_room_nss_south_1 = nop(),
        exit_room_nss_north = nop(),
        exit_room_alchemist_north = nop(),
        exit_main_east = nop(),
        exit_main_west = nop(),
        exit_main_north = nop(),

        exit_main_south = nop(),
    }
    
    enum b_trigger {
        sniff_room_alchemist__1_ash = nop(),
        gourd_cave_outside__3_wax = nop(),
        gourd_cave_outside__1_wax = nop(),
        gourd_room_ns__4_ash = nop(),
        gourd__4_ash = @install() {
            debug_subtext("B=4");
            _loot_chest(0x05, ASH, 0d04);
        },
        gourd_main__1_call_bead = nop(),
        gourd_alchemist_west__3_water = nop(),
        gourd_room_s__2_wax = nop(),
        gourd_room_s__3_ash = nop(),
        gourd_alchemist_hidden_2__5_wax = nop(),
        gourd_alchemist_hidden_1__6_water = nop(),
        sniff__1_ash = @install() {
            debug_subtext("B=11");
            _loot_chest(0x05, ASH, 0d04);
        },
        sniff__1_water = @install() {
            debug_subtext("B=12");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        sniff_room_nne__1_water = nop(),
        sniff_room_ns__1_clay = nop(),
        sniff_room_nss__1_roots = nop(),
        sniff_room_nne__1_roots = nop(),
        sniff_room_main__1_roots = nop(),
        sniff_cave_outside__1_roots = nop(),
        sniff_room_es__1_oil = nop(),
        sniff_room_s__1_oil = nop(),
        sniff_room_nw__1_oil = nop(),
        sniff_room_nss__1_wax = nop(),
        sniff_room_ns__1_wax = nop(),
        sniff_room_main__1_wax = nop(),
    }

    fun init_room(index) {
        if(index == 0d0) {
            init_map(0x00, 0x04, 0x2a, 0x3c); // room_sw
        } else if(index == 0d1) {
            init_map(0x3a, 0x08, 0x68, 0x38); // room_es
        } else if(index == 0d2) {
            init_map(0x78, 0x06, 0xb0, 0x38); // room_nss
        } else if(index == 0d3) {
            init_map(0xbe, 0x04, 0xfc, 0x36); // room_alchemist
        } else if(index == 0d4) {
            init_map(0x0a, 0x3c, 0x30, 0x7c); // room_ns
        } else if(index == 0d5) {
            init_map(0x40, 0x38, 0x80, 0x6c); // room_nne
        } else if(index == 0d6) {
            init_map(0x8c, 0x46, 0xb2, 0x7c); // room_s
        } else if(index == 0d7) {
            init_map(0xb4, 0x3c, 0xf8, 0x96); // room_main (downstairs)
        } else if(index == 0d8) {
            init_map(0x01, 0x83, 0x2b, 0xb1); // room_nw
        } else if(index == 0d9) {
            init_map(0x3f, 0x89, 0x6c, 0xb2); // room_outside_cave
        } else if(index == 0d10) {
            init_map(0xba, 0x3c, 0xf8, 0x96); // room_main (upstairs)
        }
    }

    fun trigger_enter() {
        init_room(0d0);
        fade_in();
    }
};

map pipe_maze(PIPEMAZE) {
    enum entrance {
        pipe_east = entrance(0x67, 0x94, NONE),
        pipe_west = entrance(0x5b, 0x94, NONE),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        stepon_9 = @install() {
            debug_subtext("S=9");
        },

        stepon_10 = @install() {
            debug_subtext("S=10");
        },
        stepon_11 = @install() {
            debug_subtext("S=11");
        },
        stepon_12 = @install() {
            debug_subtext("S=12");
        },
        stepon_13 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        stepon_17 = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },

        stepon_20 = @install() {
            debug_subtext("S=20");
        },
        stepon_21 = @install() {
            debug_subtext("S=21");
        },
        stepon_22 = @install() {
            debug_subtext("S=22");
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        stepon_24 = @install() {
            debug_subtext("S=24");
        },
        stepon_25 = @install() {
            debug_subtext("S=25");
        },
        stepon_26 = @install() {
            debug_subtext("S=26");
        },
        stepon_27 = @install() {
            debug_subtext("S=27");
        },
        stepon_28 = @install() {
            debug_subtext("S=28");
        },
        stepon_29 = @install() {
            debug_subtext("S=29");
        },

        stepon_30 = @install() {
            debug_subtext("S=30");
        },
        stepon_31 = @install() {
            debug_subtext("S=31");
        },
        stepon_32 = @install() {
            debug_subtext("S=32");
        },
        stepon_33 = @install() {
            debug_subtext("S=33");
        },
        stepon_34 = @install() {
            debug_subtext("S=34");
        },
        stepon_35 = @install() {
            debug_subtext("S=35");
        },
        stepon_36 = @install() {
            debug_subtext("S=36");
        },
        stepon_37 = @install() {
            debug_subtext("S=37");
        },
        stepon_38 = @install() {
            debug_subtext("S=38");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map pipe_rooms(PIPEMAZE_ROOMS) {
    enum entrance {
        pipe_east = entrance(0x07, 0x17, NONE),
        south = entrance(0x1a, 0x2f, NORTH),
        pipe_west = entrance(0x2d, 0x17, NONE),
        
        room_switch = entrance(0xbf, 0x23, NONE),
        room_gate = entrance(0x87, 0x1f, NONE),
        gate = entrance(0x98, 0x10, SOUTH),
        room_empty = entrance(0x6f, 0x1b, NONE),
    }

    enum stepon_trigger {
        switch_triggered = @install() {
            debug_subtext("S=0");
        },
        exit_room_switch = @install() {
            debug_subtext("S=1");
        },
        exit_room_gate = @install() {
            debug_subtext("S=2");
        },
        exit_room_empty = @install() {
            debug_subtext("S=3");
        },
        exit_north_1 = @install() {
            debug_subtext("S=4");
        },
        exit_north_2 = @install() {
            debug_subtext("S=5");
        },
        jump_room_switch = @install() {
            debug_subtext("S=6");
        },
        jump_room_gate = @install() {
            debug_subtext("S=7");
        },
        exit_south = @install() {
            debug_subtext("S=8");
        },
        jump_empty_room = @install() {
            debug_subtext("S=9");
        },

        exit_gate = @install() {
            debug_subtext("S=10");
        },
        approach_gate = @install() {
            debug_subtext("S=11");
        },
    }

    enum b_trigger {
        sniff__1_wax = @install() {
            debug_subtext("B=0");
            _loot(0x10, WAX, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=1");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=3");
            _loot(0x0d, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x0b, CLAY, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0a, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        gourd__1_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x07, WAX, 0d01);
        },

        gourd__1_oil = @install() {
            debug_subtext("B=10");
            _loot_chest(0x00, OIL, 0d01);
            // _loot_chest(0x00, WAX, 0d01);
        },
        gourd__1_oil = @install() {
            debug_subtext("B=11");
            _loot_chest(0x03, OIL, 0d01);
        },
        gourd__1_clay = @install() {
            debug_subtext("B=12");
            _loot_chest(0x02, CLAY, 0d01);
            // _loot_chest(0x02, CLAY, 0d01);
        },
        gourd__1_ash = @install() {
            debug_subtext("B=13");
            _loot_chest(0x03, ASH, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // show gourd_empty_room_west
        // object[0x01] = 0x01; // show gourd_empty_room_north
        // object[0x02] = 0x01; // show gourd_empty_room_center
        // object[0x03] = 0x01; // show gourd_empty_room_east
        // object[0x04] = 0x01; // hide bones_empty_room_1
        // object[0x05] = 0x01; // hide bones_empty_room_2
        // object[0x06] = 0x7e; // open gate
        // object[0x07] = 0x02; // loot gourd_entrance

        fade_in();
    }
};
map pipe_rooms_entrance(PIPEMAZE_ROOMS) { // variation: entrance
    enum entrance {
        pipe_east = entrance(0x07, 0x17, NONE),
        south = entrance(0x1a, 0x2f, NORTH),
        pipe_west = entrance(0x2d, 0x17, NONE),
    }

    enum stepon_trigger {
        switch_triggered = nop(),
        exit_room_switch = nop(),
        exit_room_gate = nop(),
        exit_room_empty = nop(),
        exit_north_1 = @install() {
            debug_subtext("S=4");
        },
        exit_north_2 = @install() {
            debug_subtext("S=5");
        },
        jump_room_switch = nop(),
        jump_room_gate = nop(),
        exit_south = @install() {
            debug_subtext("S=8");
        },
        jump_empty_room = nop(),

        exit_gate = nop(),
        approach_gate = nop(),
    }

    enum b_trigger {
        sniff__1_wax = @install() {
            debug_subtext("B=0");
            _loot(0x10, WAX, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=1");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=3");
            _loot(0x0d, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x0b, CLAY, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0a, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        gourd__1_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x07, WAX, 0d01);
        },

        gourd__1_oil = @install() {
            debug_subtext("B=10");
            _loot_chest(0x00, OIL, 0d01);
            // _loot_chest(0x00, WAX, 0d01);
        },
        gourd__1_oil = @install() {
            debug_subtext("B=11");
            _loot_chest(0x03, OIL, 0d01);
        },
        gourd__1_clay = @install() {
            debug_subtext("B=12");
            _loot_chest(0x02, CLAY, 0d01);
            // _loot_chest(0x02, CLAY, 0d01);
        },
        gourd__1_ash = @install() {
            debug_subtext("B=13");
            _loot_chest(0x03, ASH, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x07] = 0x02; // loot gourd_entrance
        
        fade_in();
    }
};
map pipe_rooms_gateswitch(PIPEMAZE_ROOMS) { // variation
    enum entrance {
        pipe_switch = entrance(0xbf, 0x23, NONE),
        pipe_gate = entrance(0x87, 0x1f, NONE),
    }

    enum stepon_trigger {
        switch_triggered = @install() {
            debug_subtext("S=0");
        },
        exit_room_switch = @install() {
            debug_subtext("S=1");
        },
        exit_room_gate = @install() {
            debug_subtext("S=2");
        },
        exit_room_empty = nop(),
        exit_north_1 = nop(),
        exit_north_2 = nop(),
        jump_room_switch = @install() {
            debug_subtext("S=6");
        },
        jump_room_gate = @install() {
            debug_subtext("S=7");
        },
        exit_south = nop(),
        jump_empty_room = nop(),

        exit_gate = @install() {
            debug_subtext("S=10");
        },
        approach_gate = @install() {
            debug_subtext("S=11");
        },
    }

    enum b_trigger {
        sniff__1_wax = @install() {
            debug_subtext("B=0");
            _loot(0x10, WAX, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=1");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=3");
            _loot(0x0d, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x0b, CLAY, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0a, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        gourd__1_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x07, WAX, 0d01);
        },

        gourd__1_oil = @install() {
            debug_subtext("B=10");
            _loot_chest(0x00, OIL, 0d01);
            // _loot_chest(0x00, WAX, 0d01);
        },
        gourd__1_oil = @install() {
            debug_subtext("B=11");
            _loot_chest(0x03, OIL, 0d01);
        },
        gourd__1_clay = @install() {
            debug_subtext("B=12");
            _loot_chest(0x02, CLAY, 0d01);
            // _loot_chest(0x02, CLAY, 0d01);
        },
        gourd__1_ash = @install() {
            debug_subtext("B=13");
            _loot_chest(0x03, ASH, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x06] = 0x7e; // open gate

        fade_in();
    }
};
map pipe_rooms_empty(PIPEMAZE_ROOMS) { // variation
    enum entrance {
        room_empty = entrance(0x6f, 0x1b, NONE),
    }

    enum stepon_trigger {
        switch_triggered = nop(),
        exit_room_switch = nop(),
        exit_room_gate = nop(),
        exit_room_empty = @install() {
            debug_subtext("S=3");
        },
        exit_north_1 = nop(),
        exit_north_2 = nop(),
        jump_room_switch = nop(),
        jump_room_gate = nop(),
        exit_south = nop(),
        jump_empty_room = @install() {
            debug_subtext("S=9");
        },

        exit_gate = nop(),
        approach_gate = nop(),
    }

    enum b_trigger {
        sniff__1_wax = @install() {
            debug_subtext("B=0");
            _loot(0x10, WAX, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=1");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x0e, ASH, 0d01, 0d00);
        },
        sniff__1_oil = @install() {
            debug_subtext("B=3");
            _loot(0x0d, OIL, 0d01, 0d00);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x0c, ROOTS, 0d01, 0d00);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=5");
            _loot(0x0b, CLAY, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=6");
            _loot(0x0a, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=7");
            _loot(0x09, WATER, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=8");
            _loot(0x08, WATER, 0d01, 0d00);
        },
        gourd__1_wax = @install() {
            debug_subtext("B=9");
            _loot_chest(0x07, WAX, 0d01);
        },

        gourd__1_oil = @install() {
            debug_subtext("B=10");
            _loot_chest(0x00, OIL, 0d01);
            // _loot_chest(0x00, WAX, 0d01);
        },
        gourd__1_oil = @install() {
            debug_subtext("B=11");
            _loot_chest(0x03, OIL, 0d01);
        },
        gourd__1_clay = @install() {
            debug_subtext("B=12");
            _loot_chest(0x02, CLAY, 0d01);
            // _loot_chest(0x02, CLAY, 0d01);
        },
        gourd__1_ash = @install() {
            debug_subtext("B=13");
            _loot_chest(0x03, ASH, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x01] = 0x01; // show gourd_empty_room_west
        // object[0x01] = 0x01; // show gourd_empty_room_north
        // object[0x02] = 0x01; // show gourd_empty_room_center
        // object[0x03] = 0x01; // show gourd_empty_room_east
        // object[0x04] = 0x01; // hide bones_empty_room_1
        // object[0x05] = 0x01; // hide bones_empty_room_2

        fade_in();
    }
};

map magmar(MAGMAR) {
    enum entrance {
        south = entrance(0x18, 0x47, NORTH)
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

// act 2

map act2_intro(CUTSCENE_WATERFALL) {
    enum entrance {
        cinematic = entrance(0x11, 0x00, NONE)
    }

    fun trigger_enter() {
        fade_in();
    }
};

map river(CUTSCENE_RIVER) {
    enum entrance {
        south = entrance(0x10, 0x10, NONE)
    }

    fun trigger_enter() {
        fade_in();
    }
};

map ship(CRUSTICIA) {
    enum entrance {
        east = entrance(0x5f, 0x5b, WEST),
        west = entrance(0x05, 0x59, EAST),

        door_1_1 = entrance(0x59, 0x2d, SOUTH),
        door_2_1 = entrance(0x30, 0x24, SOUTH),
        door_2_2 = entrance(0x32, 0x40, SOUTH),
        door_3_1 = entrance(0x13, 0x0d, SOUTH),
        door_3_2 = entrance(0x4b, 0x0d, SOUTH),
    }

    enum stepon_trigger {
        door_3_1_stairs = @install() {
            debug_subtext("S=0");
        },
        door_3_2_stairs = @install() {
            debug_subtext("S=1");
        },
        door_2_2_stairs = @install() {
            debug_subtext("S=2");
        },
        door_1_1_stairs = @install() {
            debug_subtext("S=3");
        },
        lift_top = @install() {
            debug_subtext("S=4");
        },
        exit_west = @install() {
            debug_subtext("S=5");
        },
        door_3_1 = @install() {
            debug_subtext("S=6");
        },
        door_2_2 = @install() {
            debug_subtext("S=7");
        },
        door_2_1 = @install() {
            debug_subtext("S=8");
        },
        door_1_1 = @install() {
            debug_subtext("S=9");
        },

        door_3_2 = @install() {
            debug_subtext("S=10");
        },
        exit_east = @install() {
            debug_subtext("S=11");
        },
        lift_bottom = @install() {
            debug_subtext("S=12");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map ship_inside(CRUSTICIA_CAVES) {
    enum entrance {
        cave_hammock = entrance(0x0f, 0x29, NORTH),
        cave_crates = entrance(0x0f, 0x5b, NORTH),
        ship_small = entrance(0x47, 0x51, NORTH),
        ship_tavern = entrance(0x6f, 0x51, NORTH),
        cave_monk = entrance(0x4f, 0x23, NORTH),
    }

    enum stepon_trigger {
        monk = @install() {
            debug_subtext("S=0");
        },
        monk_trigger_west = @install() {
            debug_subtext("S=1");
        },
        monk_trigger_south = @install() {
            debug_subtext("S=2");
        },
        exit_cave_hammock = @install() {
            debug_subtext("S=3");
        },
        exit_ship_tavern = @install() {
            debug_subtext("S=4");
        },
        exit_ship_small = @install() {
            debug_subtext("S=5");
        },
        exit_cave_crates = @install() {
            debug_subtext("S=6");
        },
        exit_cave_monk = @install() {
            debug_subtext("S=7");
        },
    }

    enum b_trigger {
        gourd_hammock__1_water = @install() {
            debug_subtext("B=0");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_monk_1__1_nectar = @install() {
            debug_subtext("B=1");
            _loot_chest(0x02, NECTAR, 0d01);
        },
        gourd_monk_2__1_clay = @install() {
            debug_subtext("B=2");
            _loot_chest(0x01, CLAY, 0d01);
        },
        gourd_crates__1_nectar = @install() {
            debug_subtext("B=3");
            _loot_chest(0x04, NECTAR, 0d01);
        },
        groud_tavern__1_wax = @install() {
            debug_subtext("B=4");
            _loot_chest(0x06, WAX, 0d01);
        },
        gourd_ship__1_water = @install() {
            debug_subtext("B=5");
            _loot_chest(0x05, WATER, 0d01);
        },
        tavern_barkeeper = @install() {
            debug_subtext("B=6");
        },
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        // ???
        // object[0x01] = 0x01; // loot gourd_monk_2
        // object[0x02] = 0x01; // loot gourd_monk_1
        // object[0x03] = 0x01; // loot gourd_hammock
        // object[0x04] = 0x01; // loot gourd_crates
        // object[0x05] = 0x01; // loot gourd_ship
        // object[0x06] = 0x01; // loot gourd_tavern

        fade_in();
    }
};
map ship_inside__hammock(CRUSTICIA_CAVES) { // variant: hammock
    enum entrance {
        south = entrance(0x0f, 0x29, NORTH),
    }

    enum stepon_trigger {
        monk = nop(),
        monk_trigger_west = nop(),
        monk_trigger_south = nop(),
        exit_south = @install() {
            debug_subtext("S=3");
        },
        exit_ship_tavern = nop(),
        exit_ship_small = nop(),
        exit_cave_crates = nop(),
        exit_cave_monk = nop(),
    }

    enum b_trigger {
        gourd_hammock__1_water = @install() {
            debug_subtext("B=0");
            _loot_chest(0x03, WATER, 0d01);
        },
        gourd_monk_1__1_nectar = nop(),
        gourd_monk_2__1_clay = nop(),
        gourd_crates__1_nectar = nop(),
        groud_tavern__1_wax = nop(),
        gourd_ship__1_water = nop(),
        tavern_barkeeper = nop(),
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        // ???
        // object[0x03] = 0x01; // loot gourd_hammock

        init_room(0x00);
        fade_in();
    }
};
map ship_inside__crates(CRUSTICIA_CAVES) { // variant: crates
    enum entrance {
        south = entrance(0x0f, 0x5b, NORTH),
    }

    enum stepon_trigger {
        monk = nop(),
        monk_trigger_west = nop(),
        monk_trigger_south = nop(),
        exit_cave_hammock = nop(),
        exit_ship_tavern = nop(),
        exit_ship_small = nop(),
        exit_south = @install() {
            debug_subtext("S=6");
        },
        exit_cave_monk = nop(),
    }

    enum b_trigger {
        gourd_hammock__1_water = nop(),
        gourd_monk_1__1_nectar = nop(),
        gourd_monk_2__1_clay = nop(),
        gourd__1_nectar = @install() {
            debug_subtext("B=3");
            _loot_chest(0x04, NECTAR, 0d01);
        },
        groud_tavern__1_wax = nop(),
        gourd_ship__1_water = nop(),
        tavern_barkeeper = nop(),
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        // ???
        // object[0x04] = 0x01; // loot gourd_crates

        init_room(0x01);
        fade_in();
    }
};
map ship_inside__ship(CRUSTICIA_CAVES) { // variant: ship
    enum entrance {
        south = entrance(0x47, 0x51, NORTH),
    }

    enum stepon_trigger {
        monk = nop(),
        monk_trigger_west = nop(),
        monk_trigger_south = nop(),
        exit_cave_hammock = nop(),
        exit_ship_tavern = nop(),
        exit_south = @install() {
            debug_subtext("S=5");
        },
        exit_cave_crates = nop(),
        exit_cave_monk = nop(),
    }

    enum b_trigger {
        gourd_hammock__1_water = nop(),
        gourd_monk_1__1_nectar = nop(),
        gourd_monk_2__1_clay = nop(),
        gourd_crates__1_nectar = nop(),
        groud_tavern__1_wax = nop(),
        gourd__1_water = @install() {
            debug_subtext("B=5");
            _loot_chest(0x05, WATER, 0d01);
        },
        tavern_barkeeper = nop(),
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        // ???
        // object[0x05] = 0x01; // loot gourd_ship

        init_room(0x02);
        fade_in();
    }
};
map ship_inside__tavern(CRUSTICIA_CAVES) { // variant: tavern
    enum entrance {
        south = entrance(0x6f, 0x51, NORTH),
    }

    enum stepon_trigger {
        monk = nop(),
        monk_trigger_west = nop(),
        monk_trigger_south = nop(),
        exit_cave_hammock = nop(),
        exit_south = @install() {
            debug_subtext("S=4");
        },
        exit_ship_small = nop(),
        exit_cave_crates = nop(),
        exit_cave_monk = nop(),
    }

    enum b_trigger {
        gourd_hammock__1_water = nop(),
        gourd_monk_1__1_nectar = nop(),
        gourd_monk_2__1_clay = nop(),
        gourd_crates__1_nectar = nop(),
        groud__1_wax = @install() {
            debug_subtext("B=4");
            _loot_chest(0x06, WAX, 0d01);
        },
        gourd_ship__1_water = nop(),
        tavern_barkeeper = @install() {
            debug_subtext("B=6");
        },
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        // ???
        // object[0x06] = 0x01; // loot gourd_tavern

        init_room(0x03);
        fade_in();
    }
};
map ship_inside__monk(CRUSTICIA_CAVES) { // variant: monk
    enum entrance {
        south = entrance(0x4f, 0x23, NORTH),
    }

    enum stepon_trigger {
        monk = @install() {
            debug_subtext("S=0");
        },
        monk_trigger_west = @install() {
            debug_subtext("S=1");
        },
        monk_trigger_south = @install() {
            debug_subtext("S=2");
        },
        exit_cave_hammock = nop(),
        exit_ship_tavern = nop(),
        exit_ship_small = nop(),
        exit_cave_crates = nop(),
        exit_south = @install() {
            debug_subtext("S=7");
        },
    }

    enum b_trigger {
        gourd_hammock__1_water = nop(),
        gourd_1__1_nectar = @install() {
            debug_subtext("B=1");
            _loot_chest(0x02, NECTAR, 0d01);
        },
        gourd_2__1_clay = @install() {
            debug_subtext("B=2");
            _loot_chest(0x01, CLAY, 0d01);
        },
        gourd_crates__1_nectar = nop(),
        groud_tavern__1_wax = nop(),
        gourd_ship__1_water = nop(),
        tavern_barkeeper = nop(),
    }

    fun init_room(index) {
        if(index == 0x00) {
            init_map(0x00, 0x00, 0x2e, 0x2a); // hammock
        } else if(index == 0x01) {
            init_map(0x00, 0x38, 0x26, 0x5c); // crates
        } else if(index == 0x02) {
            init_map(0x32, 0x36, 0x56, 0x52); // ship
        } else if(index == 0x03) {
            init_map(0x58, 0x30, 0x86, 0x4e); // tavern
        } else if(index == 0x04) {
            init_map(0x40, 0x00, 0x66, 0x24); // monk
        }
    }

    fun trigger_enter() {
        init_room(0x04);
        fade_in();
    }
};

map blimp_exterior(BLIMP_EXTERIOR) {
    enum entrance {
        north = entrance(0x27, 0x01, SOUTH),
        cave = entrance(0x15, 0x1a, SOUTH),
        east = entrance(0x3f, 0x4b, WEST),
        west = entrance(0x01, 0x4b, EAST),

        crash = entrance(0x32, 0x1e, NONE),

        elevator_top = entrance(0x0d, 0x2b, SOUTH),
        elevator_bottom = entrance(0x1b, 0x47, SOUTH),
    }

    @install()
    fun ravine_triggered() {
        // generic_fall(0d100);
        nop();
    }

    enum todo2 {
    // enum stepon_trigger {
        ravine_1 = ravine_triggered(),
        ravine_2 = ravine_triggered(),
        ravine_3 = ravine_triggered(),
        ravine_4 = ravine_triggered(),
        ravine_5 = ravine_triggered(),
        ravine_6 = ravine_triggered(),
        ravine_7 = ravine_triggered(),
        ravine_8 = ravine_triggered(),
        ravine_9 = ravine_triggered(),
        ravine_10 = ravine_triggered(),

        ravine_11 = ravine_triggered(),
        ravine_12 = ravine_triggered(),
        ravine_13 = ravine_triggered(),
        ravine_14 = ravine_triggered(),
        ravine_15 = ravine_triggered(),
        ravine_16 = ravine_triggered(),
        ravine_17 = ravine_triggered(),
        ravine_18 = ravine_triggered(),
        ravine_19 = ravine_triggered(),
        exit_east = @install() {
            debug_subtext("S=20");
        },

        exit_cave = @install() {
            debug_subtext("S=21");
        },
        exit_west = @install() {
            debug_subtext("S=22");
        },
        elevator_bottom = @install() {
            debug_subtext("S=23");
        },
        elevator_top = @install() {
            debug_subtext("S=24");
        },
        exit_north = @install() {
            debug_subtext("S=25");
        }
    }

    enum todo {
    // enum b_trigger {
        sniff__1_ethanol_3 = @install() {
            debug_subtext("B=0");
            _loot(0x01, ETHANOL, 0d01, 0d03);
        },
        sniff__1_ethanol_1 = @install() {
            debug_subtext("B=1");
            _loot(0x02, ETHANOL, 0d01, 0d01);
        },
        sniff__1_ethanol_2 = @install() {
            debug_subtext("B=2");
            _loot(0x03, ETHANOL, 0d01, 0d02);
        },
        sniff__1_ethanol = @install() {
            debug_subtext("B=3");
            _loot(0x04, ETHANOL, 0d01, 0d00);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=4");
            _loot(0x05, ROOTS, 0d01, 0d01);
        },
        sniff__1_limestone = @install() {
            debug_subtext("B=5");
            _loot(0x06, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=6");
            _loot(0x07, LIMESTONE, 0d01, 0d02);
        },
        sniff__1_wax_1 = @install() {
            debug_subtext("B=7");
            _loot(0x08, WAX, 0d01, 0d01);
        },
        sniff__1_wax = @install() {
            debug_subtext("B=8");
            _loot(0x09, WAX, 0d01, 0d00);
        },
        sniff__1_wax_2 = @install() {
            debug_subtext("B=9");
            _loot(0x0a, WAX, 0d01, 0d02);
        },

        sniff__1_vinegar_2 = @install() {
            debug_subtext("B=10");
            _loot(0x0b, VINEGAR, 0d01, 0d02);
        },
        sniff__1_bone_3 = @install() {
            debug_subtext("B=11");
            _loot(0x0c, BONE, 0d01, 0d03);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=12");
            _loot(0x0d, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone_2 = @install() {
            debug_subtext("B=13");
            _loot(0x0e, BRIMSTONE, 0d01, 0d02);
        },
        gourd_1__1_call_beads = @install() {
            debug_subtext("B=14");
            _loot_chest(0x0f, CALL_BEADS, 0d01);
        },
        gourd_2__200_money = @install() {
            debug_subtext("B=15");
            _loot_chest(0x10, MONEY, 0d200);
        }
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // show bridge_north
        // …
        // object[0x0f] = 0x01; // loot gourd_1
        // object[0x10] = 0x01; // loot gourd_2
        // object[0x11] = 0x01; // show bridge_east

        fade_in();
    }
};

map blimp(BLIMP) {
    enum entrance {
        south = entrance(0x13, 0x1b, NORTH),
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
    }

    enum b_trigger {
        gourd_1__1_wax = @install() {
            debug_subtext("B=0");
            _loot_chest(0x00, WAX, 0x01);
        },
        gourd_2__1_ash = @install() {
            debug_subtext("B=1");
            _loot_chest(0x01, ASH, 0x01);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // loot gourd_1
        // object[0x01] = 0x01; // loot gourd_2

        fade_in();
    }
};

map crusticia_firepit(FIREPIT_BEACH) {
    enum entrance {
        west = entrance(0x03, 0x1f, EAST),
    }

    enum stepon_trigger {
        exit_east = @install() {
            debug_subtext("S=0");
        },
        windwalker = @install() {
            debug_subtext("S=1");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // ignite fire
        // object[0x01] = 0x02; // show windwalker_collision

        fade_in();
    }
};

map desert(DESERT) {
    enum entrance {
        test = entrance(0x03, 0xf, EAST),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        exit_north_3 = @install() {
            debug_subtext("S=2");
        },
        exit_north_2 = @install() {
            debug_subtext("S=3");
        },
        exit_north_1 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        exit_south_1 = @install() {
            debug_subtext("S=8");
        },
        exit_south_2 = @install() {
            debug_subtext("S=9");
        },

        exit_west_1 = @install() {
            debug_subtext("S=10");
        },
        exit_east_2 = @install() {
            debug_subtext("S=11");
        },
        exit_east_1 = @install() {
            debug_subtext("S=12");
        },
        exit_west_2 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        oasis = @install() {
            debug_subtext("S=16");
        },
        exit_nobilia = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // show oasis
        // ???

        fade_in();
    }
};

map nobilia_inn(NOBILIA_HOUSES) {
    enum entrance {
        shop_south_1 = entrance(0x51, 0x1b, NORTH),
        shop_south_2 = entrance(0x0d, 0x1b, NORTH),

        inn_south = entrance(0x0b, 0x14, NORTH),
    }

    enum stepon_trigger {
        exit_shop_south_2 = @install() {
            debug_subtext("S=0");
        },
        exit_inn_south = @install() {
            debug_subtext("S=1");
        },
        atlas = @install() {
            debug_subtext("S=2");
        },
        exit_shop_south_1 = @install() {
            debug_subtext("S=3");
        },
    }

    enum b_trigger {
        b_trigger_0 = @install() {
            debug_subtext("B=0");
        },
        b_trigger_1 = @install() {
            debug_subtext("B=1");
        },
    }

    fun init_room(index) {
        if(index == 0x01) {
            init_map(0x02, 0x00, 0x5a, 0x1c);
        } else if(index == 0x02) {
            init_map(0x00, 0x24, 0x24, 0x42);
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};
map nobilia_inn__shop(NOBILIA_HOUSES) { // variant: shop
    enum entrance {
        south_1 = entrance(0x51, 0x1b, NORTH),
        south_2 = entrance(0x0d, 0x1b, NORTH),
    }

    enum stepon_trigger {
        exit_south_2 = @install() {
            debug_subtext("S=0");
        },
        exit_inn_south = nop(),
        atlas = @install() {
            debug_subtext("S=2");
        },
        exit_south_1 = @install() {
            debug_subtext("S=3");
        },
    }

    enum b_trigger {
        b_trigger_0 = @install() {
            debug_subtext("B=0");
        },
        b_trigger_1 = @install() {
            debug_subtext("B=1");
        },
    }

    fun init_room(index) {
        if(index == 0x01) {
            init_map(0x02, 0x00, 0x5a, 0x1c);
        } else if(index == 0x02) {
            init_map(0x00, 0x24, 0x24, 0x42);
        }
    }

    fun trigger_enter() {
        init_room(0x01);

        fade_in();
    }
};
map nobilia_inn__inn(NOBILIA_HOUSES) { // variant: inn
    enum entrance {
        south = entrance(0x0b, 0x14, NORTH),
    }

    enum stepon_trigger {
        exit_shop_south_2 = nop(),
        exit_south = @install() {
            debug_subtext("S=1");
        },
        atlas = nop(),
        exit_shop_south_1 = nop(),
    }

    enum b_trigger {
        b_trigger_0 = @install() {
            debug_subtext("B=0");
        },
        b_trigger_1 = @install() {
            debug_subtext("B=1");
        },
    }

    fun init_room(index) {
        if(index == 0x01) {
            init_map(0x02, 0x00, 0x5a, 0x1c);
        } else if(index == 0x02) {
            init_map(0x00, 0x24, 0x24, 0x42);
        }
    }

    fun trigger_enter() {
        init_room(0x02);

        fade_in();
    }
};

map nobilia_market(NOBILIA_MARKET) {
    enum entrance {
        north_1 = entrance(0x0f, 0x08, SOUTH),
        north_2 = entrance(0x30, 0x08, SOUTH),
        north_3 = entrance(0x54, 0x08, SOUTH),
        east_1 = entrance(0x5f, 0x18, WEST),
        east_2 = entrance(0x5f, 0x46, WEST),
        west = entrance(0x05, 0x4b, EAST),

        door_1 = entrance(0x5c, 0x36, SOUTH),
        door_2 = entrance(0x5a, 0x72, SOUTH),
    }

    enum stepon_trigger {
        prophet_south = @install() {
            debug_subtext("S=0");
        },
        prophet_east = @install() {
            debug_subtext("S=1");
        },
        prophet_north = @install() {
            debug_subtext("S=2");
        },
        exit_north_2 = @install() {
            debug_subtext("S=3");
        },
        exit_north_3 = @install() {
            debug_subtext("S=4");
        },
        exit_north_1 = @install() {
            debug_subtext("S=5");
        },
        exit_east_1 = @install() {
            debug_subtext("S=6");
        },
        exit_east_2 = @install() {
            debug_subtext("S=7");
        },
        exit_west = @install() {
            debug_subtext("S=8");
        },
        door_1 = @install() {
            debug_subtext("S=9");
        },

        door_2 = @install() {
            debug_subtext("S=10");
        },
    }

    enum b_trigger {
        person_4_1__chicken_feeding = @install() {
            debug_subtext("B=0");
        },
        chicken_xx = @install() {
            debug_subtext("B=1");
        },
        chicken_xx = @install() {
            debug_subtext("B=2");
        },
        prophet = @install() {
            debug_subtext("B=3");
        },
        vendor_10_5__glove = @install() {
            debug_subtext("B=4");
        },
        vendor_10_4__silver_sheath = @install() {
            debug_subtext("B=5");
        },
        vendor_10_3__appraisal = @install() {
            debug_subtext("B=6");
        },
        vendor_10_2__moxa_stick = @install() {
            debug_subtext("B=7");
        },
        vendor_10_1__sun_stone = @install() {
            debug_subtext("B=8");
        },
        vendor_7_2__limestone_tablet = @install() {
            debug_subtext("B=9");
        },

        vendor_7_1__jeweled_scarab = @install() {
            debug_subtext("B=10");
        },
        vendor_9_2__helmet = @install() {
            debug_subtext("B=11");
        },
        vendor_9_1__ruby_heart = @install() {
            debug_subtext("B=12");
        },
        vendor_8_2__jade_disk = @install() {
            debug_subtext("B=13");
        },
        vendor_8_1__beads = @install() {
            debug_subtext("B=14");
        },
        vendor_6_1__beads = @install() {
            debug_subtext("B=15");
        },
        vendor_5_4__currency = @install() {
            debug_subtext("B=16");
        },
        b_trigger_17 = @install() {
            debug_subtext("B=17");
        },
        vendor_5_2__spice = @install() {
            debug_subtext("B=18");
        },
        vendor_5_1__perfume = @install() {
            debug_subtext("B=19");
        },

        vendor_4_1__rice = @install() {
            debug_subtext("B=20");
        },
        vendor_4_2__beads = @install() {
            debug_subtext("B=21");
        },
        vendor_4_3__tapestry = @install() {
            debug_subtext("B=22");
        },
        vendor_3_4__polish = @install() {
            debug_subtext("B=23");
        },
        vendor_3_3__chest = @install() {
            debug_subtext("B=24");
        },
        vendor_3_2__amulet = @install() {
            debug_subtext("B=25");
        },
        vendor_3_1__jackal = @install() {
            debug_subtext("B=26");
        },
        vendor_2_3__pot = @install() {
            debug_subtext("B=27");
        },
        vendor_1_4__rice = @install() {
            debug_subtext("B=28");
        },
        vendor_1_3__fish = @install() {
            debug_subtext("B=29");
        },

        guard_1_1 = @install() {
            debug_subtext("B=30");
        },
        vendor_2_2__egg = @install() {
            debug_subtext("B=31");
        },
        vendor_2_1__spoon = @install() {
            debug_subtext("B=32");
        },
        vendor_1_1__spice = @install() {
            debug_subtext("B=33");
        },
        goat_xx = @install() {
            debug_subtext("B=34");
        },
        chicken_xx = @install() {
            debug_subtext("B=35");
        },
        goat_xx = @install() {
            debug_subtext("B=36");
        },
        chicken_xx = @install() {
            debug_subtext("B=37");
        },
        chicken_xx = @install() {
            debug_subtext("B=38");
        },
        chicken_xx = @install() {
            debug_subtext("B=39");
        },

        chicken_xx = @install() {
            debug_subtext("B=40");
        },
        chicken_xx = @install() {
            debug_subtext("B=41");
        },
        chicken_xx = @install() {
            debug_subtext("B=42");
        },
        chicken_xx = @install() {
            debug_subtext("B=43");
        },
        chicken_xx = @install() {
            debug_subtext("B=44");
        },
        chicken_xx = @install() {
            debug_subtext("B=45");
        },
        chicken_xx = @install() {
            debug_subtext("B=46");
        },
        chicken_xx = @install() {
            debug_subtext("B=47");
        },
        pot_hidden = @install() {
            debug_subtext("B=48");
        },
        guard_4_1 = @install() {
            debug_subtext("B=49");
        },

        person_4_2__juggler = @install() {
            debug_subtext("B=50");
        },
        goat_xx = @install() {
            debug_subtext("B=51");
        },
        goat_xx = @install() {
            debug_subtext("B=52");
        },
        vendor_1_2__rice = @install() {
            debug_subtext("B=53");
        },
        person_4_3__juggler_crowd_1 = @install() {
            debug_subtext("B=54");
        },
        person_4_3__juggler_crowd_2 = @install() {
            debug_subtext("B=55");
        },
        pot_xx = @install() {
            debug_subtext("B=56");
        },
        pot_xx = @install() {
            debug_subtext("B=57");
        },
    }

    fun open_doors(open) {
        if(open) {
            tile_animate(0x20, 0xff, 0x02);
        } else {
            tile_animate(0x20, 0xff, 0x00);
        }
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // remove vendor_1_1 (spice guy)
        // object[0x01] = 0x01; // remove vendor_1_2 (rice lady)
        // object[0x02] = 0x01; // remove guard_1_1 (next to rice lady)
        // object[0x03] = 0x01; // remove vendor_1_3 (fish lady)
        // object[0x04] = 0x01; // remove vendor_1_4 (other rice guy)
        // object[0x05] = 0x01; // remove vendor_2_1 (spoon lady)
        // object[0x06] = 0x01; // remove vendor_2_2 (egg guy)
        // object[0x07] = 0x01; // remove vendor_3_1 (jackal lady)
        // object[0x08] = 0x01; // remove vendor_2_3 (pot lady)
        // object[0x09] = 0x01; // remove person_4_1 (next to pot lady, feeds chicken)
        // object[0x0a] = 0x01; // remove vendor_3_2 (amulet guy)
        // object[0x0b] = 0x01; // remove vendor_3_3 (chest lady)
        // object[0x0c] = 0x01; // remove ???
        // object[0x0d] = 0x01; // remove vendor_3_4 (polish lady)
        // object[0x0e] = 0x01; // remove guard_4_1 (next to entrance)
        // object[0x0f] = 0x01; // remove vendor_4_1 (other rice lady)
        // object[0x10] = 0x01; // remove vendor_4_2 (other beads lady)
        // object[0x11] = 0x01; // remove person_4_2 (next to vendor_4_2, juggler)
        // object[0x12] = 0x01; // remove person_4_3 (next to vendor_4_2, juggler crowd)
        // object[0x13] = 0x01; // remove vendor_4_3 (tapestry lady)
        // object[0x14] = 0x01; // remove vendor_5_4 (currency lady)
        // object[0x15] = 0x01; // remove vendor_5_1 (perfume lady)
        // object[0x16] = 0x01; // remove vendor_5_2 (other spice guy)
        // object[0x17] = 0x01; // remove vendor_5_3 (chicken guy)
        // object[0x18] = 0x01; // remove vendor_6_1 (beads lady)
        // object[0x19] = 0x01; // remove vendor_7_2 (tablet lady)
        // object[0x1a] = 0x01; // remove vendor_8_1 (other beads guy)
        // object[0x1b] = 0x01; // remove vendor_8_2 (jade disk lady)
        // object[0x1c] = 0x01; // remove vendor_9_1 (heart lady)
        // object[0x1d] = 0x01; // remove vendor_9_2 (helmet guy)
        // object[0x1e] = 0x01; // remove vendor_7_1 (scarab lady)
        // object[0x1f] = 0x01; // remove vendor_10_1 (sunstone guy)
        // object[0x20] = 0x01; // remove vendor_10_2 (moxa lady)
        // object[0x21] = 0x01; // remove vendor_10_3 (appraisal lady)
        // object[0x22] = 0x01; // remove vendor_10_4 (sheath guy)
        // object[0x23] = 0x01; // remove ???
        // object[0x24] = 0x01; // remove vendor_11_1 (beads lady)
        // object[0x24] = 0x01; // remove vendor_10_5 (glove lady)
        // object[0x25] = 0x01; // remove ???
        // object[0x26] = 0x01; // remove basket (between vendor_1_1 ans vendor_1_2)
        // object[0x27] = 0x01; // remove prophet (goat, chicke, basket)
        
        fade_in();
    }
};

map nobilia_north(NOBILIA_NORTH) {
    enum entrance {
        north = entrance(0x40, 0x04, SOUTH),
        south_1 = entrance(0x72, 0x38, NORTH),
        south_2 = entrance(0x4c, 0x38, NORTH),
        south_3 = entrance(0x08, 0x38, NORTH),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
        },
        exit_south_1 = @install() {
            debug_subtext("S=1");
        },
        exit_south_2 = @install() {
            debug_subtext("S=2");
        },
        exit_south_1 = @install() {
            debug_subtext("S=3");
        },
        guard_right = @install() {
            debug_subtext("S=4");
        },
        guard_left = @install() {
            debug_subtext("S=5");
        },
    }

    enum b_trigger {
        chicken_1 = @install() {
            debug_subtext("B=0");
        },
        chicken_2 = @install() {
            debug_subtext("B=1");
        },
        chicken_3 = @install() {
            debug_subtext("B=2");
        },
        farmer = @install() {
            debug_subtext("B=3");
        },
        guard = @install() {
            debug_subtext("B=4");
        },
        b_trigger_5 = @install() {
            debug_subtext("B=5");
            _loot(0x01, WATER, 0d01, 0d01);
        },
        b_trigger_6 = @install() {
            debug_subtext("B=6");
            _loot(0x02, WATER, 0d01, 0d02);
        },
        b_trigger_7 = @install() {
            debug_subtext("B=7");
            _loot(0x03, WATER, 0d01, 0d00);
        },
        b_trigger_8 = @install() {
            debug_subtext("B=8");
            _loot(0x04, OIL, 0d01, 0d02);
        },
        b_trigger_9 = @install() {
            debug_subtext("B=9");
            _loot(0x05, OIL, 0d01, 0d01);
        },

        b_trigger_10 = @install() {
            debug_subtext("B=10");
            _loot(0x06, CRYSTAL, 0d01, 0d02);
        },
        b_trigger_11 = @install() {
            debug_subtext("B=11");
            _loot(0x07, CRYSTAL, 0d01, 0d03);
        },
        b_trigger_12 = @install() {
            debug_subtext("B=12");
            _loot(0x08, CLAY, 0d01, 0d01);
        },
        b_trigger_13 = @install() {
            debug_subtext("B=13");
            _loot(0x09, CLAY, 0d01, 0d02);
        },
        b_trigger_14 = @install() {
            debug_subtext("B=14");
            _loot(0x0a, CLAY, 0d01, 0d00);
        },
        b_trigger_15 = @install() {
            debug_subtext("B=15");
            _loot(0x0b, VINEGAR, 0d01, 0d01);
        },
        b_trigger_16 = @install() {
            debug_subtext("B=16");
            _loot(0x0c, VINEGAR, 0d01, 0d00);
        },
        b_trigger_17 = @install() {
            debug_subtext("B=17");
            _loot(0x0d, VINEGAR, 0d01, 0d03); // same as B=18
        },
        b_trigger_18 = @install() {
            debug_subtext("B=18");
            _loot(0x0d, VINEGAR, 0d01, 0d03);// same as B=17
        },
        b_trigger_19 = @install() {
            debug_subtext("B=19");
            _loot(0x0e, ATLAS_MEDALLION, 0d01, 0d00);
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map nobilia_center(NOBILIA_SQUARE) {
    enum entrance {
        north = entrance(0x2c, 0x03, SOUTH),
        east = entrance(0x5b, 0x37, WEST),
        west_1 = entrance(0x01, 0x40, EAST),
        west_2 = entrance(0x01, 0x14, EAST),
        door = entrance(0x08, 0x58, SOUTH),
    }

    enum stepon_trigger {
        exit_east = @install() {
            debug_subtext("S=0");
        },
        exit_door = @install() {
            debug_subtext("S=1");
        },
        exit_north = @install() {
            debug_subtext("S=2");
        },
        exit_west_1 = @install() {
            debug_subtext("S=3");
        },
        exit_west_2 = @install() {
            debug_subtext("S=4");
        },
    }

    enum b_trigger {
        guard_south = @install() {
            debug_subtext("B=0");
        },
        guard_center_1 = @install() {
            debug_subtext("B=1");
        },
        guard_center_2 = @install() {
            debug_subtext("B=2");
        },
        guard_north = @install() {
            debug_subtext("B=3");
        },
        b_trigger_4 = @install() {
            debug_subtext("B=4");
        },
    }

    fun open_door(open) {
        if(open) {
            tile_animate(0x20, 0xff, 0x02);
        } else {
            tile_animate(0x20, 0xff, 0x00);
        }
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // show crowd_1_1
        // object[0x01] = 0x01; // show crowd_1_2
        // object[0x02] = 0x01; // show crowd_1_3
        // object[0x03] = 0x01; // show crowd_1_4
        // object[0x04] = 0x01; // show crowd_1_5
        // object[0x05] = 0x01; // show crowd_2_1
        // object[0x06] = 0x01; // show crowd_2_2
        // object[0x07] = 0x01; // show crowd_2_3
        // object[0x08] = 0x01; // show crowd_2_4
        // object[0x09] = 0x01; // show crowd_2_5
        // object[0x0a] = ???
        // object[0x0b] = same as crowd_2_2 ???
        // object[0x0c] = same as crowd_1_3 ???
        // object[0x0d] = 0x02; // show statue, crater, statue_reparing
        // object[0x0e] = 0x01; // show guard_statue

        fade_in();
    }
};

map nobilia_center_aegis(AEGIS) {
    enum entrance {
        cinematic = entrance(0x21, 0x41, NONE),
    }

    enum stepon_trigger {
        bridge_east = @install() {
            debug_subtext("S=0");
        },
        bridge_west = @install() {
            debug_subtext("S=1");
        },
        bridge_south = @install() {
            debug_subtext("S=2");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // hide bridge_south
        // object[0x01] = 0x01; // hide bridge_east
        // object[0x02] = 0x01; // hide bridge_west
        // object[0x03] = 0x7e; // change layout_statue (0 = normal, 1-13 = statue exploding, 14-17 = aegis, 18 = empty, 19-21 = bridge)
        
        fade_in();
    }
};

map nobilia_firepit(FIREPIT_NOBILIA) {
    enum entrance {
        west = entrance(0x05, 0x1b, EAST),

        cutscene_landing = entrance(0x0b, 0x1b, NONE),
    }

    enum stepon_trigger {
        windwalker = @install() {
            debug_subtext("S=0");
        },
        exit_west = @install() {
            debug_subtext("S=1");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // ignite fire
        // object[0x01] = 0x02; // show windwalker_collision

        fade_in();
    }
};

map nobilia_snake_statues(PALACE_SNAKES) {
    enum entrance {
        north = entrance(0x15, 0x0b, SOUTH),
        south = entrance(0x16, 0x47, NORTH),
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        exit_north = @install() {
            debug_subtext("S=1");
        },
    }

    enum b_trigger {
        snake_statue = @install() {
            debug_subtext("B=0");
        },
        guard_right = @install() {
            debug_subtext("B=1");
        },
        guard_left = @install() {
            debug_subtext("B=2");
        },
        snake_statue = @install() {
            debug_subtext("B=3");
        },
        sniff__1_water_3 = @install() {
            debug_subtext("B=4");
            _loot(0x03, WATER, 0d01, 0d03);
        },
        sniff__1_water_3 = @install() {
            debug_subtext("B=5");
            _loot(0x04, WATER, 0d01, 0d03);
        },
        sniff__1_limestone_3 = @install() {
            debug_subtext("B=6");
            _loot(0x05, LIMESTONE, 0d01, 0d03);
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=7");
            _loot(0x06, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_vinegar_2 = @install() {
            debug_subtext("B=8");
            _loot(0x07, VINEGAR, 0d01, 0d02);
        },
        sniff__1_call_beads = @install() {
            debug_subtext("B=9");
            // _loot(0x??, CALL_BEADS, 0d01, 0d00); // infinite call beads
        },
    }

    fun trigger_enter() {
        // ???
        // object[0x02] = 0x01; // open gate
        // ???

        fade_in();
    }
};

map nobilia_palace_outside(PALACE_EXTERIOR) {
    enum entrance {
        north = entrance(0x56, 0x1f, SOUTH),
        south = entrance(0x56, 0x45, NORTH),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        exit_south = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        exit_north = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        stepon_9 = @install() {
            debug_subtext("S=9");
        },
    }

    enum b_trigger {
        sniff__2500_money = @install() {
            debug_subtext("B=0");
            // 2500 gold
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=1");
            _loot(0x0a, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_bone = @install() {
            debug_subtext("B=2");
            _loot(0x09, BONE, 0d01, 0d00);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=3");
            _loot(0x08, BONE, 0d01, 0d01);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=4");
            _loot(0x07, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=5");
            _loot(0x06, ROOTS, 0d01, 0d01);
        },
        sniff__1_water_3 = @install() {
            debug_subtext("B=6");
            _loot(0x05, WATER, 0d01, 0d03);
        },
        sniff__1_vinegar_2 = @install() {
            debug_subtext("B=7");
            _loot(0x04, VINEGAR, 0d01, 0d02);
        },
        sniff__1_vinegar_1 = @install() {
            debug_subtext("B=8");
            _loot(0x03, VINEGAR, 0d01, 0d01);
        },
        sniff__1_water_2 = @install() {
            debug_subtext("B=9");
            _loot(0x02, WATER, 0d01, 0d02); // same as B=10
        },

        sniff__1_water_2 = @install() {
            debug_subtext("B=10");
            _loot(0x02, WATER, 0d01, 0d02); // same as B=9
        },
        sniff__1_water_2 = @install() {
            debug_subtext("B=11");
            _loot(0x01, WATER, 0d01, 0d02);
        },
    }

    fun open_gate(open) {
        if(open) {
            object[0x00] = 0x7e;
        } else {
            object[0x00] = 0x00;
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map nobilia_palace(PALACE) {
    enum entrance {
        south = entrance(0x31, 0x21, NORTH),

        cinematic_enter = entrance(0x37, 0x01, NORTH),
    }

    fun trigger_enter() {
        fade_in();

        // object[0x00] = 0x07; // show face
    }
};

map vigor_locker(ARENA_ROOM) {
    enum entrance {
        north = entrance(0x14, 0x13, SOUTH),
    }

    enum stepon_trigger {
        exit_north = @install() {
            debug_subtext("S=0");
        },
    }

    enum b_trigger {
        gourd_west = @install() {
            debug_subtext("B=0");
            _loot_chest(0x01, ARMOR_2_1, 0x01);
            // _loot_chest(0x01, ARMOR_2_2, 0x01);
            // _loot_chest(0x01, ARMOR_2_3, 0x01);
        },
        secret_passage = @install() { // empty
            debug_subtext("B=1");
        },
        gourd_east = @install() {
            debug_subtext("B=2");
            _loot_chest(0x02, PETAL, 0x01);
        },
        gourd_hidden_1_1 = @install() {
            debug_subtext("B=3");
            _loot_chest(0x03, WAX, 0x01);
        },
        gourd_hidden_1_2 = @install() {
            debug_subtext("B=4");
            _loot_chest(0x04, CALL_BEADS, 0x01);
        },
        gourd_hidden_1_3 = @install() {
            debug_subtext("B=5");
            _loot_chest(0x05, ARMBAND_2_1, 0x01);
            // _loot_chest(0x02, ARMBAND_2_2, 0x01);
            // _loot_chest(0x02, ARMBAND_2_3, 0x01);
        },
        gourd_hidden_2_1 = @install() {
            debug_subtext("B=6");
            _loot_chest(0x06, WAX, 0x01);
        },
        gourd_hidden_2_2 = @install() {
            debug_subtext("B=7");
            _loot_chest(0x07, CALL_BEADS, 0x01);
        },
        gourd_hidden_2_3 = @install() {
            debug_subtext("B=8");
            _loot_chest(0x08, HELM_2_1, 0x01);
            // _loot_chest(0x02, HELM_2_2, 0x01);
            // _loot_chest(0x02, HELM_2_3, 0x01);
        },
    }

    fun trigger_enter() {
        object[0x00] = 0x04; // open door

        // object[0x01] = 0x01; // loot gourd_west
        // object[0x02] = 0x01; // loot gourd_east

        // object[0x03] = 0x01; // loot gourd_hidden_1_1
        // object[0x04] = 0x01; // loot gourd_hidden_1_2
        // object[0x05] = 0x01; // loot gourd_hidden_1_3

        // object[0x06] = 0x01; // loot gourd_hidden_2_1
        // object[0x07] = 0x01; // loot gourd_hidden_2_2
        // object[0x08] = 0x01; // loot gourd_hidden_2_3

        fade_in();
    }
};

map vigor(ARENA) {
    enum entrance {
        north_cinematic = entrance(0x20, 0x07, NONE),
        south = entrance(0x22, 0x69, NORTH) // 0x22, 0x6a
    }

    fun trigger_enter() {
        init_map(0x00, 0x30, 0x40, 0x70);

        fade_in();
    }
};

map river_bridge(RIVER) {
    enum entrance {
        east = entrance(0x44, 0x44, WEST),
        west = entrance(0x01, 0x3d, EAST),
        cave = entrance(0x41, 0x0b, SOUTH)
    }

    enum stepon_trigger {
        lift_west = @install() {
            debug_subtext("S=0");
        },
        lift_east = @install() {
            debug_subtext("S=1");
        },
        exit_west = @install() {
            debug_subtext("S=2");
        },
        bridge_east = @install() {
            debug_subtext("S=3");
        },
        bridge_west = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        exit_west = @install() {
            debug_subtext("S=9");
        }
    }

    enum b_trigger {
        sniff__1_water_1 = @install() {
            debug_subtext("B=0");
            _loot(0x0c, WATER, 0d01, 0d01);
        },
        sniff__1_water_1 = @install() {
            debug_subtext("B=1");
            _loot(0x0b, WATER, 0d01, 0d01);
        },
        sniff__1_roots_2 = @install() {
            debug_subtext("B=2");
            _loot(0x0a, ROOTS, 0d01, 0d02);
        },
        sniff__1_ash_2 = @install() {
            debug_subtext("B=3");
            _loot(0x09, ASH, 0d01, 0d02);
        },
        sniff__1_wax_1 = @install() {
            debug_subtext("B=4");
            _loot(0x08, WAX, 0d01, 0d01);
        },
        sniff__1_brimstone_2 = @install() {
            debug_subtext("B=5");
            _loot(0x07, BRIMSTONE, 0d01, 0d02);
        },
        sniff__1_brimstone = @install() {
            debug_subtext("B=6");
            _loot(0x06, BRIMSTONE, 0d01, 0d00);
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=7");
            _loot(0x05, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=8");
            _loot(0x04, LIMESTONE, 0d01, 0d02);
        },
        sniff__1_ethanol_1 = @install() {
            debug_subtext("B=9");
            _loot(0x03, ETHANOL, 0d01, 0d01);
        },

        sniff__1_ethanol_2 = @install() {
            debug_subtext("B=10");
            _loot(0x02, ETHANOL, 0d01, 0d02);
        },
        sniff__1_ethanol_1 = @install() {
            debug_subtext("B=11");
            _loot(0x01, ETHANOL, 0d01, 0d01);
        },
        axe2_wall = @install() {
            debug_subtext("B=12");
        },
    }
    
    fun trigger_enter() {
        fade_in();
    }
};

map between(CROSSING) {
    enum entrance {
        north = entrance(0x2d, 0x01, SOUTH),
        east = entrance(0x5f, 0x4d, WEST),
        west_1 = entrance(0x04, 0x71, EAST),
        west_2 = entrance(0x04, 0x2f, EAST),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        exit_east = @install() {
            debug_subtext("S=8");
        },
        exit_north = @install() {
            debug_subtext("S=9");
        },

        exit_west_2_east = @install() {
            debug_subtext("S=10");
        },
        exit_west_1_exit = @install() {
            debug_subtext("S=11");
        },
        stepon_12 = @install() {
            debug_subtext("S=12");
        },
        stepon_13 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        stepon_17 = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },
    }

    enum b_trigger {
        wall_2 = @install() {
            debug_subtext("B=0");
        },
        wall_1 = @install() {
            debug_subtext("B=1");
        },
        gourd_2_1__3_water = @install() {
            debug_subtext("B=2");
            _loot_chest(0x06, WATER, 0d03);
        },
        gourd_1_1__2_water = @install() {
            debug_subtext("B=3");
            _loot_chest(0x05, WATER, 0d02);
        },
        gourd_1_2__3_limestone = @install() {
            debug_subtext("B=4");
            _loot_chest(0x07, LIMESTONE, 0d03);
        },
        gourd_1_3__4_wax = @install() {
            debug_subtext("B=5");
            _loot_chest(0x08, WAX, 0d04);
        },
        sniff__1_ethanol_3 = @install() {
            debug_subtext("B=6");
            _loot(0x09, ETHANOL, 0d01, 0d03);
        },
        sniff__1_ethanol_2 = @install() {
            debug_subtext("B=7");
            _loot(0x0a, ETHANOL, 0d01, 0d02);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=8");
            _loot(0x0b, ROOTS, 0d01, 0d01);
        },
        sniff__1_roots_3 = @install() {
            debug_subtext("B=9");
            _loot(0x0c, ROOTS, 0d01, 0d03);
        },

        sniff__1_roots = @install() {
            debug_subtext("B=10");
            _loot(0x0d, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots_2 = @install() {
            debug_subtext("B=11");
            _loot(0x0e, ROOTS, 0d01, 0d02);
        },
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=12");
            _loot(0x0f, LIMESTONE, 0d01, 0d02);
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=13");
            _loot(0x10, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_wax_2 = @install() {
            debug_subtext("B=14");
            _loot(0x11, WAX, 0d01, 0d02);
        },
        sniff__1_wax_2 = @install() {
            debug_subtext("B=15");
            _loot(0x12, WAX, 0d01, 0d02);
        },
        sniff__1_water_1 = @install() {
            debug_subtext("B=16");
            _loot(0x13, WATER, 0d01, 0d01);
        },
        sniff__1_vinegar_1 = @install() {
            debug_subtext("B=17");
            _loot(0x14, VINEGAR, 0d01, 0d01);
        },
        sniff__1_vinegar_1 = @install() {
            debug_subtext("B=18");
            _loot(0x15, VINEGAR, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=19");
            _loot(0x16, BONE, 0d01, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x02] = 0x01; // show bridge
        // object[0x01] = 0x01; // open wall_1
        // object[0x00] = 0x01; // open wall_2
        // object[0x04] = 0x01; // block exit_east_left
        // object[0x03] = 0x01; // block exit_east_right
        // object[0x05] = 0x01; // block gourd_1_1
        // object[0x07] = 0x01; // block gourd_1_2
        // object[0x08] = 0x01; // block gourd_1_3
        // object[0x06] = 0x01; // block gourd_2_1
        // sniff spots

        fade_in();
    }
};

map horace(HORACE) {
    enum entrance {
        north = entrance(0x53, 0x04, SOUTH),
        east = entrance(0x81, 0x31, WEST),
        south = entrance(0x55, 0x6e, SOUTH),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        exit_north = @install() {
            debug_subtext("S=3");
        },
        exit_east = @install() {
            debug_subtext("S=4");
        },
        exit_south = @install() {
            debug_subtext("S=5");
        },
    }

    enum todo {
    // enum b_trigger {
        sniff__1_ethanol_3 = @install() {
            debug_subtext("B=0");
            _loot(0x02, ETHANOL, 0d01, 0d03);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=1");
            _loot(0x03, ROOTS, 0d01, 0d01);
        },
        sniff__1_wax_2 = @install() {
            debug_subtext("B=2");
            _loot(0x04, WAX, 0d01, 0d02);
        },
        sniff__1_limestone = @install() {
            debug_subtext("B=3");
            _loot(0x05, LIMESTONE, 0d01, 0d00);
        },
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=4");
            _loot(0x06, LIMESTONE, 0d01, 0d02);
        },
        sniff__1_water_1 = @install() {
            debug_subtext("B=5");
            _loot(0x07, WATER, 0d01, 0d01);
        },
        sniff__1_vinegar_2 = @install() {
            debug_subtext("B=6");
            _loot(0x08, VINEGAR, 0d01, 0d02);
        },
        sniff__1_ash_2 = @install() {
            debug_subtext("B=7");
            _loot(0x09, ASH, 0d01, 0d02);
        },
        sniff__1_bone = @install() {
            debug_subtext("B=8");
            _loot(0x0a, BONE, 0d01, 0d00);
        },
        sniff__1_bone = @install() {
            debug_subtext("B=9");
            _loot(0x0b, BONE, 0d01, 0d00);
        },

        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=10");
            _loot(0x0c, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=11");
            _loot(0x0d, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone = @install() {
            debug_subtext("B=12");
            _loot(0x0e, BRIMSTONE, 0d01, 0d00);
        },
        sniff__1_water = @install() {
            debug_subtext("B=13");
            _loot(0x0f, WATER, 0d01, 0d00);
        },
        sniff__1_crystal_2 = @install() {
            debug_subtext("B=14");
            _loot(0x10, CRYSTAL, 0d01, 0d02);
        },
        sniff__1_clay_1 = @install() {
            debug_subtext("B=15");
            _loot(0x11, CLAY, 0d01, 0d01);
        },
        sniff__1_roots = @install() {
            debug_subtext("B=16");
            _loot(0x12, ROOTS, 0d01, 0d00);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=17");
            _loot(0x13, ROOTS, 0d01, 0d01);
        },
        sniff__1_clay = @install() {
            debug_subtext("B=18");
            _loot(0x14, CLAY, 0d01, 0d00);
        },
        sniff__1_oil_2 = @install() {
            debug_subtext("B=19");
            _loot(0x15, OIL, 0d01, 0d02);
        },
    }

    fun remove_water(remove) {
        if(remove) {
            object[0x00] = 0x01;
            object[0x01] = 0x01;
        } else {
            object[0x00] = 0x00;
            object[0x01] = 0x00;
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map halls_outside(HALLS_EXTERIOR) {
    enum entrance {
        north = entrance(0x41, 0x03, SOUTH),
        south = entrance(0x45, 0x41, NORTH),
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        exit_north = @install() {
            debug_subtext("S=1");
        },
    }

    enum b_trigger {
        sniff__1_ash = @install() {
            debug_subtext("B=0");
            _loot(0x0f, ASH, 0d01, 0d00);
        },
        sniff__1_ash_2 = @install() {
            debug_subtext("B=1");
            _loot(0x0e, ASH, 0d01, 0d02);
        },
        sniff__1_ash = @install() {
            debug_subtext("B=2");
            _loot(0x0d, ASH, 0d01, 0d00);
        },
        sniff__1_ethanol_3 = @install() {
            debug_subtext("B=3");
            _loot(0x0c, ETHANOL, 0d01, 0d03);
        },
        sniff__1_ethanol = @install() {
            debug_subtext("B=4");
            _loot(0x0b, ETHANOL, 0d01, 0d00);
        },
        sniff__1_ethanol_1 = @install() {
            debug_subtext("B=5");
            _loot(0x0a, ETHANOL, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=6");
            _loot(0x09, BONE, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=7");
            _loot(0x08, BONE, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=8");
            _loot(0x07, BONE, 0d01, 0d01);
        },
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=9");
            _loot(0x06, LIMESTONE, 0d01, 0d02);
        },

        sniff__1_limestone_1 = @install() {
            debug_subtext("B=10");
            _loot(0x05, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_limestone = @install() {
            debug_subtext("B=11");
            _loot(0x04, LIMESTONE, 0d01, 0d00);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=12");
            _loot(0x03, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone_2 = @install() {
            debug_subtext("B=13");
            _loot(0x02, BRIMSTONE, 0d01, 0d02);
        },
        sniff__1_brimstone = @install() {
            debug_subtext("B=14");
            _loot(0x01, BRIMSTONE, 0d01, 0d00); // same as B=15
        },
        sniff__1_brimstone = @install() {
            debug_subtext("B=15");
            _loot(0x01, BRIMSTONE, 0d01, 0d00); // same as B=14
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=16");
            _loot(0x00, BRIMSTONE, 0d01, 0d01);
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map halls_center(HALLS_CENTER) {
    enum entrance {
        north = entrance(0x29, 0x03, SOUTH),
        east_1 = entrance(0x4b, 0x3f, WEST),
        east_2 = entrance(0x49, 0x5d, WEST),
        south = entrance(0x29, 0x8b, NORTH),
        west_1 = entrance(0x09, 0x5d, EAST),
        west_2 = entrance(0x09, 0x3f, EAST),

        elevator = entrance(0x29, 0x49, NONE),
    }

    @install()
    fun pit_triggered() {
        generic_fall(0d100, 0d295);
    }

    enum stepon_trigger {
        spear_check = @install() {
            debug_subtext("S=0");
        },
        pit_5 = pit_triggered(),
        pit_4 = pit_triggered(),
        pit_3 = pit_triggered(),
        pit_2 = pit_triggered(),
        pit_1 = pit_triggered(),
        exit_south = @install() {
            debug_subtext("S=6");
        },
        door_west_2 = @install() {
            debug_subtext("S=7");
        },
        door_west_1 = @install() {
            debug_subtext("S=8");
        },
        door_east_2 = @install() {
            debug_subtext("S=9");
        },

        door_east_1 = @install() {
            debug_subtext("S=10");
        },
        door_boss = @install() {
            debug_subtext("S=11");
        },
        switch_triggered = @install() {
            debug_subtext("S=12");
        },
        pit_6 = pit_triggered(),
        pit_13 = pit_triggered(),
        pit_12 = pit_triggered(),
        pit_11 = pit_triggered(),
        pit_10 = pit_triggered(),
        pit_7 = pit_triggered(),
        pit_8 = pit_triggered(),

        pit_9 = pit_triggered(),
        pit_13 = pit_triggered(),
        pit_14 = pit_triggered(),
        pit_15 = pit_triggered(),
        pit_16 = pit_triggered(),
        pit_20 = pit_triggered(),
        pit_19 = pit_triggered(),
        pit_17 = pit_triggered(),
        pit_18 = pit_triggered(),
        revealer_left = @install() {
            debug_subtext("S=29");
        },

        revealer_right = @install() {
            debug_subtext("S=30");
        },
        elevator = @install() {
            debug_subtext("S=31");
        },
    }

    enum b_trigger {
        gourd_1__2_VINEGAR = @install() {
            debug_subtext("B=0");
            _loot_chest(0x02, VINEGAR, 0d02);
        },
        gourd_2__1_NECTAR = @install() {
            debug_subtext("B=1");
            _loot_chest(0x01, NECTAR, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x7e; // enroll bridge
        // object[0x01] = 0x01; // open gourde_2
        // object[0x02] = 0x01; // open gourde_1
        // object[0x03] = 0x01; // open door_NW
        // object[0x04] = 0x04; // open door_boss
        // object[0x05] = 0x7e; // open elevator
        // object[0x06] = 0x01; // activate bridge_switch
        // object[0x07] = 0x01; // open door_SW
        // object[0x08] = 0x01; // open door_SE
        // object[0x09] = 0x01; // open door_NE
        // object[0x0a] = 0x01; // activate switch
        // object[0x0b] = 0x01; // show bridge_left_1
        // object[0x0c] = 0x01; // show bridge_left_2
        // object[0x0d] = 0x01; // show bridge_left_3
        // object[0x0e] = 0x01; // show bridge_right_1
        // object[0x0f] = 0x01; // show bridge_right_2
        // object[0x10] = 0x01; // show bridge_right_3
        // object[0x11] = 0x01; // show bridge_right_4

        fade_in();
    }
};

map temple_nw(HALLS_NW) {
    enum entrance {
        east = entrance(0x83, 0xa3, WEST),
    }

    enum stepon_trigger {
        fall_ = @install() {
            debug_subtext("S=0");
        },
        fall_ = @install() {
            debug_subtext("S=1");
        },
        fall_ = @install() {
            debug_subtext("S=2");
        },
        fall_ = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        fall_ = @install() {
            debug_subtext("S=5");
        },
        fall_ = @install() {
            debug_subtext("S=6");
        },
        fall_ = @install() {
            debug_subtext("S=7");
        },
        fall_ = @install() {
            debug_subtext("S=8");
        },
        fall_ = @install() {
            debug_subtext("S=9");
        },

        fall_ = @install() {
            debug_subtext("S=10");
        },
        fall_ = @install() {
            debug_subtext("S=11");
        },
        fall_ = @install() {
            debug_subtext("S=12");
        },
        fall_ = @install() {
            debug_subtext("S=13");
        },
        fall_ = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        switch_floor = @install() {
            debug_subtext("S=16");
        },
        exit_east = @install() {
            debug_subtext("S=17");
        },
        fall_ = @install() {
            debug_subtext("S=18");
        },
        fall_ = @install() {
            debug_subtext("S=19");
        },

        fall_ = @install() {
            debug_subtext("S=20");
        },
        stepon_21 = @install() {
            debug_subtext("S=21");
        },
        stepon_22 = @install() {
            debug_subtext("S=22");
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        stepon_24 = @install() {
            debug_subtext("S=24");
        },
        fall_ = @install() {
            debug_subtext("S=25");
        },
        fall_ = @install() {
            debug_subtext("S=26");
        },
        fall_ = @install() {
            debug_subtext("S=27");
        },
        fall_ = @install() {
            debug_subtext("S=28");
        },
    }

    enum b_trigger {
        gourd_hidden__pixie_dust = @install() {
            debug_subtext("B=0");
            _loot_chest(0x0e, PIXIE_DUST, 0d01);
        },
        gourd_x__1_call_beads = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0f, CALL_BEADS, 0d01);
        },
        gourd_x__3_brimstone = @install() {
            debug_subtext("B=2");
            _loot_chest(0x10, BRIMSTONE, 0d03);
        },
        gourd_x__2_ash = @install() {
            debug_subtext("B=3");
            _loot_chest(0x11, ASH, 0d02);
        },
        destructable_wall = @install() {
            debug_subtext("B=4");
        },
        bridge_switch_south = @install() {
            debug_subtext("B=5");
        },
        bridge_switch_north = @install() {
            debug_subtext("B=6");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // activate switch_floor
        // object[0x01] = 0x01; // activate bridge_switch_north
        // object[0x02] = 0x7e; // activate bridge_south
        // object[0x03] = 0x7e; // activate bridge_north
        // object[0x04] = 0x01; // activate bridge_switch_south
        // object[0x05] = 0x7e; // collapse wall
        // object[0x06] = 0x7e; // show bridge_1
        // object[0x07] = 0x7e; // show bridge_2
        // object[0x08] = 0x7e; // show bridge_3
        // object[0x09] = 0x7e; // show bridge_4
        // object[0x0a] = 0x7e; // show bridge_5
        // sniff spots?
        // object[0x0e] = 0x01; // loot gourd_hidden
        // object[0x0f] = 0x01; // loot gourd_
        // object[0x10] = 0x01; // loot gourd_
        // object[0x11] = 0x01; // loot gourd_

        fade_in();
    }
};

map minitaur(HALLS_SE) {
    enum entrance {
        west = entrance(0x01, 0x1b, EAST),
    }

    enum stepon_trigger {
        exit_west = @install() {
            debug_subtext("S=0");
        },
        switch = @install() {
            debug_subtext("S=1");
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map temple_sw(HALLS_SW) {
    enum entrance {
        east = entrance(0x3b, 0x3f, WEST),
    }

    enum stepon_trigger {
        exit_east = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        switch_2 = @install() {
            debug_subtext("S=2");
        },
        switch_1 = @install() {
            debug_subtext("S=3");
        },
        switch_3 = @install() {
            debug_subtext("S=4");
        },
        exit_north = @install() {
            debug_subtext("S=5");
        },
    }

    enum b_trigger {
        gourd_2__3_brimstone = @install() {
            debug_subtext("B=0");
            _loot_chest(0x08, BRIMSTONE, 0d03);
        },
        gourd_1_2__1_nectar = @install() {
            debug_subtext("B=1");
            _loot_chest(0x07, NECTAR, 0d01);
        },
        gourd_1_1__1_wings = @install() {
            debug_subtext("B=2");
            _loot_chest(0x06, WINGS, 0d01);
        },
    }

    fun trigger_enter() {
        // object[0x03] = 0x03; // gate 1
        // object[0x04] = 0x03; // gate 2
        // object[0x05] = 0x03; // gate 3

        // object[0x00] = 0x7e; // activate switch_1
        // object[0x01] = 0x7e; // activate switch_2
        // object[0x02] = 0x7e; // activate switch_3

        fade_in();
    }
};

map halls_bridge(HALLS_BRIDGE) {
    enum entrance {
        test = entrance(0x21, 0x95, NORTH),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        gate_lift = @install() {
            debug_subtext("S=1");
        },
        lift = @install() {
            debug_subtext("S=2");
        },
        switch_monk = @install() {
            debug_subtext("S=3");
        },
        switch_circle_1 = @install() {
            debug_subtext("S=4");
        },
        switch_circle_5 = @install() {
            debug_subtext("S=5");
        },
        switch_circle_4 = @install() {
            debug_subtext("S=6");
        },
        switch_circle_6 = @install() {
            debug_subtext("S=7");
        },
        switch_circle_3 = @install() {
            debug_subtext("S=8");
        },
        switch_circle_2 = @install() {
            debug_subtext("S=9");
        },

        switch_gate = @install() {
            debug_subtext("S=10");
        },
        bridge_1 = @install() {
            debug_subtext("S=11");
        },
        bridge_2 = @install() {
            debug_subtext("S=12");
        },
        bridge_18 = @install() {
            debug_subtext("S=13");
        },
        bridge_19 = @install() {
            debug_subtext("S=14");
        },
        bridge_3 = @install() {
            debug_subtext("S=15");
        },
        bridge_4 = @install() {
            debug_subtext("S=16");
        },
        bridge_5 = @install() {
            debug_subtext("S=17");
        },
        bridge_6 = @install() {
            debug_subtext("S=18");
        },
        bridge_7 = @install() {
            debug_subtext("S=19");
        },

        bridge_8 = @install() {
            debug_subtext("S=20");
        },
        bridge_9 = @install() {
            debug_subtext("S=21");
        },
        bridge_10 = @install() {
            debug_subtext("S=22");
        },
        bridge_11 = @install() {
            debug_subtext("S=23");
        },
        bridge_12 = @install() {
            debug_subtext("S=24");
        },
        bridge_13 = @install() {
            debug_subtext("S=25");
        },
        bridge_14 = @install() {
            debug_subtext("S=26");
        },
        bridge_15 = @install() {
            debug_subtext("S=27");
        },
        bridge_16 = @install() {
            debug_subtext("S=28");
        },
        bridge_17 = @install() {
            debug_subtext("S=29");
        },

        secret_passage_1 = @install() {
            debug_subtext("S=30");
        },
        secret_passage_2 = @install() {
            debug_subtext("S=31");
        },
    }

    enum b_trigger {
        lift = @install() {
            debug_subtext("B=0");
        },
        gourd__3_honey = @install() {
            debug_subtext("B=1");
            _loot_chest(0x20, HONEY, 0d03);
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x7e; // light arena_spawn_left
        // object[0x01] = 0x7e; // light arena_spawn_right
        // object[0x02] = 0x7e; // open arena_lift_gate
        // object[0x03] = 0x7e; // open lift_gate
        // object[0x04] = 0x01; // active lift_switch
        // object[0x05] = 0x01; // active switch_circle_1
        // object[0x06] = 0x01; // active switch_circle_2
        // object[0x07] = 0x01; // active switch_circle_6
        // object[0x08] = 0x01; // active switch_circle_3
        // object[0x09] = 0x01; // active switch_circle_5
        // object[0x0a] = 0x01; // active switch_circle_4
        // object[0x0b] = 0x01; // active switch_gate_2
        // object[0x0c] = 0x01; // active switch_gate_1
        // object[0x0d] = 0x01; // active switch_monk
        // object[0x0e] = 0x7e; // open gate_arena
        // object[0x0f] = 0x7e; // open gate_switch_circle
        // object[0x10] = 0x7e; // close gate
        // object[0x11] = 0x7e; // collapse bridge_1
        // object[0x12] = 0x7e; // collapse bridge_2
        // object[0x13] = 0x7e; // collapse bridge_3
        // object[0x14] = 0x7e; // collapse bridge_4
        // object[0x15] = 0x7e; // collapse bridge_5
        // object[0x16] = 0x7e; // collapse bridge_6
        // object[0x17] = 0x7e; // collapse bridge_7
        // object[0x18] = 0x7e; // collapse bridge_8
        // object[0x19] = 0x7e; // collapse bridge_9
        // object[0x1a] = 0x7e; // collapse bridge_10
        // object[0x1b] = 0x7e; // collapse bridge_11
        // object[0x1c] = 0x7e; // collapse bridge_12
        // object[0x1d] = 0x7e; // collapse bridge_13
        // object[0x1e] = 0x7e; // collapse bridge_14
        // object[0x1f] = 0x7e; // collapse bridge_15
        // object[0x20] = 0x7e; // loot gourd

        fade_in();
    }
};

map halls_ne(HALLS_NE) {
    enum entrance {
        west = entrance(0x0d, 0x9f, EAST),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        pit_left_3 = @install() {
            debug_subtext("S=1");
        },
        pit_right_1 = @install() {
            debug_subtext("S=2");
        },
        pit_right_2 = @install() {
            debug_subtext("S=3");
        },
        pit_left_1 = @install() {
            debug_subtext("S=4");
        },
        pit_left_2 = @install() {
            debug_subtext("S=5");
        },
        exit_west = @install() {
            debug_subtext("S=6");
        },
        retreat_bridge = @install() {
            debug_subtext("S=7");
        },
        switch_ground_1 = @install() {
            debug_subtext("S=8");
        },
        switch_ground_2 = @install() {
            debug_subtext("S=9");
        },

        approach_bridge = @install() {
            debug_subtext("S=10");
        },
        secret_passage_entrance_2 = @install() {
            debug_subtext("S=11");
        },
        secret_passage_entrance_1 = @install() {
            debug_subtext("S=12");
        },
        alchemist_top_2 = @install() {
            debug_subtext("S=13");
        },
        alchemist_top_1 = @install() {
            debug_subtext("S=14");
        },
        alchemist_bottom = @install() {
            debug_subtext("S=15");
        },
        secret_passage_top = @install() {
            debug_subtext("S=16");
        },
        secret_passage_balcony = @install() {
            debug_subtext("S=17");
        },
    }

    enum b_trigger {
        gourd_north__4_wax = @install() {
            debug_subtext("B=0");
            _loot_chest(0x0d, WAX, 0d04);
        },
        gourd_center__6_ash = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0c, ASH, 0d06);
        },
        gourd_alchemist_2__5_wax = @install() {
            debug_subtext("B=2");
            _loot_chest(0x0b, WAX, 0d05);
        },
        gourd_alchemist_1__4_brimstone = @install() {
            debug_subtext("B=3");
            _loot_chest(0x0a, BRIMSTONE, 0d04);
        },
        bridge_switch = @install() {
            debug_subtext("B=4");
        },
    }

    fun trigger_enter() {
        // object[0x00] = 0x01; // activate bridge_switch
        // object[0x01] = 0x7e; // activate bridge
        // 2-3 ?
        // object[0x04] = 0x01; // activate switch_ground_2
        // object[0x05] = 0x01; // activate switch_ground_1
        // object[0x06] = 0x01; // open gate_1
        // object[0x07] = 0x01; // open gate_2
        // object[0x08] = 0x01; // show bridge_1
        // object[0x09] = 0x01; // show bridge_2
        // object[0x0a] = 0x01; // loot gourd_alchemist_1
        // object[0x0b] = 0x01; // loot gourd_alchemist_2
        // object[0x0c] = 0x01; // loot gourd_center
        // object[0x0d] = 0x01; // loot gourd_north

        fade_in();
    }
};

map megataur(MEGATAUR) {
    enum entrance {
        south = entrance(0x41, 0x53, NORTH)
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map pyramid(PYRAMID_EXTERIOR) {
    enum entrance {
        north = entrance(0x66, 0x04, SOUTH),
        east = entrance(0xa3, 0x71, WEST),

        cave_tiny = entrance(0x87, 0x84, SOUTH),

        pyramid_1_1 = entrance(0x4c, 0x6b, SOUTH),
        pyramid_2_1 = entrance(0x46, 0x4e, SOUTH),
        pyramid_2_2 = entrance(0x5e, 0x4e, SOUTH),
        pyramid_3_1 = entrance(0x52, 0x38, SOUTH),
        pyramid_3_2 = entrance(0x5b, 0x33, EAST),

        wings = entrance(0x3d, 0x71, NONE),
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        door_tiny = @install() {
            debug_subtext("S=1");
        },
        pit_1 = @install() {
            debug_subtext("S=2");
        },
        pit_2 = @install() {
            debug_subtext("S=3");
        },
        pit_3 = @install() {
            debug_subtext("S=4");
        },
        stairs_bottom = @install() {
            debug_subtext("S=5");
        },
        switch_left = @install() {
            debug_subtext("S=6");
        },
        switch_right = @install() {
            debug_subtext("S=7");
        },
        switch_bottom_south = @install() {
            debug_subtext("S=8");
        },
        switch_bottom_west = @install() {
            debug_subtext("S=9");
        },

        pit_4 = @install() {
            debug_subtext("S=10");
        },
        pit_5 = @install() {
            debug_subtext("S=11");
        },
        pit_6 = @install() {
            debug_subtext("S=12");
        },
        pit_7 = @install() {
            debug_subtext("S=13");
        },
        pit_8 = @install() {
            debug_subtext("S=14");
        },
        exit_east = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        door_2_1 = @install() {
            debug_subtext("S=17");
        },
        door_2_2 = @install() {
            debug_subtext("S=18");
        },
        door_3_2 = @install() {
            debug_subtext("S=19");
        },

        switch_bottom = @install() {
            debug_subtext("S=20");
        },
        stepon_21 = @install() {
            debug_subtext("S=21");
        },
        switch_left_west = @install() {
            debug_subtext("S=22");
        },
        switch_left_south = @install() {
            debug_subtext("S=23");
        },
        switch_right_east = @install() {
            debug_subtext("S=24");
        },
        switch_right_south = @install() {
            debug_subtext("S=25");
        },
        exit_north = @install() {
            debug_subtext("S=26");
        },
    }

    enum b_trigger {
        sniff__1_wax_1 = @install() {
            debug_subtext("B=0");
            _loot(0x10, WAX, 0d01, 0d01);
        },
        sniff__1_wax_1 = @install() {
            debug_subtext("B=1");
            _loot(0x11, WAX, 0d01, 0d01);
        },
        sniff__1_wax_1 = @install() {
            debug_subtext("B=2");
            _loot(0x12, WAX, 0d01, 0d01);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=3");
            _loot(0x13, ASH, 0d01, 0d01);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=4");
            _loot(0x14, ASH, 0d01, 0d01);
        },
        sniff__1_ash_1 = @install() {
            debug_subtext("B=5");
            _loot(0x15, ASH, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=6");
            _loot(0x16, BONE, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=7");
            _loot(0x17, BONE, 0d01, 0d01);
        },
        sniff__1_bone_1 = @install() {
            debug_subtext("B=8");
            _loot(0x18, BONE, 0d01, 0d01);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=9");
            _loot(0x19, BRIMSTONE, 0d01, 0d01);
        },

        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=10");
            _loot(0x1a, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=11");
            _loot(0x1b, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_brimstone_1 = @install() {
            debug_subtext("B=12");
            _loot(0x1c, BRIMSTONE, 0d01, 0d01);
        },
        sniff__1_water_1 = @install() {
            debug_subtext("B=13");
            _loot(0x1d, WATER, 0d01, 0d01);
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=14");
            _loot(0x1e, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=15");
            _loot(0x1f, LIMESTONE, 0d01, 0d01);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=16");
            _loot(0x20, ROOTS, 0d01, 0d01);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=17");
            _loot(0x21, ROOTS, 0d01, 0d01);
        },
        sniff__1_roots_1 = @install() {
            debug_subtext("B=18");
            _loot(0x22, ROOTS, 0d01, 0d01);
        },
        sniff__1_vinegar_1 = @install() {
            debug_subtext("B=19");
            _loot(0x23, VINEGAR, 0d01, 0d01);
        },
    }

    fun trigger_enter() {

        // 0…3 ?
        // object[0x04] = 0x01; // remove water_1
        // object[0x05] = 0x01; // remove water_2
        // object[0x06] = 0x01; // remove water_3
        // object[0x07] = 0x01; // remove water_4
        // object[0x08] = 0x01; // remove water_5
        // object[0x09] = 0x01; // remove water_6
        // object[0x0a] = 0x01; // remove water_7
        // object[0x0b] = 0x01; // show bridge
        // object[0x0c] = 0x01; // activate switch_basement
        // object[0x0d] = 0x02; // open door_boss
        // object[0x0e] = 0x01; // activate switch_boss_left
        // object[0x0f] = 0x01; // activate switch_boss_right

        fade_in();
    }
};

map pyramid_0(PYRAMID_1) {
    enum entrance {
        south = entrance(0x8a, 0x90, NORTH),
        stairs_up_center = entrance(0x3e, 0x3e, SOUTH),
        stairs_up_south_east = entrance(0xd4, 0x6c, SOUTH),

        south_short = entrance(0x89, 0x97, SOUTH),
    }

    enum todo {
    // enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        stepon_9 = @install() {
            debug_subtext("S=9");
        },

        stepon_10 = @install() {
            debug_subtext("S=10");
        },
        stepon_11 = @install() {
            debug_subtext("S=11");
        },
        stepon_12 = @install() {
            debug_subtext("S=12");
        },
        stepon_13 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        stepon_17 = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },

        stepon_20 = @install() {
            debug_subtext("S=20");
        },
        stepon_21 = @install() {
            debug_subtext("S=21");
        },
        stepon_22 = @install() {
            debug_subtext("S=22");
        },
        stepon_23 = @install() {
            debug_subtext("S=23");
        },
        stepon_24 = @install() {
            debug_subtext("S=24");
        },
        stepon_25 = @install() {
            debug_subtext("S=25");
        },
        stepon_26 = @install() {
            debug_subtext("S=26");
        },
        stepon_27 = @install() {
            debug_subtext("S=27");
        },
        stepon_28 = @install() {
            debug_subtext("S=28");
        },
        stepon_29 = @install() {
            debug_subtext("S=29");
        },

        stepon_30 = @install() {
            debug_subtext("S=30");
        },
        stepon_31 = @install() {
            debug_subtext("S=31");
        },
        stepon_32 = @install() {
            debug_subtext("S=32");
        },
        stepon_33 = @install() {
            debug_subtext("S=33");
        },
        stepon_34 = @install() {
            debug_subtext("S=34");
        },
        stepon_35 = @install() {
            debug_subtext("S=35");
        },
        stepon_36 = @install() {
            debug_subtext("S=36");
        },
        stepon_37 = @install() {
            debug_subtext("S=37");
        },
        stepon_38 = @install() {
            debug_subtext("S=38");
        },
        stepon_39 = @install() {
            debug_subtext("S=39");
        },

        stepon_40 = @install() {
            debug_subtext("S=40");
        },
        stepon_41 = @install() {
            debug_subtext("S=41");
        },
        stepon_42 = @install() {
            debug_subtext("S=42");
        },
        stepon_43 = @install() {
            debug_subtext("S=43");
        },
        stepon_44 = @install() {
            debug_subtext("S=44");
        },
        stepon_45 = @install() {
            debug_subtext("S=45");
        },
        stepon_46 = @install() {
            debug_subtext("S=46");
        },
    }

    enum todo2 {
    // enum b_trigger {
        b_trigger_0 = @install() {
            debug_subtext("B=0");
        },
        gourd_x__3_bone = @install() {
            debug_subtext("B=1");
            _loot_chest(0x2b, BONE, 0d03);
        },
        b_trigger_2 = @install() {
            debug_subtext("B=2");
        },
        gourd_x__1_call_beads = @install() {
            debug_subtext("B=3");
            _loot_chest(0x1f, CALL_BEADS, 0d01);
        },
        gourd_x__1_herbal_essence = @install() {
            debug_subtext("B=4");
            _loot_chest(0x1e, HERBAL_ESSENCE, 0d01);
        },
        gourd_x__1_honey = @install() {
            debug_subtext("B=5");
            _loot_chest(0x1b, HONEY, 0d01);
        },
        gourd_x__3_ash = @install() {
            debug_subtext("B=6");
            _loot_chest(0x1c, ASH, 0d03);
        },
        gourd_x__2_limestone = @install() {
            debug_subtext("B=7");
            _loot_chest(0x1a, LIMESTONE, 0d02);
        },
        gourd_x__1_roots = @install() {
            debug_subtext("B=8");
            _loot_chest(0x1d, ROOTS, 0d01);
        },
        gourd_x__3_vinegar = @install() {
            debug_subtext("B=9");
            _loot_chest(0x19, VINEGAR, 0d03);
        },

        gourd_x__1_biscuit = @install() {
            debug_subtext("B=10");
            _loot_chest(0x18, BISCUIT, 0d01);
        },
        gourd_x__1_petal = @install() {
            debug_subtext("B=11");
            _loot_chest(0x17, PETAL, 0d01);
        },
        gourd_x__2_wax = @install() {
            debug_subtext("B=12");
            _loot_chest(0x22, WAX, 0d02);
        },
        gourd_x__1_pixie_dust = @install() {
            debug_subtext("B=13");
            _loot_chest(0x21, PIXIE_DUST, 0d01);
        },
        gourd_x__1_nectar = @install() {
            debug_subtext("B=14");
            _loot_chest(0x16, NECTAR, 0d01);
        },
        gourd_x__1_call_beads = @install() {
            debug_subtext("B=15");
            _loot_chest(0x15, CALL_BEADS, 0d01);
        },
        gourd_x__1_wings = @install() {
            debug_subtext("B=16");
            _loot_chest(0x14, WINGS, 0d01);
        },
        gourd_x__3_dry_ice = @install() {
            debug_subtext("B=17");
            _loot_chest(0x23, DRY_ICE, 0d03);

        },
        b_trigger_18 = @install() {
            debug_subtext("B=18");
        },
        b_trigger_19 = @install() {
            debug_subtext("B=19");
        },

        b_trigger_20 = @install() {
            debug_subtext("B=20");
        },
        b_trigger_21 = @install() {
            debug_subtext("B=21");
        },
        b_trigger_22 = @install() {
            debug_subtext("B=22");
        },
        gourd_x__1_biscuit = @install() {
            debug_subtext("B=23");
            _loot_chest(0x2e, BISCUIT, 0d01);
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map pyramid_1(PYRAMID_2) {
    enum entrance {
        south_2 = entrance(0x54, 0x70, NORTH),
        south_1 = entrance(0x74, 0x70, NORTH),
        stairs_up = entrance(0x8c, 0x48, SOUTH),
        stairs_down_north_west = entrance(0x06, 0x18, NORTH),
        stairs_down_south_east = entrance(0xb6, 0x68, NORTH),

        south_2_short = entrance(0x53, 0x7b, NORTH),
    }

    enum todo {
    // enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
    }

    enum todo2 {
    // enum b_trigger {
        gourd_x__3_limestone = @install() {
            debug_subtext("B=0");
            _loot_chest(0x18, LIMESTONE, 0d03);
        },
        gourd_x__1_mushroom = @install() {
            debug_subtext("B=1");
            _loot_chest(0x17, MUSHROOM, 0d01);
        },
        gourd_x__2_call_beads = @install() {
            debug_subtext("B=2");
            _loot_chest(0x16, CALL_BEADS, 0d02);
        },
        gourd_x__1_petal = @install() {
            debug_subtext("B=3");
            _loot_chest(0x15, PETAL, 0d01);
        },
        gourd_x__2_iron = @install() {
            debug_subtext("B=4");
            _loot_chest(0x14, IRON, 0d02);
        },
        gourd_x__1_honey = @install() {
            debug_subtext("B=5");
            _loot_chest(0x13, HONEY, 0d01);
        },
        gourd_x__1_nectar = @install() {
            debug_subtext("B=6");
            _loot_chest(0x12, NECTAR, 0d01);
        },
        gourd_x__4_feather = @install() {
            debug_subtext("B=7");
            _loot_chest(0x11, FEATHER, 0d04);
        },
        gourd_x__1_biscuit = @install() {
            debug_subtext("B=8");
            _loot_chest(0x10, BISCUIT, 0d01);
        },
        gourd_x__1_herbal_essence = @install() {
            debug_subtext("B=9");
            _loot_chest(0x0f, HERBAL_ESSENCE, 0d01);
        },

        gourd_x__1_acorn = @install() {
            debug_subtext("B=10");
            _loot_chest(0x0e, ACORNS, 0d01);
        },
        gourd_x__2_meteorite = @install() {
            debug_subtext("B=11");
            _loot_chest(0x0d, METEORITE, 0d02);
        },
        gourd_x__3_clay = @install() {
            debug_subtext("B=12");
            _loot_chest(0x0c, CLAY, 0d03);
        },
        gourd_x__2_gunpowder = @install() {
            debug_subtext("B=13");
            _loot_chest(0x0b, GUNPOWDER, 0d02);
        },
        gourd_x__1_grease = @install() {
            debug_subtext("B=14");
            _loot_chest(0x0a, GREASE, 0d01);
        },
        gourd_x__1_wings = @install() {
            debug_subtext("B=15");
            _loot_chest(0x09, WINGS, 0d01);
        },
        gourd_x__3_ethanol = @install() {
            debug_subtext("B=16");
            _loot_chest(0x08, ETHANOL, 0d03);
        },
        gourd_x__2_dry_ice = @install() {
            debug_subtext("B=17");
            _loot_chest(0x07, DRY_ICE, 0d02);
        },
        gourd_x__1_nectar = @install() {
            debug_subtext("B=18");
            _loot_chest(0x06, NECTAR, 0d01);
        },
        gourd_x__2_limestone = @install() {
            debug_subtext("B=19");
            _loot_chest(0x05, LIMESTONE, 0d02);
        },

        gourd_x__1_herbal_essence = @install() {
            debug_subtext("B=20");
            _loot_chest(0x04, HERBAL_ESSENCE, 0d01);
        },
        gourd_x__3_water = @install() {
            debug_subtext("B=21");
            _loot_chest(0x03, WATER, 0d03);
        },
        gourd_x__1_petal = @install() {
            debug_subtext("B=22");
            _loot_chest(0x02, PETAL, 0d01);
        },
        b_trigger_23 = @install() {
            debug_subtext("B=23");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map rimsala(RIMSALA) {
    enum entrance {
        south = entrance(0x21, 0x3e, NORTH)
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        spawn_boss_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        spawn_boss_1 = @install() {
            debug_subtext("S=4");
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};

map oglin_cave(OGLIN_CAVE) {
    enum entrance {
        room_1_north = entrance(0x38, 0x93, SOUTH),
        room_1_south_1 = entrance(0x40, 0xcb, NORTH),
        room_1_south_2 = entrance(0x2c, 0xcb, NORTH),
        room_1_waterfall = entrance(0x24, 0xc8, NONE),
        room_1_teleporter_north = entrance(0x2d, 0x9e, NONE),
        room_1_teleporter_east = entrance(0x39, 0xb4, NONE),
        room_1_teleporter_west = entrance(0x09, 0xaa, NONE),
        
        room_2_north_1 = entrance(0x2c, 0xd5, SOUTH),
        room_2_north_2 = entrance(0x3f, 0xd5, SOUTH),
        room_2_north_3 = entrance(0x4c, 0xd5, SOUTH),
        room_2_teleporter = entrance(0x25, 0xf4, NONE),

        room_3_north_1 = entrance(0x72, 0xd5, SOUTH),
        room_3_north_2 = entrance(0xa4, 0xd5, SOUTH),
        room_3_teleporter = entrance(0x89, 0xe0, NONE),
        
        room_4_north_1 = entrance(0x5e, 0x6f, SOUTH),
        room_4_north_2 = entrance(0x7c, 0x6f, SOUTH),
        room_4_north_3 = entrance(0x98, 0x6f, SOUTH),
        room_4_south_1 = entrance(0x96, 0xc3, NORTH),
        room_4_south_2 = entrance(0x6c, 0xc3, NORTH),
        room_4_south_3 = entrance(0x5c, 0xc3, NORTH),
        room_4_west = entrance(0x55, 0x80, EAST),
        room_4_teleporter_north = entrance(0x81, 0x7e, NONE),
        room_4_teleporter_south_west = entrance(0x5d, 0xa8, NONE),
        
        room_5_north = entrance(0xa4, 0x01, SOUTH),
        room_5_south_1 = entrance(0x96, 0x65, NORTH),
        room_5_south_2 = entrance(0x6e, 0x65, NORTH),
        room_5_south_2 = entrance(0x5c, 0x65, NORTH),
        room_5_west_1 = entrance(0x57, 0x3c, EAST),
        room_5_west_2 = entrance(0x57, 0x24, EAST),
        room_5_west_3 = entrance(0x57, 0x0c, EAST),
        room_5_teleporter_north = entrance(0x6b, 0x0a, NONE),
        room_5_teleporter_east = entrance(0x99, 0x1e, NONE),
        room_5_teleporter_south = entrance(0x81, 0x5c, NONE),
        
        room_6_north = entrance(0d68, 0d3, SOUTH),
        room_6_east_1 = entrance(0x4b, 0x0c, WEST),
        room_6_east_2 = entrance(0x4b, 0x24, WEST),
        room_6_east_3 = entrance(0x4b, 0x3c, WEST),
        room_6_south_1 = entrance(0x40, 0x45, NORTH),
        room_6_south_2 = entrance(0x16, 0x45, NORTH),
        room_6_teleporter = entrance(0x17, 0x0e, NONE),
        
        room_7_north_1 = entrance(0x16, 0x4f, SOUTH),
        room_7_north_2 = entrance(0x44, 0x4f, SOUTH),
        room_7_east = entrance(0x4f, 0x76, WEST),
        room_7_south = entrance(0x42, 0x83, NORTH),
        room_7_teleporter_north = entrance(0x2f, 0x5a, NONE),
        room_7_teleporter_center = entrance(0x35, 0x6c, NONE),
        room_7_teleporter_west = entrance(0x19, 0x6c, NONE),
        
        room_side_south = entrance(0xc8, 0x77, NORTH),
        room_side_teleporter_north = entrance(0xc3, 0x50, NONE),
        room_side_teleporter_south = entrance(0xc1, 0x64, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = @install() {
            debug_subtext("S=0");
        },
        exit_room_4_south_2 = @install() {
            debug_subtext("S=1");
        },
        exit_room_4_south_1 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() { // same as 0?
            debug_subtext("S=3");
        },
        exit_room_5_north = @install() {
            debug_subtext("S=4");
        },
        exit_room_5_south_1 = @install() {
            debug_subtext("S=5");
        },
        exit_room_5_south_2 = @install() {
            debug_subtext("S=6");
        },
        exit_room_5_south_3 = @install() {
            debug_subtext("S=7");
        },
        exit_room_5_west_1 = @install() {
            debug_subtext("S=8");
        },
        exit_room_5_west_2 = @install() {
            debug_subtext("S=9");
        },

        exit_room_5_west_3 = @install() {
            debug_subtext("S=10");
        },
        exit_room_6_east_1 = @install() {
            debug_subtext("S=11");
        },
        exit_room_6_east_2 = @install() {
            debug_subtext("S=12");
        },
        exit_room_6_east_3 = @install() {
            debug_subtext("S=13");
        },
        exit_room_6_south_1 = @install() {
            debug_subtext("S=14");
        },
        exit_room_6_south_2 = @install() {
            debug_subtext("S=15");
        },
        exit_room_7_east = @install() {
            debug_subtext("S=16");
        },
        exit_room_7_north_2 = @install() {
            debug_subtext("S=17");
        },
        exit_room_7_north_1 = @install() {
            debug_subtext("S=18");
        },
        exit_room_7_south = @install() {
            debug_subtext("S=19");
        },

        exit_room_4_north_3 = @install() {
            debug_subtext("S=20");
        },
        exit_room_4_north_2 = @install() {
            debug_subtext("S=21");
        },
        exit_room_4_north_1 = @install() {
            debug_subtext("S=22");
        },
        exit_room_4_west = @install() {
            debug_subtext("S=23");
        },
        exit_room_4_south_3 = @install() {
            debug_subtext("S=24");
        },
        exit_room_3_north_2 = @install() {
            debug_subtext("S=25");
        },
        exit_room_3_north_1 = @install() {
            debug_subtext("S=26");
        },
        exit_room_2_north_3 = @install() {
            debug_subtext("S=27");
        },
        exit_room_1_north = @install() {
            debug_subtext("S=28");
        },
        exit_room_2_north_2 = @install() {
            debug_subtext("S=29");
        },

        exit_room_1_south_1 = @install() {
            debug_subtext("S=30");
        },
        exit_room_2_north_1 = @install() {
            debug_subtext("S=31");
        },
        exit_room_1_south_2 = @install() {
            debug_subtext("S=32");
        },
        room_2_teleporter = @install() {
            debug_subtext("S=33");
        },
        room_3_teleporter = @install() {
            debug_subtext("S=34");
        },
        room_4_teleporter_south_west = @install() {
            debug_subtext("S=35");

            teleporter_out(0x5d, 0xa8);
        },
        room_1_teleporter_east = @install() {
            debug_subtext("S=36");
        },
        room_1_teleporter_west = @install() {
            debug_subtext("S=37");
        },
        room_1_teleporter_north = @install() {
            debug_subtext("S=38");
        },
        room_4_teleporter_north = @install() {
            debug_subtext("S=39");
        },

        room_side_teleporter_south = @install() {
            debug_subtext("S=40");
        },
        room_side_teleporter_north = @install() {
            debug_subtext("S=41");

            teleporter_out(0xc3, 0x50);
        },
        room_5_teleporter_south = @install() {
            debug_subtext("S=42");
        },
        room_7_teleporter_center = @install() {
            debug_subtext("S=43");
        },
        room_7_teleporter_west = @install() {
            debug_subtext("S=44");
        },
        room_7_teleporter_north = @install() {
            debug_subtext("S=45");
        },
        room_5_teleporter_east = @install() {
            debug_subtext("S=46");
        },
        room_5_teleporter_north = @install() {
            debug_subtext("S=47");
        },
        room_6_teleporter = @install() {
            debug_subtext("S=48");
        },
        exit_room_6_north = @install() {
            debug_subtext("S=49");
        },
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = @install() {
            debug_subtext("B=0");
            _loot_chest(0x00, CALL_BEADS, 0d03);
        },
        sniff_room_7__1_brimstone_2 = @install() {
            debug_subtext("B=1");
            _loot(0x1f, BRIMSTONE, 0d01, 0d02);
        },
        sniff_room_side__1_brimstone_2 = @install() {
            debug_subtext("B=2");
            _loot(0x1e, BRIMSTONE, 0d01, 0d02);
        },
        sniff_room_3__1_bone_1 = @install() {
            debug_subtext("B=3");
            _loot(0x1d, BONE, 0d01, 0d01);
        },
        sniff_room_2__1_bone = @install() {
            debug_subtext("B=4");
            _loot(0x1c, BONE, 0d01, 0d00);
        },
        sniff_room_4__1_bone_1 = @install() {
            debug_subtext("B=5");
            _loot(0x1b, BONE, 0d01, 0d01);
        },
        sniff_room_5__1_ash_2 = @install() {
            debug_subtext("B=6");
            _loot(0x1a, ASH, 0d01, 0d02);
        },
        sniff_room_5__1_vinegar_3 = @install() {
            debug_subtext("B=7");
            _loot(0x19, VINEGAR, 0d01, 0d03);
        },
        sniff_room_4__1_vinegar_2 = @install() {
            debug_subtext("B=8");
            _loot(0x18, VINEGAR, 0d01, 0d02);
        },
        sniff_room_2__1_water_1 = @install() {
            debug_subtext("B=9");
            _loot(0x17, WATER, 0d01, 0d01);
        },

        sniff_room_5__1_water = @install() {
            debug_subtext("B=10");
            _loot(0x16, WATER, 0d01, 0d00);
        },
        sniff_room_4__1_water_2 = @install() {
            debug_subtext("B=11");
            _loot(0x15, WATER, 0d01, 0d02);
        },
        sniff_room_1__1_water_1 = @install() {
            debug_subtext("B=12");
            _loot(0x14, WATER, 0d01, 0d01);
        },
        sniff_room_4__1_wax_2 = @install() {
            debug_subtext("B=13");
            _loot(0x13, WAX, 0d01, 0d02);
        },
        sniff_room_1__1_wax_1 = @install() {
            debug_subtext("B=14");
            _loot(0x12, WAX, 0d01, 0d01);
        },
        sniff_room_1__1_limestone = @install() {
            debug_subtext("B=15");
            _loot(0x11, LIMESTONE, 0d01, 0d00);
        },
        sniff_room_2__1_limestone_1 = @install() {
            debug_subtext("B=16");
            _loot(0x10, LIMESTONE, 0d01, 0d01);
        },
        sniff_room_3__1_limestone_2 = @install() {
            debug_subtext("B=17");
            _loot(0x0f, LIMESTONE, 0d01, 0d02);
        },
        sniff_room_4__1_limestone_1 = @install() {
            debug_subtext("B=18");
            _loot(0x0e, LIMESTONE, 0d01, 0d01);
        },
        sniff_room_5__1_roots_1 = @install() {
            debug_subtext("B=19");
            _loot(0x0d, ROOTS, 0d01, 0d01);
        },

        sniff_room_side__1_ethanol_2 = @install() {
            debug_subtext("B=20");
            _loot(0x0c, ETHANOL, 0d01, 0d02);
        },
        sniff_room_5__1_ethanol_1 = @install() {
            debug_subtext("B=21");
            _loot(0x0b, ETHANOL, 0d01, 0d01);
        },
        sniff_room_7__1_ethanol = @install() {
            debug_subtext("B=22");
            _loot(0x0a, ETHANOL, 0d01, 0d00);
        },
        sniff_room_5__1_crystal_2 = @install() {
            debug_subtext("B=23");
            _loot(0x09, CRYSTAL, 0d01, 0d02);
        },
        sniff_room_6__1_crystal_1 = @install() {
            debug_subtext("B=24");
            _loot(0x08, CRYSTAL, 0d01, 0d01);
        },
        sniff_room_6__1_clay_1 = @install() {
            debug_subtext("B=25");
            _loot(0x07, CLAY, 0d01, 0d01);
        },
        sniff_room_7__1_clay = @install() {
            debug_subtext("B=26");
            _loot(0x06, CLAY, 0d01, 0d00);
        },
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = @install() {
            debug_subtext("B=28");
            _loot(0x04, CLAY, 0d01, 0d01);
        },
        sniff_room_4__1_oil_2 = @install() {
            debug_subtext("B=29");
            _loot(0x03, OIL, 0d01, 0d02);
        },

        sniff_room_5__1_oil = @install() {
            debug_subtext("B=30");
            _loot(0x02, OIL, 0d01, 0d00);
        },
        sniff_room_6__1_oil_1 = @install() {
            debug_subtext("B=31");
            _loot(0x01, OIL, 0d01, 0d01);
        },
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        fade_in();
    }
};
map oglin_cave__room_1(OGLIN_CAVE) { // variant room_1 (entrance)
    enum entrance {
        north = entrance(0x38, 0x93, SOUTH),
        south_1 = entrance(0x40, 0xcb, NORTH),
        south_2 = entrance(0x2c, 0xcb, NORTH),

        teleporter_north = entrance(0x2d, 0x9e, NONE),
        teleporter_east = entrance(0x39, 0xb4, NONE),
        teleporter_west = entrance(0x09, 0xaa, NONE),
        
        waterfall = entrance(0x24, 0xc8, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_north = @install() {
            debug_subtext("S=28");
        },
        exit_room_2_north_2 = nop(),

        exit_south_1 = @install() {
            debug_subtext("S=30");
        },
        exit_room_2_north_1 = nop(),
        exit__south_2 = @install() {
            debug_subtext("S=32");
        },
        room_2_teleporter = nop(),
        room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        teleporter_east = @install() {
            debug_subtext("S=36");
        },
        teleporter_west = @install() {
            debug_subtext("S=37");
        },
        teleporter_north = @install() {
            debug_subtext("S=38");
        },
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff__1_water_1 = @install() {
            debug_subtext("B=12");
            _loot(0x14, WATER, 0d01, 0d01);
        },
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = @install() {
            debug_subtext("B=14");
            _loot(0x12, WAX, 0d01, 0d01);
        },
        sniff__1_limestone = @install() {
            debug_subtext("B=15");
            _loot(0x11, LIMESTONE, 0d01, 0d00);
        },
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d1);

        fade_in();
    }
};
map oglin_cave__room_2(OGLIN_CAVE) { // variant room_2 (U-shape)
    enum entrance {
        north_1 = entrance(0x2c, 0xd5, SOUTH),
        north_2 = entrance(0x3f, 0xd5, SOUTH),
        north_3 = entrance(0x4c, 0xd5, SOUTH),

        teleporter = entrance(0x25, 0xf4, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_north_3 = @install() {
            debug_subtext("S=27");
        },
        exit_room_1_north = nop(),
        exit_north_2 = @install() {
            debug_subtext("S=29");
        },

        exit_room_1_south_1 = nop(),
        exit_north_1 = @install() {
            debug_subtext("S=31");
        },
        exit_room_1_south_2 = nop(),
        teleporter = @install() {
            debug_subtext("S=33");
        },
        room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff__1_bone = @install() {
            debug_subtext("B=4");
            _loot(0x1c, BONE, 0d01, 0d00);
        },
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff__1_water_1 = @install() {
            debug_subtext("B=9");
            _loot(0x17, WATER, 0d01, 0d01);
        },

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=16");
            _loot(0x10, LIMESTONE, 0d01, 0d01);
        },
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d2);
        fade_in();
    }
};
map oglin_cave__room_3(OGLIN_CAVE) { // variant room_3 (U-shape)
    enum entrance {
        north_1 = entrance(0x72, 0xd5, SOUTH),
        north_2 = entrance(0xa4, 0xd5, SOUTH),

        teleporter = entrance(0x89, 0xe0, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_north_2 = @install() {
            debug_subtext("S=25");
        },
        exit_north_1 = @install() {
            debug_subtext("S=26");
        },
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        teleporter = @install() {
            debug_subtext("S=34");
        },
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff__1_bone_1 = @install() {
            debug_subtext("B=3");
            _loot(0x1d, BONE, 0d01, 0d01);
        },
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff__1_limestone_2 = @install() {
            debug_subtext("B=17");
            _loot(0x0f, LIMESTONE, 0d01, 0d02);
        },
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d3);
        fade_in();
    }
};
map oglin_cave__room_4(OGLIN_CAVE) { // variant room_4
    enum entrance {
        north_1 = entrance(0x5e, 0x6f, SOUTH),
        north_2 = entrance(0x7c, 0x6f, SOUTH),
        north_3 = entrance(0x98, 0x6f, SOUTH),
        south_1 = entrance(0x96, 0xc3, NORTH),
        south_2 = entrance(0x6c, 0xc3, NORTH),
        south_3 = entrance(0x5c, 0xc3, NORTH),
        west = entrance(0x55, 0x80, EAST),

        teleporter_north = entrance(0x81, 0x7e, NONE),
        teleporter_south_west = entrance(0x5d, 0xa8, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_south_2 = @install() {
            debug_subtext("S=1");
        },
        exit_south_1 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_north_3 = @install() {
            debug_subtext("S=20");
        },
        exit_north_2 = @install() {
            debug_subtext("S=21");
        },
        exit_north_1 = @install() {
            debug_subtext("S=22");
        },
        exit_west = @install() {
            debug_subtext("S=23");
        },
        exit_south_3 = @install() {
            debug_subtext("S=24");
        },
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        exit_room_3_teleporter = nop(),
        teleporter_south_west = @install() {
            debug_subtext("S=35");

            teleporter_out(0x5d, 0xa8);
        },
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        teleporter_north = @install() {
            debug_subtext("S=39");
        },

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff__1_bone_1 = @install() {
            debug_subtext("B=5");
            _loot(0x1b, BONE, 0d01, 0d01);
        },
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff__1_vinegar_2 = @install() {
            debug_subtext("B=8");
            _loot(0x18, VINEGAR, 0d01, 0d02);
        },
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff__1_water_2 = @install() {
            debug_subtext("B=11");
            _loot(0x15, WATER, 0d01, 0d02);
        },
        sniff_room_1__1_water_1 = nop(),
        sniff__1_wax_2 = @install() {
            debug_subtext("B=13");
            _loot(0x13, WAX, 0d01, 0d02);
        },
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff__1_limestone_1 = @install() {
            debug_subtext("B=18");
            _loot(0x0e, LIMESTONE, 0d01, 0d01);
        },
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff__1_clay_1 = @install() {
            debug_subtext("B=28");
            _loot(0x04, CLAY, 0d01, 0d01);
        },
        sniff__1_oil_2 = @install() {
            debug_subtext("B=29");
            _loot(0x03, OIL, 0d01, 0d02);
        },

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d4);
        fade_in();
    }
};
map oglin_cave__room_5(OGLIN_CAVE) { // variant room_5 (gourd)
    enum entrance {
        north = entrance(0xa4, 0x01, SOUTH),
        south_1 = entrance(0x96, 0x65, NORTH),
        south_2 = entrance(0x6e, 0x65, NORTH),
        south_3 = entrance(0x5c, 0x65, NORTH),
        west_1 = entrance(0x57, 0x3c, EAST),
        west_2 = entrance(0x57, 0x24, EAST),
        west_3 = entrance(0x57, 0x0c, EAST),

        teleporter_north = entrance(0x6b, 0x0a, NONE),
        teleporter_east = entrance(0x99, 0x1e, NONE),
        teleporter_south = entrance(0x81, 0x5c, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_north = @install() {
            debug_subtext("S=4");
        },
        exit_south_1 = @install() {
            debug_subtext("S=5");
        },
        exit_south_2 = @install() {
            debug_subtext("S=6");
        },
        exit_south_3 = @install() {
            debug_subtext("S=7");
        },
        exit_west_1 = @install() {
            debug_subtext("S=8");
        },
        exit_west_2 = @install() {
            debug_subtext("S=9");
        },

        exit_west_3 = @install() {
            debug_subtext("S=10");
        },
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        exit_room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        teleporter_south = @install() {
            debug_subtext("S=42");
        },
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        teleporter_east = @install() {
            debug_subtext("S=46");
        },
        teleporter_north = @install() {
            debug_subtext("S=47");
        },
        room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd__3_call_beads = @install() {
            debug_subtext("B=0");
            _loot_chest(0x00, CALL_BEADS, 0d03);
        },
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff__1_ash_2 = @install() {
            debug_subtext("B=6");
            _loot(0x1a, ASH, 0d01, 0d02);
        },
        sniff__1_vinegar_3 = @install() {
            debug_subtext("B=7");
            _loot(0x19, VINEGAR, 0d01, 0d03);
        },
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff__1_water = @install() {
            debug_subtext("B=10");
            _loot(0x16, WATER, 0d01, 0d00);
        },
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff__1_roots_1 = @install() {
            debug_subtext("B=19");
            _loot(0x0d, ROOTS, 0d01, 0d01);
        },

        sniff_room_side__1_ethanol_2 = nop(),
        sniff__1_ethanol_1 = @install() {
            debug_subtext("B=21");
            _loot(0x0b, ETHANOL, 0d01, 0d01);
        },
        sniff_room_7__1_ethanol = nop(),
        sniff__1_crystal_2 = @install() {
            debug_subtext("B=23");
            _loot(0x09, CRYSTAL, 0d01, 0d02);
        },
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff__1_oil = @install() {
            debug_subtext("B=30");
            _loot(0x02, OIL, 0d01, 0d00);
        },
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d5);
        fade_in();
    }
};
map oglin_cave__room_6(OGLIN_CAVE) { // variant room_6 (exit)
    enum entrance {
        north = entrance(0d68, 0d3, SOUTH),
        east_1 = entrance(0x4b, 0x0c, WEST),
        east_2 = entrance(0x4b, 0x24, WEST),
        east_3 = entrance(0x4b, 0x3c, WEST),
        south_1 = entrance(0x40, 0x45, NORTH),
        south_2 = entrance(0x16, 0x45, NORTH),

        teleporter = entrance(0x17, 0x0e, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_east_1 = @install() {
            debug_subtext("S=11");
        },
        exit_east_2 = @install() {
            debug_subtext("S=12");
        },
        exit_east_3 = @install() {
            debug_subtext("S=13");
        },
        exit_south_1 = @install() {
            debug_subtext("S=14");
        },
        exit_south_2 = @install() {
            debug_subtext("S=15");
        },
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        exit_room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        teleporter = @install() {
            debug_subtext("S=48");
        },
        exit_north = @install() {
            debug_subtext("S=49");
        },
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff__1_crystal_1 = @install() {
            debug_subtext("B=24");
            _loot(0x08, CRYSTAL, 0d01, 0d01);
        },
        sniff__1_clay_1 = @install() {
            debug_subtext("B=25");
            _loot(0x07, CLAY, 0d01, 0d01);
        },
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff__1_oil_1 = @install() {
            debug_subtext("B=31");
            _loot(0x01, OIL, 0d01, 0d01);
        },
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d6);
        fade_in();
    }
};
map oglin_cave__room_7(OGLIN_CAVE) { // variant room_7
    enum entrance {
        north_1 = entrance(0x16, 0x4f, SOUTH),
        north_2 = entrance(0x44, 0x4f, SOUTH),
        east = entrance(0x4f, 0x76, WEST),
        south = entrance(0x42, 0x83, NORTH),

        teleporter_north = entrance(0x2f, 0x5a, NONE),
        teleporter_center = entrance(0x35, 0x6c, NONE),
        teleporter_west = entrance(0x19, 0x6c, NONE),
    }

    enum stepon_trigger {
        exit_room_side_south = nop(),
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_east = @install() {
            debug_subtext("S=16");
        },
        exit_north_2 = @install() {
            debug_subtext("S=17");
        },
        exit_north_1 = @install() {
            debug_subtext("S=18");
        },
        exit_south = @install() {
            debug_subtext("S=19");
        },

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        exit_room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        room_side_teleporter_south = nop(),
        room_side_teleporter_north = nop(),
        room_5_teleporter_south = nop(),
        teleporter_center = @install() {
            debug_subtext("S=43");
        },
        teleporter_west = @install() {
            debug_subtext("S=44");
        },
        teleporter_north = @install() {
            debug_subtext("S=45");
        },
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        exit_room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff__1_brimstone_2 = @install() {
            debug_subtext("B=1");
            _loot(0x1f, BRIMSTONE, 0d01, 0d02);
        },
        sniff_room_side__1_brimstone_2 = nop(),
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff_room_side__1_ethanol_2 = nop(),
        sniff_room_5__1_ethanol_1 = nop(),
        sniff__1_ethanol = @install() {
            debug_subtext("B=22");
            _loot(0x0a, ETHANOL, 0d01, 0d00);
        },
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff__1_clay = @install() {
            debug_subtext("B=26");
            _loot(0x06, CLAY, 0d01, 0d00);
        },
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d7);
        fade_in();
    }
};
map oglin_cave__room_side(OGLIN_CAVE) { // variant room_side
    enum entrance {
        south = entrance(0xc8, 0x77, NORTH),

        teleporter_north = entrance(0xc3, 0x50, NONE),
        teleporter_south = entrance(0xc1, 0x64, NONE),
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        exit_room_4_south_2 = nop(),
        exit_room_4_south_1 = nop(),
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        exit_room_5_north = nop(),
        exit_room_5_south_1 = nop(),
        exit_room_5_south_2 = nop(),
        exit_room_5_south_3 = nop(),
        exit_room_5_west_1 = nop(),
        exit_room_5_west_2 = nop(),

        exit_room_5_west_3 = nop(),
        exit_room_6_east_1 = nop(),
        exit_room_6_east_2 = nop(),
        exit_room_6_east_3 = nop(),
        exit_room_6_south_1 = nop(),
        exit_room_6_south_2 = nop(),
        exit_room_7_east = nop(),
        exit_room_7_north_2 = nop(),
        exit_room_7_north_1 = nop(),
        exit_room_7_south = nop(),

        exit_room_4_north_3 = nop(),
        exit_room_4_north_2 = nop(),
        exit_room_4_north_1 = nop(),
        exit_room_4_west = nop(),
        exit_room_4_south_3 = nop(),
        exit_room_3_north_2 = nop(),
        exit_room_3_north_1 = nop(),
        exit_room_2_north_3 = nop(),
        exit_room_1_north = nop(),
        exit_room_2_north_2 = nop(),

        exit_room_1_south_1 = nop(),
        exit_room_2_north_1 = nop(),
        exit_room_1_south_2 = nop(),
        exit_room_2_teleporter = nop(),
        exit_room_3_teleporter = nop(),
        room_4_teleporter_south_west = nop(),
        room_1_teleporter_east = nop(),
        room_1_teleporter_west = nop(),
        room_1_teleporter_north = nop(),
        room_4_teleporter_north = nop(),

        teleporter_south = @install() {
            debug_subtext("S=40");
        },
        teleporter_north = @install() {
            debug_subtext("S=41");

            teleporter_out(0xc3, 0x50);
        },
        room_5_teleporter_south = nop(),
        room_7_teleporter_center = nop(),
        room_7_teleporter_west = nop(),
        room_7_teleporter_north = nop(),
        room_5_teleporter_east = nop(),
        room_5_teleporter_north = nop(),
        exit_room_6_teleporter = nop(),
        exit_room_6_north = nop(),
    }

    enum b_trigger {
        gourd_room_5__3_call_beads = nop(),
        sniff_room_7__1_brimstone_2 = nop(),
        sniff__1_brimstone_2 = @install() {
            debug_subtext("B=2");
            _loot(0x1e, BRIMSTONE, 0d01, 0d02);
        },
        sniff_room_3__1_bone_1 = nop(),
        sniff_room_2__1_bone = nop(),
        sniff_room_4__1_bone_1 = nop(),
        sniff_room_5__1_ash_2 = nop(),
        sniff_room_5__1_vinegar_3 = nop(),
        sniff_room_4__1_vinegar_2 = nop(),
        sniff_room_2__1_water_1 = nop(),

        sniff_room_5__1_water = nop(),
        sniff_room_4__1_water_2 = nop(),
        sniff_room_1__1_water_1 = nop(),
        sniff_room_4__1_wax_2 = nop(),
        sniff_room_1__1_wax_1 = nop(),
        sniff_room_1__1_limestone = nop(),
        sniff_room_2__1_limestone_1 = nop(),
        sniff_room_3__1_limestone_2 = nop(),
        sniff_room_4__1_limestone_1 = nop(),
        sniff_room_5__1_roots_1 = nop(),

        sniff__1_ethanol_2 = @install() {
            debug_subtext("B=20");
            _loot(0x0c, ETHANOL, 0d01, 0d02);
        },
        sniff_room_5__1_ethanol_1 = nop(),
        sniff_room_7__1_ethanol = nop(),
        sniff_room_5__1_crystal_2 = nop(),
        sniff_room_6__1_crystal_1 = nop(),
        sniff_room_6__1_clay_1 = nop(),
        sniff_room_7 = nop(),
        sniff__1_clay_2 = @install() { // TODO: ???
            debug_subtext("B=27");
            _loot(0x05, CLAY, 0d01, 0d02);
        },
        sniff_room_4__1_clay_1 = nop(),
        sniff_room_4__1_oil_2 = nop(),

        sniff_room_5__1_oil = nop(),
        sniff_room_6__1_oil_1 = nop(),
    }

    fun init_room(index) {
        if(index == 0d1) {
            init_map(0x00, 0x92, 0x46, 0xcc); // room 1
        } else if(index == 0d2) {
            init_map(0x20, 0xd4, 0x64, 0xfa); // room 2
        } else if(index == 0d3) {
            init_map(0x66, 0xd4, 0xaa, 0xf8); // room 3
        } else if(index == 0d4) {
            init_map(0x54, 0x6e, 0xa4, 0xc2); // room 4
        } else if(index == 0d5) {
            init_map(0x56, 0x00, 0xaa, 0x65); // room 5
        } else if(index == 0d6) {
            init_map(0x0c, 0x02, 0x4c, 0x46); // room 6
        } else if(index == 0d7) {
            init_map(0x0c, 0x4e, 0x50, 0x84); // room 7
        } else if(index == 0d8) {
            init_map(0xb4, 0x46, 0xd4, 0x78); // room side
        }
    }

    fun trigger_enter() {
        init_room(0d8);
        fade_in();
    }
};

map aquagoth(AQUAGOTH) {
    enum entrance {
        south = entrance(0x1b, 0x51, NORTH)
    }

    fun trigger_enter() {
        fade_in();

        // object[0x00] = 0x7e; // close door
        // object[0x01] = 0x01; // hide aquagoth
    }
};

map tiny_entrance(PYRAMID_CAVE) {
    enum entrance {
        south = entrance(0x15, 0x23, NORTH)
    }

    enum stepon_trigger {
        exit_south = @install() {
            debug_subtext("S=0");
        },
        exit_teleporter = @install() {
            debug_subtext("S=1");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

map tiny(TINY) {
    enum entrance {
        test = entrance(0x10, 0x10, NONE)
    }

    enum stepon_trigger {
        stepon_0 = @install() {
            debug_subtext("S=0");
        },
        stepon_1 = @install() {
            debug_subtext("S=1");
        },
        stepon_2 = @install() {
            debug_subtext("S=2");
        },
        stepon_3 = @install() {
            debug_subtext("S=3");
        },
        stepon_4 = @install() {
            debug_subtext("S=4");
        },
        stepon_5 = @install() {
            debug_subtext("S=5");
        },
        stepon_6 = @install() {
            debug_subtext("S=6");
        },
        stepon_7 = @install() {
            debug_subtext("S=7");
        },
        stepon_8 = @install() {
            debug_subtext("S=8");
        },
        stepon_9 = @install() {
            debug_subtext("S=9");
        },

        stepon_10 = @install() {
            debug_subtext("S=10");
        },
        stepon_11 = @install() {
            debug_subtext("S=11");
        },
        stepon_12 = @install() {
            debug_subtext("S=12");
        },
        stepon_13 = @install() {
            debug_subtext("S=13");
        },
        stepon_14 = @install() {
            debug_subtext("S=14");
        },
        stepon_15 = @install() {
            debug_subtext("S=15");
        },
        stepon_16 = @install() {
            debug_subtext("S=16");
        },
        stepon_17 = @install() {
            debug_subtext("S=17");
        },
        stepon_18 = @install() {
            debug_subtext("S=18");
        },
        stepon_19 = @install() {
            debug_subtext("S=19");
        },

        stepon_20 = @install() {
            debug_subtext("S=20");
        },
    }

    enum b_trigger {
        wall_x = @install() {
            debug_subtext("B=0");
        },
        gourd_x__1_biscuit = @install() {
            debug_subtext("B=1");
            _loot_chest(0x0d, BISCUIT, 0d01);
        },
        gourd_x__1_call_beads = @install() {
            debug_subtext("B=2");
            _loot_chest(0x0c, CALL_BEADS, 0d01);
        },
        gourd_x__1_wings = @install() {
            debug_subtext("B=3");
            _loot_chest(0x0b, WINGS, 0d01);
        },
        gourd_x__3_ethanol = @install() {
            debug_subtext("B=4");
            _loot_chest(0x0a, ETHANOL, 0d03);
        },
        gourd_x__1_pixie_dust = @install() {
            debug_subtext("B=5");
            _loot_chest(0x09, PIXIE_DUST, 0d01);
        },
        gourd_x__1_HERBAL_ESSENCE = @install() {
            debug_subtext("B=6");
            _loot_chest(0x08, HERBAL_ESSENCE, 0d01);
        },
        gourd_x__1_honey = @install() {
            debug_subtext("B=7");
            _loot_chest(0x07, HONEY, 0d01);
        },
        wall_x = @install() {
            debug_subtext("B=8");
        },
        wall_x = @install() {
            debug_subtext("B=9");
        },

        wall_x = @install() {
            debug_subtext("B=10");
        },
    }

    fun trigger_enter() {
        fade_in();
    }
};

// misc

map brians_room(BRIAN) {
    enum entrance {
        center = entrance(0x17, 0x19, NONE)
    }

    fun trigger_enter() {
        fade_in();
    }
};